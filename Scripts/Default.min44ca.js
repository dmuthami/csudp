// =====  Scripts/jquery.geo-test.min.js  =====    
/*! jQuery Geo - vtest - 2012-11-02
 * http://jquerygeo.com
 * Copyright (c) 2012 Ryan Westphal/Applied Geographics, Inc.; Licensed MIT, GPL */
document.createElement("canvas").getContext||function(){function f(){return this.context_||(this.context_=new P(this))}function c(e,t,n){var r=l.call(arguments,2);return function(){return e.apply(t,r.concat(l.call(arguments)))}}function h(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;")}function p(e,t,n){e.namespaces[t]||e.namespaces.add(t,n,"#default#VML")}function d(e){p(e,"g_vml_","urn:schemas-microsoft-com:vml"),p(e,"g_o_","urn:schemas-microsoft-com:office:office");if(!e.styleSheets.ex_canvas_){var t=e.createStyleSheet();t.owningElement.id="ex_canvas_",t.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function m(e){var t=e.srcElement;switch(e.propertyName){case"width":t.getContext().clearRect(),t.style.width=t.attributes.width.nodeValue+"px",t.firstChild.style.width=t.clientWidth+"px";break;case"height":t.getContext().clearRect(),t.style.height=t.attributes.height.nodeValue+"px",t.firstChild.style.height=t.clientHeight+"px"}}function g(e){var t=e.srcElement;t.firstChild&&(t.firstChild.style.width=t.clientWidth+"px",t.firstChild.style.height=t.clientHeight+"px")}function E(){return[[1,0,0],[0,1,0],[0,0,1]]}function S(e,t){var n=E();for(var r=0;r<3;r++)for(var i=0;i<3;i++){var s=0;for(var o=0;o<3;o++)s+=e[r][o]*t[o][i];n[r][i]=s}return n}function x(e,t){t.fillStyle=e.fillStyle,t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle,t.globalAlpha=e.globalAlpha,t.font=e.font,t.textAlign=e.textAlign,t.textBaseline=e.textBaseline,t.arcScaleX_=e.arcScaleX_,t.arcScaleY_=e.arcScaleY_,t.lineScale_=e.lineScale_}function T(e){var t=e.indexOf("(",3),n=e.indexOf(")",t+1),r=e.substring(t+1,n).split(",");if(r.length!=4||e.charAt(3)!="a")r[3]=1;return r}function N(e){return parseFloat(e)/100}function C(e,t,n){return Math.min(n,Math.max(t,e))}function k(e){var t,n,r,i,s,o;i=parseFloat(e[0])/360%360,i<0&&i++,s=C(N(e[1]),0,1),o=C(N(e[2]),0,1);if(s==0)t=n=r=o;else{var u=o<.5?o*(1+s):o+s-o*s,a=2*o-u;t=L(a,u,i+1/3),n=L(a,u,i),r=L(a,u,i-1/3)}return"#"+y[Math.floor(t*255)]+y[Math.floor(n*255)]+y[Math.floor(r*255)]}function L(e,t,n){return n<0&&n++,n>1&&n--,6*n<1?e+(t-e)*6*n:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function O(e){if(e in A)return A[e];var t,n=1;e=String(e);if(e.charAt(0)=="#")t=e;else if(/^rgb/.test(e)){var r=T(e),t="#",i;for(var s=0;s<3;s++)r[s].indexOf("%")!=-1?i=Math.floor(N(r[s])*255):i=+r[s],t+=y[C(i,0,255)];n=+r[3]}else if(/^hsl/.test(e)){var r=T(e);t=k(r),n=r[3]}else t=e;return A[e]={color:t,alpha:n}}function D(e){return _[e]||"square"}function P(e){this.m_=E(),this.mStack_=[],this.aStack_=[],this.currentPath_=[],this.strokeStyle="#000",this.fillStyle="#000",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this.miterLimit=o*1,this.globalAlpha=1,this.canvas=e;var t="width:"+e.clientWidth+"px;height:"+e.clientHeight+"px;overflow:hidden;position:absolute",n=e.ownerDocument.createElement("div");n.style.cssText=t,e.appendChild(n);var r=n.cloneNode(!1);r.style.backgroundColor="red",r.style.filter="alpha(opacity=0)",e.appendChild(r),this.element_=n,this.arcScaleX_=1,this.arcScaleY_=1,this.lineScale_=1}function B(e,t,n,r){e.currentPath_.push({type:"bezierCurveTo",cp1x:t.x,cp1y:t.y,cp2x:n.x,cp2y:n.y,x:r.x,y:r.y}),e.currentX_=r.x,e.currentY_=r.y}function j(e,t){var n=O(e.strokeStyle),r=n.color,i=n.alpha*e.globalAlpha,s=e.lineScale_*e.lineWidth;s<1&&(i*=s),t.push("<g_vml_:stroke",' opacity="',i,'"',' joinstyle="',e.lineJoin,'"',' miterlimit="',e.miterLimit,'"',' endcap="',D(e.lineCap),'"',' weight="',s,'px"',' color="',r,'" />')}function F(e,t,n,r){var i=e.fillStyle,s=e.arcScaleX_,o=e.arcScaleY_,u=r.x-n.x,a=r.y-n.y,f=O(e.fillStyle),l=f.color,c=f.alpha*e.globalAlpha;t.push('<g_vml_:fill color="',l,'" opacity="',c,'" />')}function I(e,t,n){var r=e.m_;return{x:o*(t*r[0][0]+n*r[1][0]+r[2][0])-u,y:o*(t*r[0][1]+n*r[1][1]+r[2][1])-u}}function q(e){return isFinite(e[0][0])&&isFinite(e[0][1])&&isFinite(e[1][0])&&isFinite(e[1][1])&&isFinite(e[2][0])&&isFinite(e[2][1])}function R(e,t,n){if(!q(t))return;e.m_=t;if(n){var r=t[0][0]*t[1][1]-t[0][1]*t[1][0];e.lineScale_=s(i(r))}}function U(e){throw new z(e)}function z(e){this.code=this[e],this.message=e+": DOM Exception "+this.code}var e=Math,t=e.round,n=e.sin,r=e.cos,i=e.abs,s=e.sqrt,o=10,u=o/2,a=+navigator.userAgent.match(/MSIE ([\d.]+)?/)[1],l=Array.prototype.slice;d(document);var v={init:function(e){var t=e||document;t.createElement("canvas"),t.attachEvent("onreadystatechange",c(this.init_,this,t))},init_:function(e){var t=e.getElementsByTagName("canvas");for(var n=0;n<t.length;n++)this.initElement(t[n])},initElement:function(e){if(!e.getContext){e.getContext=f,d(e.ownerDocument),e.innerHTML="",e.attachEvent("onpropertychange",m),e.attachEvent("onresize",g);var t=e.attributes;t.width&&t.width.specified?e.style.width=t.width.nodeValue+"px":e.width=e.clientWidth,t.height&&t.height.specified?e.style.height=t.height.nodeValue+"px":e.height=e.clientHeight}return e}};v.init();var y=[];for(var b=0;b<16;b++)for(var w=0;w<16;w++)y[b*16+w]=b.toString(16)+w.toString(16);var A={},M={style:"normal",variant:"normal",weight:"normal",size:10,family:"sans-serif"},_={butt:"flat",round:"round"},H=P.prototype;H.clearRect=function(){this.textMeasureEl_&&(this.textMeasureEl_.removeNode(!0),this.textMeasureEl_=null),this.element_.innerHTML=""},H.beginPath=function(){this.currentPath_=[]},H.moveTo=function(e,t){var n=I(this,e,t);this.currentPath_.push({type:"moveTo",x:n.x,y:n.y}),this.currentX_=n.x,this.currentY_=n.y},H.lineTo=function(e,t){var n=I(this,e,t);this.currentPath_.push({type:"lineTo",x:n.x,y:n.y}),this.currentX_=n.x,this.currentY_=n.y},H.bezierCurveTo=function(e,t,n,r,i,s){var o=I(this,i,s),u=I(this,e,t),a=I(this,n,r);B(this,u,a,o)},H.quadraticCurveTo=function(e,t,n,r){var i=I(this,e,t),s=I(this,n,r),o={x:this.currentX_+2/3*(i.x-this.currentX_),y:this.currentY_+2/3*(i.y-this.currentY_)},u={x:o.x+(s.x-this.currentX_)/3,y:o.y+(s.y-this.currentY_)/3};B(this,o,u,s)},H.arc=function(e,t,i,s,a,f){i*=o;var l=f?"at":"wa",c=e+r(s)*i-u,h=t+n(s)*i-u,p=e+r(a)*i-u,d=t+n(a)*i-u;c==p&&!f&&(c+=.125);var v=I(this,e,t),m=I(this,c,h),g=I(this,p,d);this.currentPath_.push({type:l,x:v.x,y:v.y,radius:i,xStart:m.x,yStart:m.y,xEnd:g.x,yEnd:g.y})},H.stroke=function(e){var n=[],r=!1,i=10,s=10;n.push("<g_vml_:shape",' filled="',!!e,'"',' style="position:absolute;width:',i,"px;height:",s,'px;"',' coordorigin="0,0"',' coordsize="',o*i,",",o*s,'"',' stroked="',!e,'"',' path="');var u=!1,a={x:null,y:null},f={x:null,y:null};for(var l=0;l<this.currentPath_.length;l++){var c=this.currentPath_[l],h;switch(c.type){case"moveTo":h=c,n.push(" m ",t(c.x),",",t(c.y));break;case"lineTo":n.push(" l ",t(c.x),",",t(c.y));break;case"close":n.push(" x "),c=null;break;case"bezierCurveTo":n.push(" c ",t(c.cp1x),",",t(c.cp1y),",",t(c.cp2x),",",t(c.cp2y),",",t(c.x),",",t(c.y));break;case"at":case"wa":n.push(" ",c.type," ",t(c.x-this.arcScaleX_*c.radius),",",t(c.y-this.arcScaleY_*c.radius)," ",t(c.x+this.arcScaleX_*c.radius),",",t(c.y+this.arcScaleY_*c.radius)," ",t(c.xStart),",",t(c.yStart)," ",t(c.xEnd),",",t(c.yEnd))}if(c){if(a.x==null||c.x<a.x)a.x=c.x;if(f.x==null||c.x>f.x)f.x=c.x;if(a.y==null||c.y<a.y)a.y=c.y;if(f.y==null||c.y>f.y)f.y=c.y}}n.push(' ">'),e?F(this,n,a,f):j(this,n),n.push("</g_vml_:shape>"),this.element_.insertAdjacentHTML("beforeEnd",n.join(""))},H.fill=function(){this.stroke(!0)},H.closePath=function(){this.currentPath_.push({type:"close"})},H.save=function(){var e={};x(this,e),this.aStack_.push(e),this.mStack_.push(this.m_),this.m_=S(E(),this.m_)},H.restore=function(){this.aStack_.length&&(x(this.aStack_.pop(),this),this.m_=this.mStack_.pop())},H.translate=function(e,t){var n=[[1,0,0],[0,1,0],[e,t,1]];R(this,S(n,this.m_),!1)},H.scale=function(e,t){this.arcScaleX_*=e,this.arcScaleY_*=t;var n=[[e,0,0],[0,t,0],[0,0,1]];R(this,S(n,this.m_),!0)};var W=z.prototype=new Error;W.INDEX_SIZE_ERR=1,W.DOMSTRING_SIZE_ERR=2,W.HIERARCHY_REQUEST_ERR=3,W.WRONG_DOCUMENT_ERR=4,W.INVALID_CHARACTER_ERR=5,W.NO_DATA_ALLOWED_ERR=6,W.NO_MODIFICATION_ALLOWED_ERR=7,W.NOT_FOUND_ERR=8,W.NOT_SUPPORTED_ERR=9,W.INUSE_ATTRIBUTE_ERR=10,W.INVALID_STATE_ERR=11,W.SYNTAX_ERR=12,W.INVALID_MODIFICATION_ERR=13,W.NAMESPACE_ERR=14,W.INVALID_ACCESS_ERR=15,W.VALIDATION_ERR=16,W.TYPE_MISMATCH_ERR=17,G_vmlCanvasManager=v,CanvasRenderingContext2D=P,DOMException=z}(),this.jsviews||this.jQuery&&jQuery.views||function(e,t){function C(e,t){var n="\\"+e.charAt(0),r="\\"+e.charAt(1),o="\\"+t.charAt(0),u="\\"+t.charAt(1);return N.rTag=i=r+"(?:(?:(\\w+(?=[\\/\\s"+o+"]))|(?:(\\w+)?(:)|(>)|(\\*)))"+"\\s*((?:[^"+o+"]|"+o+"(?!"+u+"))*?)"+"(\\/)?|(?:\\/(\\w+)))"+o,i=new RegExp(n+i+u,"g"),s=new RegExp("<.*>|"+e+".*"+t),this}function k(e){var n=this,r=n.tmpl.helpers||{};return e=(n.ctx[e]!==t?n.ctx:r[e]!==t?r:P[e]!==t?P:{})[e],typeof e!="function"?e:function(){return e.apply(n,arguments)}}function L(e,t,n){var r=t.tmpl.converters;return e=r&&r[e]||H[e],e?e.call(t,n):n}function A(e,n,r,i,s){s.props=s.props||{};var u,a=s.props.tmpl,l=n.tmpl.tags,c=n.tmpl.templates,h=arguments,p=l&&l[e]||D[e];return p?(i=i&&n.tmpl.tmpls[i-1],a=a||i||t,s.tmpl=""+a===a?c&&c[a]||_[a]||_(a):a,s.isTag=f,s.converter=r,s.view=n,s.renderContent=B,n.ctx&&o(s.ctx,n.ctx),u=p.apply(s,h.length>5?x.call(h,5):[]),u||(u==t?"":u.toString())):""}function O(e,n,i,s,o,u){var a=i.views,f={tmpl:o,path:n,parent:i,data:s,ctx:e,views:r.isArray(s)?[]:{},hlp:k};return r.isArray(a)?a.splice(f.index=u!==t?u:a.length,0,f):a[f.index="_"+g++]=f,f}function M(e,n,r,i,s){var o,a;if(r&&typeof r=="object"&&!r.nodeType){for(o in r)n(o,r[o]);return e}if(!r||i===t)s&&(i=s(t,i||r));else if(""+r===r)if(i===null)delete n[r];else if(i=s?s(r,i):i)n[r]=i;return(a=u.onStoreItem)&&a(n,r,i,s),i}function _(e,t){return M(this,_,e,t,q)}function D(e,t){return M(this,D,e,t)}function P(e,t){return M(this,P,e,t)}function H(e,t){return M(this,H,e,t)}function B(e,n,i,s,l){var c,h,p,d,v,m,g,y,b,w,E={},S=l===f,x=this,T="";x.isTag?(b=x.tmpl,n=n||x.ctx,i=i||x.view,s=s||x.path,l=l||x.index,E=x.props):b=x.jquery&&x[0]||x,i=i||N.topView,y=i.ctx,w=b.layout,e===i&&(e=i.data,w=f),n=n&&n===y?y:y?(y=o({},y),n)?o(y,n):y:n||{},E.link===a&&(n.link=a),b.fn||(b=_[b]||_(b)),v=n.link&&u.onRenderItem,m=n.link&&u.onRenderItems;if(b){if(r.isArray(e)&&!w){d=S?i:l!==t&&i||O(n,s,i,e,b,l);for(c=0,h=e.length;c<h;c++)p=e[c],g=b.fn(p,O(n,s,d,p,b,(l||0)+c),N),T+=v?v(g,E):g}else d=S?i:O(n,s,i,e,b,l),T+=e||w?b.fn(e,d,N):"";return i.topKey=d.index,m?m(T,s,d.index,b,E):T}return""}function j(){throw"Syntax error"}function F(e,t,n){function P(t){t-=A,t&&M.push(e.substr(A,t).replace(p,"\\n"))}function H(t,i,s,o,u,a,l,c,h,p){u&&(o=":",s="html");var v="",g="",y=!c&&!o;i=i||o,P(p),A=p+t.length,a?N&&M.push(["*",l.replace(d,"$1")]):i?(i==="else"&&(_[5]=e.substring(_[5],p),_=O.pop(),M=_[3],y=f),l=l?I(l,n).replace(m,function(e,t,n){return t?g+=n+",":v+=n+",",""}):"",v=v.slice(0,-1),l=l.slice(0,-1),r=[i,s||"",l,y&&[],"{"+(v?"props:{"+v+"},":"")+"path:'"+l+"'"+(g?",ctx:{"+g.slice(0,-1)+"}":"")+"}"],y&&(O.push(_),_=r,_[5]=A),M.push(r)):h&&(_[5]=e.substring(_[5],p),_=O.pop());if(!_)throw"Expected block tag";M=_[3]}var r,s,o,u,a,l,c,h,g,y,b,w,S,x,T,N,C=t?{allowCode:N=t.allowCode,debug:t.debug}:{},k=t&&t.tmpls,L=[],A=0,O=[],M=L,_=[,,,L],D=0;e=e.replace(v,"\\$1"),e.replace(i,H),P(e.length),u=L.length,a=u?"":'"";';for(o=0;o<u;o++)s=L[o],s[0]==="*"?a=a.slice(0,o?-1:-3)+";"+s[1]+(o+1<u?"ret+=":""):""+s===s?a+='"'+s+'"+':(b=s[0],w=s[1],S=s[2],M=s[3],x=s[4],e=s[5],M&&(T=R(e,C,t,D++),F(e,T),k.push(T)),y=y||x.indexOf("view")>-1,a+=(b===":"?w==="html"?(c=f,"e("+S):w?(g=f,'c("'+w+'",view,'+S):(h=f,"((v="+S+')!=u?v:""'):(l=f,'t("'+b+'",view,"'+(w||"")+'",'+(M?k.length:'""')+","+x+(S?",":"")+S))+")+");return a=new Function("data, view, j, b, u",E+(h?"v,":"")+(l?"t=j.tag,":"")+(g?"c=j.convert,":"")+(c?"e=j.converters.html,":"")+"ret; try{\n\n"+(C.debug?"debugger;":"")+(N?"ret=":"return ")+a.slice(0,-1)+";\n\n"+(N?"return ret;":"")+"}catch(e){return j.err(e);}"),t&&(t.fn=a,t.useVw=g||y||l),a}function I(e,t){function u(e,u,l,h,p,d,v,m,g,y,b,w,E,S,x,T){function N(e,n,r,i,s,o,u){if(n){var a=(r?'view.hlp("'+r+'")':i?"view":"data")+(u?(s?"."+s:r?"":i?"":"."+n)+(o||""):(u=r?"":i?s||"":n,""));return t&&g!=="("&&(a="b("+a+',"'+u+'")'),a+(u?"."+u:"")}return e}p=p||"",l=l||u||b,h=h||m,g=g||x||"",p=p||"";if(!d)return o?(o=!w,o?e:'"'):s?(s=!E,s?e:'"'):(l?(i++,l):"")+(T?i?"":n?(n=a,"\b"):",":v?(i&&j(),n=f,"\b"+h+":"):h?h.replace(c,N)+(g?(r[++i]=f,g):p):p?e:S?(r[i--]=a,S)+(g?(r[++i]=f,g):""):y?(r[i]||j(),","):u?"":(o=w,s=E,'"'));j()}var n,r={},i=0,s=a,o=a;return e=(e+" ").replace(h,u),e}function q(e,n,r,i){function p(t){if(""+t===t||t.nodeType>0)return a=t.nodeType>0?t:!s.test(t)&&l&&l(t)[0],a&&a.type&&(t=_[a.getAttribute(w)],t||(e=e||"_"+y++,a.setAttribute(w,e),t=q(e,a.innerHTML,r,i),_[e]=t)),t}var u,a,f,c,h;u=p(n),i=i||(n.markup?n:{}),i.name=e,c=i.templates,!u&&n.markup&&(u=p(n.markup))&&u.fn&&(u.debug!==n.debug||u.allowCode!==n.allowCode)&&(u=u.markup);if(u!==t){e&&!r&&(T[e]=function(){return n.render.apply(n,arguments)}),u.fn||n.fn?u.fn&&(e&&e!==u.name?n=o(o({},u),i):n=u):(n=R(u,i,r,0),F(u,n));for(f in c)h=c[f],h.name!==f&&(c[f]=q(f,h,n));return n}}function R(e,t,n,r){function i(e){n[e]&&(s[e]=o(o({},n[e]),t[e]))}t=t||{};var s={markup:e,tmpls:[],links:[],render:B};return n&&(n.templates&&(s.templates=o(o({},n.templates),t.templates)),s.parent=n,s.name=n.name+"["+r+"]",s.index=r),o(s,t),n&&(i("templates"),i("tags"),i("helpers"),i("converters")),s}function U(e){return b[e]||(b[e]="&#"+e.charCodeAt(0)+";")}var n="v1.0pre",r,i,s,o,u={},a=!1,f=!0,l=e.jQuery,c=/^(?:null|true|false|\d[\d.]*|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,h=/(\()(?=|\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,p=/\r?\n/g,d=/\\(['"])/g,v=/\\?(['"])/g,m=/\x08(~)?([^\x08]+)\x08/g,g=0,y=0,b={"&":"&amp;","<":"&lt;",">":"&gt;"},w="data-jsv-tmpl",E="var j=j||"+(l?"jQuery.":"js")+"views,",S=/[\x00"&'<>]/g,x=Array.prototype.slice,T={},N={jsviews:n,sub:u,debugMode:f,err:function(e){return N.debugMode?"<br/><b>Error:</b> <em> "+(e.message||e)+". </em>":'""'},tmplFn:F,render:T,templates:_,tags:D,helpers:P,converters:H,View:O,convert:L,delimiters:C,tag:A};l?(r=l,r.templates=_,r.render=T,r.views=N,r.fn.render=B):(r=e.jsviews=N,r.extend=function(e,t){var n;e=e||{};for(n in t)e[n]=t[n];return e},r.isArray=Array&&Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}),o=r.extend,N.topView={views:{},tmpl:{},hlp:k,ctx:N.helpers},D({"if":function(){var e=this,n=e.view;return n.onElse=function(e,r){var i=0,s=r.length;while(s&&!r[i++])if(i===s)return"";return n.onElse=t,e.path="",e.renderContent(n)},n.onElse(this,arguments)},"else":function(){var e=this.view;return e.onElse?e.onElse(this,arguments):""},"for":function(){var e,t=this,n="",r=arguments,i=r.length;t.props.layout&&(t.tmpl.layout=f);for(e=0;e<i;e++)n+=t.renderContent(r[e]);return n},"=":function(e){return e},"*":function(e){return e}}),H({html:function(e){return e!=t?String(e).replace(S,U):""}}),C("{{","}}")}(this),function(e){function r(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(i=n.wheelDelta/120),n.detail&&(i=-n.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(t,i,o,u),(e.event.dispatch||e.event.handle).apply(this,r)}var t=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var n=t.length;n;)e.event.fixHooks[t[--n]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],r,!1);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],r,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),$.widget||function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){return n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1],s=i+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][s]=function(n){return!!e.data(n,t)},e[i]=e[i]||{},e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var o=new n;o.options=e.extend(!0,{},o.options),e[i][t].prototype=e.extend(!0,o,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r),e.widget.bridge(t,e[i][t])},e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;return i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i,s&&i.charAt(0)==="_"?u:(s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t)return u=s,!1}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))}),u)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this),this.element=e(n),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={},i[n]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}}(jQuery),function(e,t,n){var r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;e.geo={_allCoordinates:function(t){var n=this._flatten(t),r=0,i=[];for(;r<n.length;r++){var s=n[r].coordinates,o=s&&e.isArray(s[0]),u=o&&e.isArray(s[0][0]),a=u&&e.isArray(s[0][0][0]),f,l,c;a||(u||(o||(s=[s]),s=[s]),s=[s]);for(f=0;f<s.length;f++)for(l=0;l<s[f].length;l++)for(c=0;c<s[f][l].length;c++)i.push(s[f][l][c])}return i},_isGeodetic:function(t){while(e.isArray(t)){if(t.length>1&&!e.isArray(t[0]))return t[0]>=-180&&t[0]<=180&&t[1]>=-85&&t[1]<=85;t=t[0]}return!1},center:function(t,n){var r=!1;!n&&e.geo.proj&&this._isGeodetic(t)&&(r=!0,t=e.geo.proj.fromGeodetic(t));var i=[(t[0]+t[2])/2,(t[1]+t[3])/2];return r?e.geo.proj.toGeodetic(i):i},expandBy:function(t,n,r,i){var s=!1;return!i&&e.geo.proj&&this._isGeodetic(t)&&(s=!0,t=e.geo.proj.fromGeodetic(t)),t=[t[0]-n,t[1]-r,t[2]+n,t[3]+r],s?e.geo.proj.toGeodetic(t):t},height:function(t,n){return!n&&e.geo.proj&&this._isGeodetic(t)&&(t=e.geo.proj.fromGeodetic(t)),t[3]-t[1]},_in:function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[2]&&e[3]>=t[3]},_bboxDisjoint:function(e,t){return t[0]>e[2]||t[2]<e[0]||t[1]>e[3]||t[3]<e[1]},include:function(t,n,s){if(!n||!e.isArray(n))return t;var o=!1;return!s&&e.geo.proj&&this._isGeodetic(t||n)&&(o=!0),t?o&&(t=e.geo.proj.fromGeodetic(t)):t=[r,r,i,i],n.length===2&&(n=[n[0],n[1],n[0],n[1]]),n=e.geo.proj.fromGeodetic(n),t[0]=Math.min(n[0],t[0]),t[1]=Math.min(n[1],t[1]),t[2]=Math.max(n[2],t[2]),t[3]=Math.max(n[3],t[3]),o?e.geo.proj.toGeodetic(t):t},polygonize:function(t,n){var r=!1;!n&&e.geo.proj&&this._isGeodetic(t)&&(r=!0,t=e.geo.proj.fromGeodetic(t));var i={type:"Polygon",coordinates:[[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]]};return r&&(i.coordinates=e.geo.proj.toGeodetic(i.coordinates)),i},reaspect:function(t,n,r){var i=!1;!r&&e.geo.proj&&this._isGeodetic(t)&&(i=!0,t=e.geo.proj.fromGeodetic(t));var s=this.width(t,!0),o=this.height(t,!0),u=this.center(t,!0),a,f;return s!==0&&o!==0&&n>0&&(s/o>n?(a=s/2,f=a/n):(f=o/2,a=f*n),t=[u[0]-a,u[1]-f,u[0]+a,u[1]+f]),i?e.geo.proj.toGeodetic(t):t},recenter:function(t,n,r){var i=!1;!r&&e.geo.proj&&(this._isGeodetic(t)&&(i=!0,t=e.geo.proj.fromGeodetic(t)),this._isGeodetic(n)&&(n=e.geo.proj.fromGeodetic(n)));var s=(t[2]-t[0])/2,o=(t[3]-t[1])/2;return t=[n[0]-s,n[1]-o,n[0]+s,n[1]+o],i?e.geo.proj.toGeodetic(t):t},scaleBy:function(t,n,r){var i=!1;!r&&e.geo.proj&&this._isGeodetic(t)&&(i=!0,t=e.geo.proj.fromGeodetic(t));var s=this.center(t,!0),o=(t[2]-t[0])*n/2,u=(t[3]-t[1])*n/2;return t=[s[0]-o,s[1]-u,s[0]+o,s[1]+u],i?e.geo.proj.toGeodetic(t):t},width:function(t,n){return!n&&e.geo.proj&&this._isGeodetic(t)&&(t=e.geo.proj.fromGeodetic(t)),t[2]-t[0]},bbox:function(t,s){var o,u=!1;if(!t)return n;if(t.bbox)o=!s&&e.geo.proj&&this._isGeodetic(t.bbox)?e.geo.proj.fromGeodetic(t.bbox):t.bbox;else{o=[r,r,i,i];var a=this._allCoordinates(t),f=0;if(a.length===0)return n;!s&&e.geo.proj&&this._isGeodetic(a)&&(u=!0,a=e.geo.proj.fromGeodetic(a));for(;f<a.length;f++)o[0]=Math.min(a[f][0],o[0]),o[1]=Math.min(a[f][1],o[1]),o[2]=Math.max(a[f][0],o[2]),o[3]=Math.max(a[f][1],o[3])}return u?e.geo.proj.toGeodetic(o):o},centroid:function(t,s){switch(t.type){case"Point":return e.extend({},t);case"LineString":case"Polygon":var o=0,u=[0,0],a=e.merge([],t.type=="Polygon"?t.coordinates[0]:t.coordinates),f=1,l,c,h=[r,r,i,i],p=!1;!s&&e.geo.proj&&this._isGeodetic(a)&&(p=!0,a=e.geo.proj.fromGeodetic(a));for(;f<=a.length;f++)l=f%a.length,h[0]=Math.min(a[l][0],h[0]),h[1]=Math.min(a[l][1],h[1]),h[2]=Math.max(a[l][0],h[2]),h[3]=Math.max(a[l][1],h[3]),c=a[f-1][0]*a[l][1]-a[l][0]*a[f-1][1],o+=c,u[0]+=(a[f-1][0]+a[l][0])*c,u[1]+=(a[f-1][1]+a[l][1])*c;if(o===0)return a.length>0?(u[0]=Math.min(Math.max(a[0][0],h[0]),h[2]),u[1]=Math.min(Math.max(a[0][1],h[1]),h[3]),{type:"Point",coordinates:p?e.geo.proj.toGeodetic(u):u}):n;return o*=3,u[0]=Math.min(Math.max(u[0]/o,h[0]),h[2]),u[1]=Math.min(Math.max(u[1]/o,h[1]),h[3]),{type:"Point",coordinates:p?e.geo.proj.toGeodetic(u):u}}return n},contains:function(e,t){if(e.type!="Polygon")return!1;switch(t.type){case"Point":return this._containsPolygonPoint(e.coordinates,t.coordinates);case"LineString":return this._containsPolygonLineString(e.coordinates,t.coordinates);case"Polygon":return this._containsPolygonLineString(e.coordinates,t.coordinates[0]);default:return!1}},_containsPolygonPoint:function(e,t){if(e.length===0||e[0].length<4)return!1;var n=0,r=e[0][0],i=1,s,o;for(;i<e[0].length;i++){s=e[0][i];if(r[1]<=t[1]&&t[1]<s[1]||s[1]<=t[1]&&t[1]<r[1]&&(t[0]<r[0]||t[0]<s[0]))o=r[0]+(s[0]-r[0])*(t[1]-r[1])/(s[1]-r[1]),o>t[0]&&n++;r=s}return n%2==1},_containsPolygonLineString:function(e,t){for(var n=0;n<t.length;n++)if(!this._containsPolygonPoint(e,t[n]))return!1;return!0},distance:function(t,r,i){var s=!i&&e.geo.proj&&this._isGeodetic(t.coordinates)?e.geo.proj.fromGeodetic(t.coordinates):t.coordinates,o=!i&&e.geo.proj&&this._isGeodetic(r.coordinates)?e.geo.proj.fromGeodetic(r.coordinates):r.coordinates;switch(t.type){case"Point":switch(r.type){case"Point":return this._distancePointPoint(o,s);case"LineString":return this._distanceLineStringPoint(o,s);case"Polygon":return this._containsPolygonPoint(o,s)?0:this._distanceLineStringPoint(o[0],s);default:return n}break;case"LineString":switch(r.type){case"Point":return this._distanceLineStringPoint(s,o);case"LineString":return this._distanceLineStringLineString(s,o);case"Polygon":return this._containsPolygonLineString(o,s)?0:this._distanceLineStringLineString(o[0],s);default:return n}break;case"Polygon":switch(r.type){case"Point":return this._containsPolygonPoint(s,o)?0:this._distanceLineStringPoint(s[0],o);case"LineString":return this._containsPolygonLineString(s,o)?0:this._distanceLineStringLineString(s[0],o);case"Polygon":return this._containsPolygonLineString(s,o[0])?0:this._distanceLineStringLineString(s[0],o[0]);default:return n}}},_distancePointPoint:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},_distanceLineStringPoint:function(e,t){var n=r;if(e.length>0){var i=e[0],s=t[0]-i[0],o=t[1]-i[1];if(e.length==1)return Math.sqrt(s*s+o*o);for(var u=1;u<e.length;u++){var a=e[u],f=a[0]-i[0],l=a[1]-i[1],c=t[0]-a[0],h=t[1]-a[1],p=this._distanceSegmentPoint(f,l,s,o,c,h);if(p===0)return 0;p<n&&(n=p),i=a,s=c,o=h}}return Math.sqrt(n)},_distanceSegmentPoint:function(e,t,n,r,i,s){var o=e*n+t*r;if(o<=0)return n*n+r*r;var u=e*e+t*t;return o>=u?i*i+s*s:n*n+r*r-o*o/u},_distanceLineStringLineString:function(e,t){var n=r;for(var i=0;i<t.length;i++)n=Math.min(n,this._distanceLineStringPoint(e,t[i]));return n},_buffer:function(t,r,i){var s=!1,o=t.coordinates;!i&&e.geo.proj&&this._isGeodetic(t.coordinates)&&(s=!0,o=e.geo.proj.fromGeodetic(t.coordinates));if(t.type==="Point"){var u=[],a=180,f=0,l;for(;f<=a;f++)l=f*360/a*(Math.PI/180),u.push([o[0]+Math.cos(l)*r,o[1]+Math.sin(l)*r]);return{type:"Polygon",coordinates:[s?e.geo.proj.toGeodetic(u):u]}}return n},_flatten:function(t){var n=[],r=0;switch(t.type){case"Feature":e.merge(n,this._flatten(t.geometry));break;case"FeatureCollection":for(;r<t.features.length;r++)e.merge(n,this._flatten(t.features[r].geometry));break;case"GeometryCollection":for(;r<t.geometries.length;r++)e.merge(n,this._flatten(t.geometries[r]));break;default:n[0]=t}return n},length:function(t,n){var r=0,i,s=1,o,u;switch(t.type){case"Point":return 0;case"LineString":i=t.coordinates;break;case"Polygon":i=t.coordinates[0]}if(i){!n&&e.geo.proj&&this._isGeodetic(i)&&(i=e.geo.proj.fromGeodetic(i));for(;s<i.length;s++)o=i[s][0]-i[s-1][0],u=i[s][1]-i[s-1][1],r+=Math.sqrt(o*o+u*u);return r}},area:function(t,n){var r=0,i,s=1,o;switch(t.type){case"Point":case"LineString":return 0;case"Polygon":i=t.coordinates[0]}if(i){!n&&e.geo.proj&&this._isGeodetic(i)&&(i=e.geo.proj.fromGeodetic(i));for(;s<=i.length;s++)o=s%i.length,r+=(i[s-1][0]-i[o][0])*(i[s-1][1]+i[o][1])/2;return Math.abs(r)}},pointAlong:function(t,n,r){var i=0,s=0,o=0,u,a,f,l=[],c=1,h,p,d,v,m,g=!1;switch(t.type){case"Point":return e.extend({},t);case"LineString":f=t.coordinates;break;case"Polygon":f=t.coordinates[0]}if(f){if(n===0)return{type:"Point",coordinates:[f[0][0],f[0][1]]};if(n===1)return c=f.length-1,{type:"Point",coordinates:[f[c][0],f[c][1]]};!r&&e.geo.proj&&this._isGeodetic(f)&&(g=!0,f=e.geo.proj.fromGeodetic(f));for(;c<f.length;c++)h=f[c][0]-f[c-1][0],p=f[c][1]-f[c-1][1],a=Math.sqrt(h*h+p*p),l.push(a),i+=a;for(c=0;c<l.length&&o<n;c++)s=o,o+=l[c]/i;return u=n-s,v=f[c-1],m=f[c],d=[v[0]+u*(m[0]-v[0]),v[1]+u*(m[1]-v[1])],{type:"Point",coordinates:g?e.geo.proj.toGeodetic(d):d}}},_WKT:function(){function t(e){return"POINT "+n(e.coordinates)}function n(e){return!e||!e.length?"EMPTY":"("+e.join(" ")+")"}function r(e){return"LINESTRING "+i(e.coordinates)}function i(e){if(!e||!e.length)return"EMPTY";var t=[];for(var n=0;n<e.length;n++)t.push(e[n].join(" "));return"("+t+")"}function s(e){return"POLYGON "+o(e.coordinates)}function o(e){if(!e||!e.length)return"EMTPY";var t=[];for(var n=0;n<e.length;n++)t.push(i(e[n]));return"("+t+")"}function u(e){return"MULTIPOINT "+i(e.coordinates)}function a(e){return"MULTILINSTRING "+o(e.coordinates)}function f(e){return"MULTIPOLYGON "+l(e.coordinates)}function l(e){if(!e||!e.length)return"EMPTY";var t=[];for(var n=0;n<e.length;n++)t.push(o(e[n]));return"("+t+")"}function c(e){return"GEOMETRYCOLLECTION "+h(e.geometries)}function h(e){if(!e||!e.length)return"EMPTY";var t=[];for(var n=0;n<e.length;n++)t.push(p(e[n]));return"("+e+")"}function p(e){if(!e||!e.type)return"";switch(e.type){case"Point":return t(e);case"LineString":return r(e);case"Polygon":return s(e);case"MultiPoint":return u(e);case"MultiLineString":return a(e);case"MultiPolygon":return f(e);case"GeometryCollection":return c(e);default:return""}}function d(e){var t=e.match(/\(\s*([\d\.\-]+)\s+([\d\.\-]+)\s*\)/);return t&&t.length>2?{type:"Point",coordinates:[parseFloat(t[1]),parseFloat(t[2])]}:null}function v(e){var t=e.match(/\s*\((.*)\)/),n=[],r,i,s=0;if(t&&t.length>1){r=t[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);for(;s<r.length;s++)i=r[s].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),n[s]=[parseFloat(i[1]),parseFloat(i[2])];return{type:"LineString",coordinates:n}}return null}function m(e){var t=e.match(/\s*\(\s*\((.*)\)\s*\)/),n=[],r,i,s=0;if(t&&t.length>1){r=t[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);for(;s<r.length;s++)i=r[s].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),n[s]=[parseFloat(i[1]),parseFloat(i[2])];return{type:"Polygon",coordinates:[n]}}return null}function g(t){var n;return t.indexOf("((")===-1?n=v(t):(n=y(t),n.coordinates=e.geo._allCoordinates(n)),n.type="MultiPoint",n}function y(e){var t=e.substr(1,e.length-2),n=t.split(")),(("),r=0,i={type:"MultiLineString",coordinates:[]};for(;r<n.length;r++)i.coordinates.push(v(n[r]).coordinates);return i}function b(e){var t=e.substr(1,e.length-2),n=t.split(")),(("),r=0,i={type:"MultiPolygon",coordinates:[]};for(;r<n.length;r++)i.coordinates.push(m(n[r]).coordinates);return i}function w(e){var t=e.substr(1,e.length-2),n=t.match(/\),[a-zA-Z]/g),r={type:"GeometryCollection",geometries:[]},i,s=0,o=0,u;if(n&&n.length>0){for(;s<n.length;s++)u=t.indexOf(n[s],o)-o+1,i=E(t.substr(o,u)),i&&r.geometries.push(i),o+=u+1;return i=E(t.substr(o)),i&&r.geometries.push(i),r}return null}function E(t){t=e.trim(t);var n=t.indexOf("("),r=t.substr(n);switch(e.trim(t.substr(0,n)).toUpperCase()){case"POINT":return d(r);case"LINESTRING":return v(r);case"POLYGON":return m(r);case"MULTIPOINT":return g(r);case"MULTILINESTRING":return y(r);case"MULTIPOLYGON":return b(r);case"GEOMETRYCOLLECTION":return w(r);default:return null}}return{stringify:p,parse:E}}(),proj:function(){var t=1.5707963267948966,n=.7853981633974483,r=.017453292519943295,i=57.29577951308232,s=6378137;return{fromGeodeticPos:function(e){return[s*e[0]*r,s*Math.log(Math.tan(n+e[1]*r/2))]},fromGeodetic:function(t){if(!e.geo._isGeodetic(t))return t;var n=e.isArray(t[0]),r=this.fromGeodeticPos;if(!n&&t.length==4){var i=r([t[0],t[1]]),s=r([t[2],t[3]]);return[i[0],i[1],s[0],s[1]]}var o=n&&e.isArray(t[0][0]),u=o&&e.isArray(t[0][0][0]),a=[],f,l,c;u||(o||(n||(t=[t]),t=[t]),t=[t]);for(f=0;f<t.length;f++){a[f]=[];for(l=0;l<t[f].length;l++){a[f][l]=[];for(c=0;c<t[f][l].length;c++)a[f][l][c]=r(t[f][l][c])}}return u?a:o?a[0]:n?a[0][0]:a[0][0][0]},toGeodeticPos:function(e){return[e[0]/s*i,(t-2*Math.atan(1/Math.exp(e[1]/s)))*i]},toGeodetic:function(t){if(e.geo._isGeodetic(t))return t;var n=e.isArray(t[0]),r=this.toGeodeticPos;if(!n&&t.length==4){var i=r([t[0],t[1]]),s=r([t[2],t[3]]);return[i[0],i[1],s[0],s[1]]}var o=n&&e.isArray(t[0][0]),u=o&&e.isArray(t[0][0][0]),a=[],f,l,c;u||(o||(n||(t=[t]),t=[t]),t=[t]);for(f=0;f<t.length;f++){a[f]=[];for(l=0;l<t[f].length;l++){a[f][l]=[];for(c=0;c<t[f][l].length;c++)a[f][l][c]=r(t[f][l][c])}}return u?a:o?a[0]:n?a[0][0]:a[0][0][0]}}}(),_serviceTypes:{}}}(jQuery,this),function(e,t){var n=function(){var e=5,t=document.createElement("div"),n=t.all||[];do t.innerHTML="<!--[if gt IE "+ ++e+"]><br><![endif]-->";while(n[0]);return e>6?e:!e}();e.widget("geo.geographics",{_$elem:t,_options:{},_trueCanvas:!0,_trueDoubleBuffer:!0,_width:0,_height:0,_$canvas:t,_context:t,_$canvasSceneFront:t,_$canvasSceneBack:t,_timeoutEnd:null,_requireFlip:!1,_blitcanvas:t,_blitcontext:t,_$labelsContainerFront:t,_$labelsContainerBack:t,_labelsHtml:"",options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"},doubleBuffer:!0},_create:function(){this._$elem=this.element,this._options=this.options,this._$elem.css({webkitTransform:"translateZ(0)",display:"inline-block",overflow:"hidden",textAlign:"left"}),this._$elem.css("position")=="static"&&this._$elem.css("position","relative"),this._$elem.addClass("geo-graphics"),this._width=this._$elem.width(),this._height=this._$elem.height();if(!this._width||!this._height)this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10);var t="position:absolute;left:0;top:0;margin:0;padding:0;",r="width:"+this._width+"px;height:"+this._height+"px;",i='width="'+this._width+'" height="'+this._height+'"';this._blitcanvas=document.createElement("canvas"),this._blitcanvas.getContext?(this._$canvas=e("<canvas "+i+' style="-webkit-transform:translateZ(0);'+t+'"></canvas>'),this._blitcanvas.width=1,this._blitcanvas.height=1,this._trueDoubleBuffer=this._blitcanvas.toDataURL().length>6,(!this._options.doubleBuffer||!this._trueDoubleBuffer)&&this._$elem.append(this._$canvas),this._context=this._$canvas[0].getContext("2d"),this._blitcanvas.width=this._width,this._blitcanvas.height=this._height,this._blitcontext=this._blitcanvas.getContext("2d"),this._$canvasSceneFront=e('<img id="scene0" style="-webkit-transform:translateZ(0);'+t+r+'" />'),this._$canvasSceneBack=e('<img id="scene1" style="-webkit-transform:translateZ(0);'+t+r+'" />')):n<=8&&(this._trueCanvas=!1,this._$elem.append("<div "+i+' style="'+t+r+'"></div>'),this._$canvas=this._$elem.children(":last"),G_vmlCanvasManager.initElement(this._$canvas[0]),this._context=this._$canvas[0].getContext("2d"),this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})),this._$labelsContainerFront=e('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+t+r+'"></div>'),this._$labelsContainerBack=e('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+t+r+'"></div>')},_setOption:function(t,n){t=="style"&&(n=e.extend({},this._options.style,n)),e.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments),this._$elem.html(""),this._$elem.removeClass("geo-graphics")},clear:function(){this._context.clearRect(0,0,this._width,this._height),this._labelsHtml="",this._end()},drawArc:function(e,t,n,r){r=this._getGraphicStyle(r);if(r.visibility!="hidden"&&r.opacity>0&&r.widthValue>0&&r.heightValue>0){var i=Math.min(r.widthValue,r.heightValue)/2;t=t*Math.PI/180,n=n*Math.PI/180,this._context.save(),this._context.translate(e[0],e[1]),r.widthValue>r.heightValue?this._context.scale(r.widthValue/r.heightValue,1):this._context.scale(1,r.heightValue/r.widthValue),this._context.beginPath(),this._context.arc(0,0,i,t,n,!1),this._trueCanvas&&this._context.restore(),r.doFill&&(this._context.fillStyle=r.fill,this._context.globalAlpha=r.opacity*r.fillOpacity,this._context.fill()),r.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=r.strokeWidthValue,this._context.strokeStyle=r.stroke,this._context.globalAlpha=r.opacity*r.strokeOpacity,this._context.stroke()),this._trueCanvas||this._context.restore()}this._end()},drawPoint:function(e,t){t=this._getGraphicStyle(t),t.widthValue==t.heightValue&&t.heightValue==t.borderRadiusValue?this.drawArc(e,0,360,t):t.visibility!="hidden"&&t.opacity>0&&(t.borderRadiusValue=Math.min(Math.min(t.widthValue,t.heightValue)/2,t.borderRadiusValue),e[0]-=t.widthValue/2,e[1]-=t.heightValue/2,this._context.beginPath(),this._context.moveTo(e[0]+t.borderRadiusValue,e[1]),this._context.lineTo(e[0]+t.widthValue-t.borderRadiusValue,e[1]),this._context.quadraticCurveTo(e[0]+t.widthValue,e[1],e[0]+t.widthValue,e[1]+t.borderRadiusValue),this._context.lineTo(e[0]+t.widthValue,e[1]+t.heightValue-t.borderRadiusValue),this._context.quadraticCurveTo(e[0]+t.widthValue,e[1]+t.heightValue,e[0]+t.widthValue-t.borderRadiusValue,e[1]+t.heightValue),this._context.lineTo(e[0]+t.borderRadiusValue,e[1]+t.heightValue),this._context.quadraticCurveTo(e[0],e[1]+t.heightValue,e[0],e[1]+t.heightValue-t.borderRadiusValue),this._context.lineTo(e[0],e[1]+t.borderRadiusValue),this._context.quadraticCurveTo(e[0],e[1],e[0]+t.borderRadiusValue,e[1]),this._context.closePath(),t.doFill&&(this._context.fillStyle=t.fill,this._context.globalAlpha=t.opacity*t.fillOpacity,this._context.fill()),t.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=t.strokeWidthValue,this._context.strokeStyle=t.stroke,this._context.globalAlpha=t.opacity*t.strokeOpacity,this._context.stroke()),this._end())},drawLineString:function(e,t){this._drawLines([e],!1,t)},drawPolygon:function(e,t){if(!this._trueCanvas||e.length==1)this._drawLines(e,!0,t);else{if(!e||!e.length||e[0].length<3)return;t=this._getGraphicStyle(t);var n,r,i;if(t.visibility!="hidden"&&t.opacity>0){this._blitcontext.clearRect(0,0,this._width,this._height);if(t.doFill&&e.length>1){this._blitcontext.globalCompositeOperation="source-out",this._blitcontext.globalAlpha=1;for(r=1;r<e.length;r++){this._blitcontext.beginPath(),this._blitcontext.moveTo(e[r][0][0],e[r][0][1]);for(i=1;i<e[r].length;i++)this._blitcontext.lineTo(e[r][i][0],e[r][i][1]);this._blitcontext.closePath(),this._blitcontext.fill()}}this._blitcontext.beginPath(),this._blitcontext.moveTo(e[0][0][0],e[0][0][1]),n=[e[0][0][0]-t.strokeWidthValue,e[0][0][1]-t.strokeWidthValue,e[0][0][0]+t.strokeWidthValue,e[0][0][1]+t.strokeWidthValue];for(r=1;r<e[0].length-1;r++)this._blitcontext.lineTo(e[0][r][0],e[0][r][1]),n[0]=Math.min(e[0][r][0]-t.strokeWidthValue,n[0]),n[1]=Math.min(e[0][r][1]-t.strokeWidthValue,n[1]),n[2]=Math.max(e[0][r][0]+t.strokeWidthValue,n[2]),n[3]=Math.max(e[0][r][1]+t.strokeWidthValue,n[3]);this._blitcontext.closePath(),this._blitcontext.globalCompositeOperation="source-out",t.doFill&&(this._blitcontext.fillStyle=t.fill,this._blitcontext.globalAlpha=t.opacity*t.fillOpacity,this._blitcontext.fill()),this._blitcontext.globalCompositeOperation="source-over";if(t.doStroke){this._blitcontext.lineCap=this._blitcontext.lineJoin="round",this._blitcontext.lineWidth=t.strokeWidthValue,this._blitcontext.strokeStyle=t.stroke,this._blitcontext.globalAlpha=t.opacity*t.strokeOpacity,this._blitcontext.stroke();if(e.length>1)for(r=1;r<e.length;r++){this._blitcontext.beginPath(),this._blitcontext.moveTo(e[r][0][0],e[r][0][1]);for(i=1;i<e[r].length;i++)this._blitcontext.lineTo(e[r][i][0],e[r][i][1]);this._blitcontext.closePath(),this._blitcontext.stroke()}}n[0]=Math.min(Math.max(n[0],0),this._width),n[1]=Math.min(Math.max(n[1],0),this._height),n[2]=Math.min(Math.max(n[2],0),this._width),n[3]=Math.min(Math.max(n[3],0),this._height),n[0]!==n[2]&&n[1]!==n[3]&&(this._context.drawImage(this._blitcanvas,n[0],n[1],n[2]-n[0],n[3]-n[1],n[0],n[1],n[2]-n[0],n[3]-n[1]),this._end())}}},drawBbox:function(e,t){this._drawLines([[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]],!0,t)},drawLabel:function(e,t){this._labelsHtml+='<div class="geo-label" style="-webkit-transform:translateZ(0);position:absolute; left:'+e[0]/this._width*100+"%; top:"+e[1]/this._height*100+'%;">'+t+"</div>"},resize:function(){this._width=this._$elem.width(),this._height=this._$elem.height();if(!this._width||!this._height)this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10);this._trueCanvas?(this._$canvas[0].width=this._width,this._$canvas[0].height=this._height,this._$canvasSceneFront.css({width:this._width,height:this._height}),this._$canvasSceneBack.css({width:this._width,height:this._height})):this._$canvas.css({width:this._width,height:this._height}),this._$labelsContainerFront.css({width:this._width,height:this._height}),this._$labelsContainerBack.css({width:this._width,height:this._height})},interactiveTransform:function(e,t){this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null);if(this._trueCanvas)if(this._options.doubleBuffer&&this._trueDoubleBuffer){if(this._requireFlip){var n=this,r=n._$canvasSceneFront;n._$canvasSceneFront=n._$canvasSceneBack.css({left:0,top:0,width:n._width,height:n._height}).prop("src",n._$canvas[0].toDataURL()).prependTo(n._$elem),n._$canvasSceneBack=r.detach(),n._requireFlip=!1}this._$canvasSceneFront.css({left:Math.round(e[0]),top:Math.round(e[1]),width:this._width*t,height:this._height*t})}else this._context.clearRect(0,0,this._width,this._height);else this._context.clearRect(0,0,this._width,this._height);this._$labelsContainerFront.css({left:Math.round(e[0]),top:Math.round(e[1]),width:this._width*t,height:this._height*t})},_end:function(){function t(){if(!e._timeoutEnd)return;e._trueCanvas&&e._options.doubleBuffer&&e._trueDoubleBuffer&&e._$canvasSceneBack.prop("src","").one("load",function(t){e._requireFlip=!1;var n=e._$canvasSceneFront;e._$canvasSceneFront=e._$canvasSceneBack.css({left:0,top:0,width:e._width,height:e._height}).prependTo(e._$elem),e._$canvasSceneBack=n.detach()}).prop("src",e._$canvas[0].toDataURL()),e._$labelsContainerBack.html(e._labelsHtml);var t=e._$labelsContainerFront;e._$labelsContainerFront=e._$labelsContainerBack.css({left:0,top:0,width:e._width,height:e._height}).prependTo(e._$elem),e._$labelsContainerBack=t.detach(),e._timeoutEnd=null}this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null),this._requireFlip=!0;var e=this;this._timeoutEnd=setTimeout(t,20)},_getGraphicStyle:function(t){function n(e){return e=parseInt(e,10),+e+""===e?+e:e}return t=e.extend({},this._options.style,t),t.borderRadiusValue=n(t.borderRadius),t.fill=t.fill||t.color,t.doFill=t.fill&&t.fillOpacity>0,t.stroke=t.stroke||t.color,t.strokeWidthValue=n(t.strokeWidth),t.doStroke=t.stroke&&t.strokeOpacity>0&&t.strokeWidthValue>0,t.widthValue=n(t.width),t.heightValue=n(t.height),t},_drawLines:function(e,t,n){if(!e||!e.length||e[0].length<2)return;var r,i;n=this._getGraphicStyle(n);if(n.visibility!="hidden"&&n.opacity>0){this._context.beginPath();for(r=0;r<e.length;r++){this._context.moveTo(e[r][0][0],e[r][0][1]);for(i=1;i<e[r].length;i++)this._context.lineTo(e[r][i][0],e[r][i][1])}t&&this._context.closePath(),t&&n.doFill&&(this._context.fillStyle=n.fill,this._context.globalAlpha=n.opacity*n.fillOpacity,this._context.fill()),n.doStroke&&(this._context.lineCap=this._context.lineJoin="round",this._context.lineWidth=n.strokeWidthValue,this._context.strokeStyle=n.stroke,this._context.globalAlpha=n.opacity*n.strokeOpacity,this._context.stroke()),this._end()}}})}(jQuery),function(e,t){var n=0,r=function(){var e=5,t=document.createElement("div"),n=t.all||[];do t.innerHTML="<!--[if gt IE "+ ++e+"]><br><![endif]-->";while(n[0]);return e>6?e:!e}(),i={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{"static":"default",pan:"url(data:image/vnd.microsoft.icon;base64,AAACAAEAICACAAgACAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=), move",zoom:"crosshair",dragBox:"crosshair",dragCircle:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{:length.toFixed( 2 )}} m",area:"{{:area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",pannable:!0,scroll:"default",shift:"default",services:[{"class":"osm",type:"tiled",src:function(e){return"http://otile"+(e.index%4+1)+".mqcdn.com/tiles/1.0.0/osm/"+e.zoom+"/"+e.tile.column+"/"+e.tile.row+".png"},attr:"Tiles Courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png'>"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:6,basePixelSize:2445.98490512499,origin:[-20037508.342787,20037508.342787]},axisLayout:"map",zoom:0,zoomMin:0,zoomMax:Number.POSITIVE_INFINITY,pixelSize:0};e.widget("geo.geomap",{_$elem:t,_map:t,_created:!1,_createdGraphics:!1,_widgetId:0,_tmplLengthId:"",_tmplAreaId:"",_contentBounds:{},_$resizeContainer:t,_$eventTarget:t,_$contentFrame:t,_$existingChildren:t,_$attrList:t,_$servicesContainer:t,_$shapesContainers:t,_$panContainer:t,_$shapesContainer:t,_$drawContainer:t,_$measureContainer:t,_$measureLabel:t,_dpi:96,_currentServices:[],_center:t,_pixelSize:t,_centerMax:t,_pixelSizeMax:t,_userGeodetic:!0,_centerInteractive:t,_pixelSizeInteractive:t,_timeoutInteractive:null,_triggerInteractive:!1,_timeoutRefreshShapes:null,_loadCount:0,_wheelTimeout:null,_wheelLevel:0,_zoomFactor:2,_fullZoomFactor:2,_partialZoomFactor:1.18920711500273,_mouseDown:t,_inOp:t,_toolPan:t,_shiftDown:t,_anchor:t,_current:t,_downDate:t,_moveDate:t,_clickDate:t,_lastMove:t,_lastDrag:t,_windowHandler:null,_resizeTimeout:null,_panning:t,_velocity:t,_friction:t,_supportTouch:t,_softDblClick:t,_isTap:t,_isDbltap:t,_isMultiTouch:t,_multiTouchAnchor:[],_multiTouchAnchorBbox:t,_multiTouchCurrentBbox:t,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:e.extend({},i),_createWidget:function(t,r){this._$elem=e(r);if(this._$elem.is(".geo-service")){this._graphicShapes=[],e.Widget.prototype._createWidget.apply(this,arguments);return}this._widgetId=n++,this._tmplLengthId="geoMeasureLength"+this._widgetId,this._tmplAreaId="geoMeasureArea"+this._widgetId,this._$elem.addClass("geo-map").css({webkitTransform:"translateZ(0)"}),this._initOptions=t||{},this._forcePosition(this._$elem),this._$elem.css("text-align","left");var i=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:i.width,height:i.height},this._createChildren(),this._center=[0,0],this._centerMax=[0,0],this._centerInteractive=[0,0],this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935,this._mouseDown=this._inOp=this._toolPan=this._shiftDown=this._panning=this._isTap=this._isDbltap=!1,this._anchor=[0,0],this._current=[0,0],this._lastMove=[0,0],this._lastDrag=[0,0],this._velocity=[0,0],this._friction=[.8,.8],this._downDate=this._moveDate=this._clickDate=0,this._drawPixels=[],this._drawCoords=[],this._graphicShapes=[],e.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){this._options=this.options;if(this._$elem.is(".geo-service")){this._map=this._$elem.data("geoMap"),this._$elem.data("geoService",this);return}this._map=this,this._supportTouch="ontouchend"in document,this._softDblClick=this._supportTouch||r==7;var n=this,i=this._supportTouch?"touchstart":"mousedown",s=this._supportTouch?"touchend touchcancel":"mouseup",o=this._supportTouch?"touchmove":"mousemove";e(document).keydown(e.proxy(this._document_keydown,this)),this._$eventTarget.dblclick(e.proxy(this._eventTarget_dblclick,this)),this._$eventTarget.bind(i,e.proxy(this._eventTarget_touchstart,this));var u=this._$eventTarget[0].setCapture?this._$eventTarget:e(document);u.bind(o,e.proxy(this._dragTarget_touchmove,this)),u.bind(s,e.proxy(this._dragTarget_touchstop,this)),this._$eventTarget.mousewheel(e.proxy(this._eventTarget_mousewheel,this)),this._windowHandler=function(){n._resizeTimeout&&clearTimeout(n._resizeTimeout),n._resizeTimeout=setTimeout(function(){n._created&&n._$elem.geomap("resize",!0)},500)},e(window).resize(this._windowHandler),this._$drawContainer.geographics({style:this._initOptions.drawStyle||{},doubleBuffer:!1}),this._options.drawStyle=this._$drawContainer.geographics("option","style"),this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}}),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style"),this._initOptions&&(this._initOptions.tilingScheme!==t&&this._setOption("tilingScheme",this._initOptions.tilingScheme||null,!1),this._initOptions.services&&(this._options.services=e.merge([],this._initOptions.services)),this._initOptions.bboxMax&&(this._setOption("bboxMax",this._initOptions.bboxMax,!1),this._setOption("bbox",this._initOptions.bboxMax,!1)),this._initOptions.zoomMin!==t&&this._setOption("zoomMin",this._initOptions.zoomMin,!1),this._initOptions.zoomMax!==t&&this._setOption("zoomMax",this._initOptions.zoomMax,!1),this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,!1),this._initOptions.center&&this._setOption("center",this._initOptions.center,!1),this._initOptions.zoom!==t&&this._setOption("zoom",this._initOptions.zoom,!1)),e.templates(this._tmplLengthId,this._options.measureLabels.length),e.templates(this._tmplAreaId,this._options.measureLabels.area),this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._createServices(),this._refresh(),this._created=!0},_setOption:function(n,r,i){if(n=="pixelSize")return;i=i===t||i,this._$elem.is(".geo-map")&&this._panFinalize();var s,o,u,a;switch(n){case"bbox":this._created&&this._clearInteractiveTimeout(),this._userGeodetic=e.geo.proj&&e.geo._isGeodetic(r),this._userGeodetic&&(r=e.geo.proj.fromGeodetic(r)),s=[r[0]+(r[2]-r[0])/2,r[1]+(r[3]-r[1])/2],o=Math.max(e.geo.width(r,!0)/this._contentBounds.width,e.geo.height(r,!0)/this._contentBounds.height),a=this._getZoom(s,o),this._options.tilingScheme?o=this._getPixelSize(Math.min(Math.max(a,this._options.zoomMin),this._options.zoomMax)):a<this._options.zoomMin?o=this._getPixelSize(this._options.zoomMin):a>this._options.zoomMax&&(o=this._getPixelSize(this._options.zoomMax)),this._created?(this._setInteractiveCenterAndSize(s,o),this._setInteractiveTimeout(!1)):this._setCenterAndSize(s,o,!1,i),r=this._getBbox(s,o);break;case"bboxMax":this._userGeodetic=e.geo.proj&&e.geo._isGeodetic(r);break;case"center":this._created&&this._clearInteractiveTimeout(),this._userGeodetic=e.geo.proj&&e.geo._isGeodetic(r),this._userGeodetic&&(r=e.geo.proj.fromGeodetic(r)),this._created?(this._setInteractiveCenterAndSize(r,this._pixelSizeInteractive),this._interactiveTransform(),this._setInteractiveTimeout(!1)):this._setCenterAndSize(r,this._pixelSize,!1,i);break;case"measureLabels":r=e.extend(this._options.measureLabels,r),e.templates(this._tmplLengthId,this._options.measureLabels.length),e.templates(this._tmplAreaId,this._options.measureLabels.area);break;case"drawStyle":this._$drawContainer&&(this._$drawContainer.geographics("option","style",r),r=this._$drawContainer.geographics("option","style"));break;case"shapeStyle":this._$elem.is(".geo-service")&&!this._createdGraphics&&this._createServiceGraphics(),this._createdGraphics&&(this._$shapesContainer.geographics("option","style",r),r=this._$shapesContainer.geographics("option","style"));break;case"mode":this._resetDrawing(),this._$eventTarget.css("cursor",this._options.cursors[r]);break;case"zoom":this._created?this._setZoom(r,!1,i):(r=Math.max(r,0),this._setCenterAndSize(this._center,this._getPixelSize(r),!1,i))}e.Widget.prototype._setOption.apply(this,arguments);switch(n){case"bbox":case"center":this._userGeodetic&&(this._options.bbox=e.geo.proj.toGeodetic(this._options.bbox),this._options.center=e.geo.proj.toGeodetic(this._center));break;case"tilingScheme":r!==null&&(this._pixelSizeMax=this._getPixelSize(0),this._centerMax=[r.origin[0]+this._pixelSizeMax*r.tileWidth/2,r.origin[1]+this._pixelSizeMax*r.tileHeight/2]);break;case"bboxMax":e.geo.proj&&e.geo._isGeodetic(r)?u=e.geo.proj.fromGeodetic(r):u=r,this._centerMax=e.geo.center(u),this._pixelSizeMax=Math.max(e.geo.width(u,!0)/this._contentBounds.width,e.geo.height(u,!0)/this._contentBounds.height);break;case"services":this._createServices(),i&&(this._refresh(),this._refreshAllShapes());break;case"shapeStyle":i&&this._createdGraphics&&(this._$shapesContainer.geographics("clear"),this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))}},destroy:function(){if(this._$elem.is(".geo-service"))this._createdGraphics&&(this._$shapesContainer.geographics("destroy"),this._$shapesContainer=t,this._createdGraphics=!1);else{clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,this._created=!1,e(window).unbind("resize",this._windowHandler);for(var n=0;n<this._currentServices.length;n++)this._currentServices[n].serviceContainer.geomap("destroy"),e.geo._serviceTypes[this._currentServices[n].type].destroy(this,this._$servicesContainer,this._currentServices[n]);this._$shapesContainer.geographics("destroy"),this._$shapesContainer=t,this._createdGraphics=!1,this._$drawContainer.geographics("destroy"),this._$drawContainer=t,this._$existingChildren.detach(),this._$elem.html(""),this._$elem.append(this._$existingChildren),this._$elem.removeClass("geo-map")}e.Widget.prototype.destroy.apply(this,arguments)},toMap:function(t){return t=this._toMap(t),this._userGeodetic?e.geo.proj.toGeodetic(t):t},toPixel:function(t,n,r){return this._toPixel(e.geo.proj?e.geo.proj.fromGeodetic(t):t,n,r)},opacity:function(t,n){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",t,this._$elem);else if(t>=0||t<=1)for(var r=0;r<this._currentServices.length;r++){var i=this._currentServices[r];if(!n||i.serviceContainer[0]==n[0])i.style.opacity=t,i.serviceObject.style=e.extend({},i.serviceObject.style,i.style),e.geo._serviceTypes[i.type].opacity(this,i)}},toggle:function(n,r){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",n,this._$elem);else for(var i=0;i<this._currentServices.length;i++){var s=this._currentServices[i];if(!r||s.serviceContainer[0]==r[0])n===t&&(n=s.style.visibility!=="visible"),s.style.visibility=n?"visible":"hidden",s.serviceObject.style=e.extend({},s.serviceObject.style,s.style),s.serviceContainer.toggle(n),n&&e.geo._serviceTypes[s.type].refresh(this,s)}},zoom:function(e){e!==null&&this._setZoom(this._options.zoom+e,!1,!0)},refresh:function(e,t){this._$elem.is(".geo-service")?this._$elem.closest(".geo-map").geomap("refresh",e,this._$elem):(this._refresh(e,t),this._refreshAllShapes())},resize:function(t){var n=this._findMapSize(),r=n.width/2-this._contentBounds.width/2,i=n.height/2-this._contentBounds.height/2,s;this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:n.width,height:n.height},this._$resizeContainer.css({width:n.width,height:n.height});for(s=0;s<this._currentServices.length;s++)e.geo._serviceTypes[this._currentServices[s].type].resize(this,this._currentServices[s]);this._$elem.find(".geo-graphics").css({width:n.width,height:n.height}).geographics("resize");for(s=0;s<this._drawPixels.length;s++)this._drawPixels[s][0]+=r,this._drawPixels[s][1]+=i;this._setCenterAndSize(this._center,this._pixelSize,t,!0)},append:function(n,r,i,s){if(n&&(e.isPlainObject(n)||e.isArray(n)&&n.length>0)){this._createdGraphics||this._createServiceGraphics();var o,u,a,f,l,c;e.isArray(n)?o=n:n.type=="FeatureCollection"?o=n.features:o=[n];for(a=1;a<arguments.length;a++)u=arguments[a],typeof u=="object"?f=u:typeof u=="number"||typeof u=="string"?l=u:typeof u=="boolean"&&(c=u);for(a=0;a<o.length;a++){if(o[a].type!="Point"){var h=e.geo.bbox(o[a]);e.geo.proj&&e.geo._isGeodetic(h)&&(h=e.geo.proj.fromGeodetic(h)),e.data(o[a],"geoBbox",h)}this._graphicShapes.push({shape:o[a],style:f,label:l})}if(c===t||c)this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes()}},empty:function(n){for(var r=0;r<this._graphicShapes.length;r++)e.removeData(this._graphicShapes[r].shape,"geoBbox");this._graphicShapes=[];if(n===t||n)this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes()},find:function(n,r){var i=e.isPlainObject(n),s=i?this._map.toPixel(n.coordinates):t,o=this._map._pixelSize*r,u=[],a,f,l,c=0;for(;c<this._graphicShapes.length;c++){a=this._graphicShapes[c];if(i)if(a.shape.type=="Point")e.geo.distance(a.shape,n)<=o&&u.push(a.shape);else{var h=e.data(a.shape,"geoBbox"),p={type:"Polygon",coordinates:[[[h[0],h[1]],[h[0],h[3]],[h[2],h[3]],[h[2],h[1]],[h[0],h[1]]]]},d={type:"Point",coordinates:e.geo.proj&&e.geo._isGeodetic(n.coordinates)?e.geo.proj.fromGeodetic(n.coordinates):n.coordinates};if(e.geo.distance(p,d,!0)<=o){f=e.geo._flatten(a.shape);for(l=0;l<f.length;l++)if(e.geo.distance(f[l],n)<=o){u.push(a.shape);break}}}else u.push(a.shape)}return this._$elem.is(".geo-map")&&this._$elem.find(".geo-service").each(function(){u=e.merge(u,e(this).geomap("find",n,r))}),u},remove:function(n,r){if(n&&(e.isPlainObject(n)||e.isArray(n)&&n.length>0)){var i=e.isArray(n)?n:[n],s;for(var o=0;o<this._graphicShapes.length;o++)e.inArray(this._graphicShapes[o].shape,i)>=0&&(e.removeData(n,"geoBbox"),s=this._graphicShapes.slice(o+1),this._graphicShapes.length=o,this._graphicShapes.push.apply(this._graphicShapes,s),o--);if(r===t||r)this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes()}},_getBbox:function(e,t){e=e||this._center,t=t||this._pixelSize;var n=this._contentBounds.width/2*t,r=this._contentBounds.height/2*t;return[e[0]-n,e[1]-r,e[0]+n,e[1]+r]},_setBbox:function(t,n,r){var i=[t[0]+(t[2]-t[0])/2,t[1]+(t[3]-t[1])/2],s=Math.max(e.geo.width(t,!0)/this._contentBounds.width,e.geo.height(t,!0)/this._contentBounds.height),o=this._getZoom(i,s);this._options.tilingScheme?s=this._getPixelSize(Math.min(Math.max(o,this._options.zoomMin),this._options.zoomMax)):o<this._options.zoomMin?s=this._getPixelSize(this._options.zoomMin):o>this._options.zoomMax&&(s=this._getPixelSize(this._options.zoomMax)),this._setInteractiveCenterAndSize(i,s),this._interactiveTransform()},_getBboxMax:function(){var e=this._contentBounds.width/2*this._pixelSizeMax,t=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-e,this._centerMax[1]-t,this._centerMax[0]+e,this._centerMax[1]+t]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(t,n){t=t||this._center,n=n||this._pixelSize;var r=this._options.tilingScheme;if(r){if(r.pixelSizes){var i=Math.floor(n*1e3),s=r.pixelSizes.length,o=s-1;for(;o>=0;o--)if(Math.floor(r.pixelSizes[o]*1e3)>=i)return o;return 0}return Math.round(Math.log(r.basePixelSize/n)/Math.log(2))}var u=this._contentBounds.width/this._contentBounds.height,a=e.geo.reaspect(this._getBbox(t,n),u,!0),f=e.geo.reaspect(this._getBboxMax(),u,!0);return Math.round(Math.log(e.geo.width(f,!0)/e.geo.width(a,!0))/Math.log(this._zoomFactor))},_setZoom:function(e,t,n){this._clearInteractiveTimeout(),e=Math.min(Math.max(e,this._options.zoomMin),this._options.zoomMax),this._setInteractiveCenterAndSize(this._centerInteractive,this._getPixelSize(e)),this._interactiveTransform(),this._setInteractiveTimeout(t)},_createChildren:function(){this._$existingChildren=this._$elem.children(),this._forcePosition(this._$existingChildren),this._$existingChildren.detach().css({mozUserSelect:"none"});var t="width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;",n="position:absolute; left:0; top:0;";this._$elem.prepend('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px;"+t+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>'),this._$eventTarget=this._$contentFrame=this._$elem.children(":first"),this._$contentFrame.append('<div class="geo-services-container" style="'+n+t+'"></div>'),this._$servicesContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-shapes-container" style="'+n+t+'"></div>'),this._$shapesContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<ul style="position: absolute; bottom: 8px; left: 8px; list-style-type: none; max-width: 50%; padding: 0; margin: 0;"></ul>'),this._$attrList=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-draw-container" style="'+n+t+'"></div>'),this._$drawContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-measure-container" style="'+n+t+'"><span class="geo-measure-label" style="'+n+'; display: none;"></span></div>'),this._$measureContainer=this._$contentFrame.children(":last"),this._$measureLabel=this._$measureContainer.children(),this._$panContainer=e([this._$shapesContainer[0],this._$drawContainer[0],this._$measureContainer[0]]),this._$resizeContainer=e([this._$contentFrame[0],this._$servicesContainer[0],this._$eventTarget[0],this._$measureContainer[0]]),this._$contentFrame.append(this._$existingChildren),e("#geo-measure-style").length||e("head").prepend('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+(r?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+" }</style>")},_createServices:function(){var t,n;for(n=0;n<this._currentServices.length;n++)this._currentServices[n].serviceContainer.geomap("destroy"),e.geo._serviceTypes[this._currentServices[n].type].destroy(this,this._$servicesContainer,this._currentServices[n]);this._currentServices=[],this._$servicesContainer.html(""),this._$attrList.html("");for(n=0;n<this._options.services.length;n++){t=this._currentServices[n]=e.extend({},this._options.services[n]),t.serviceObject=this._options.services[n],t.style=e.extend({visibility:"visible",opacity:1},t.style);var r=t.id?' id="'+t.id+'"':"",i='class="geo-service '+(t["class"]?t["class"]:"")+'"',s="<div "+r+i+' style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:32px; height:32px; margin:0; padding:0; display:'+(t.style.visibility==="visible"?"block":"none")+';"></div>',o;this._$servicesContainer.append(s),serviceContainer=this._$servicesContainer.children(":last"),t.serviceContainer=serviceContainer,e.geo._serviceTypes[t.type].create(this,serviceContainer,t,n),serviceContainer.data("geoMap",this).geomap(),t.attr&&this._$attrList.append("<li>"+t.attr+"</li>")}this._$shapesContainers=this._$shapesContainer,this._$attrList.find("a").css({position:"relative",zIndex:100})},_createServiceGraphics:function(){var e=this._$elem.closest(".geo-content-frame");this._$elem.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0; width:'+e.css("width")+"; height:"+e.css("height")+'; margin:0; padding:0;"></div>'),this._$shapesContainer=this._$elem.children(":last"),this._map._$shapesContainers=this._map._$shapesContainers.add(this._$shapesContainer),this._$shapesContainer.geographics(),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style")},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>0){var t=this._options.mode,n=this._drawPixels,r=this._drawCoords,i,s,o,u,a;switch(t){case"measureLength":t="drawLineString",s={type:"LineString",coordinates:r},i=e.render[this._tmplLengthId]({length:e.geo.length(s,!0)}),o=e.merge([],n[n.length-1]);break;case"measureArea":t="drawPolygon",s={type:"Polygon",coordinates:[e.merge([],r)]},s.coordinates[0].push(r[0]),i=e.render[this._tmplAreaId]({area:e.geo.area(s,!0)}),o=this._toPixel(e.geo.centroid(s).coordinates),n=[n];break;case"drawPolygon":n=[n]}this._$drawContainer.geographics(t,n),i&&(this._$measureLabel.html(i),u=this._contentBounds.width-(this._$measureLabel.outerWidth(!0)+o[0]),a=this._contentBounds.height-(this._$measureLabel.outerHeight(!0)+o[1]),u<0&&(o[0]+=u),a<0&&(o[1]+=a),this._$measureLabel.css({left:Math.max(o[0],0),top:Math.max(o[1],0)}).show())}},_resetDrawing:function(){this._drawPixels=[],this._drawCoords=[],this._$drawContainer.geographics("clear"),this._$measureLabel.hide()},_refreshAllShapes:function(){this._timeoutRefreshShapes=null;var e,t,n=0;for(;n<this._currentServices.length;n++)e=this._currentServices[n],t=e.serviceContainer.data("geoService"),t._createdGraphics&&(t._$shapesContainer.geographics("clear"),t._graphicShapes.length>0&&t._refreshShapes(t._$shapesContainer,t._graphicShapes,t._graphicShapes,t._graphicShapes));this._createdGraphics&&(this._$shapesContainer.geographics("clear"),this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))},_refreshShapes:function(n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m=this._map._getBbox(o,u);for(a=0;a<r.length;a++){l=r[a].shape||r[a],l=l.geometry||l,c=e.data(l,"geoBbox");if(c&&e.geo._bboxDisjoint(m,c))continue;h=e.isArray(i)?i[a].style:i,p=e.isArray(s)?s[a].label:s,d=p!==t,v=t;switch(l.type){case"Point":v=this._map.toPixel(l.coordinates,o,u),this._$shapesContainer.geographics("drawPoint",v,h);break;case"LineString":this._$shapesContainer.geographics("drawLineString",this._map.toPixel(l.coordinates,o,u),h),d&&(v=this._map.toPixel(e.geo.pointAlong(l,.5).coordinates,o,u));break;case"Polygon":this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(l.coordinates,o,u),h),d&&(v=this._map.toPixel(e.geo.centroid(l).coordinates,o,u));break;case"MultiPoint":for(f=0;f<l.coordinates.length;f++)this._$shapesContainer.geographics("drawPoint",this._map.toPixel(l.coordinates[f],o,u),h);d&&(v=this._map.toPixel(e.geo.centroid(l).coordinates,o,u));break;case"MultiLineString":for(f=0;f<l.coordinates.length;f++)this._$shapesContainer.geographics("drawLineString",this._map.toPixel(l.coordinates[f],o,u),h);d&&(v=this._map.toPixel(e.geo.centroid(l).coordinates,o,u));break;case"MultiPolygon":for(f=0;f<l.coordinates.length;f++)this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(l.coordinates[f],o,u),h);d&&(v=this._map.toPixel(e.geo.centroid(l).coordinates,o,u));break;case"GeometryCollection":this._refreshShapes(n,l.geometries,h,p,o,u)}d&&v&&this._$shapesContainer.geographics("drawLabel",v,p)}},_findMapSize:function(){var e={width:0,height:0},t=this._$elem;while(t.size()&&!(e.width>0&&e.height>0)){e={width:t.width(),height:t.height()};if(e.width<=0||e.height<=0)e={width:parseInt(t.css("width"),10),height:parseInt(t.css("height"),10)};t=t.parent()}return e},_forcePosition:function(e){var t=e.css("position");t!="relative"&&t!="absolute"&&t!="fixed"&&e.css("position","relative")},_getPixelSize:function(t){var n=this._options.tilingScheme;if(n!==null){if(t===0)return n.pixelSizes?n.pixelSizes[0]:n.basePixelSize;t=Math.round(t),t=Math.max(t,0);var r=n.pixelSizes?n.pixelSizes.length:n.levels;return t=Math.min(t,r-1),n.pixelSizes?n.pixelSizes[t]:n.basePixelSize/Math.pow(2,t)}var i=e.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,t),!0);return Math.max(e.geo.width(i,!0)/this._contentBounds.width,e.geo.height(i,!0)/this._contentBounds.height)},_getZoomCenterAndSize:function(e,t,n){var r=n?this._fullZoomFactor:this._partialZoomFactor,i=Math.pow(r,-t),s=this._pixelSizeInteractive*i,o=this._getZoom(this._centerInteractive,s);n&&this._options.tilingScheme?s=this._getPixelSize(Math.min(Math.max(o,this._options.zoomMin),this._options.zoomMax)):t<0&&o<this._options.zoomMin?s=this._pixelSizeInteractive:t>0&&o>this._options.zoomMax&&(s=this._pixelSizeInteractive);var u=s/this._pixelSizeInteractive,a=this._toMap(e,this._centerInteractive,this._pixelSizeInteractive),f=[(this._centerInteractive[0]-a[0])*u,(this._centerInteractive[1]-a[1])*u],l=[a[0]+f[0],a[1]+f[1]];return{pixelSize:s,center:l}},_mouseWheelFinish:function(e){this._wheelTimeout=null;if(this._wheelLevel!==0){var t=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._options.tilingScheme!==null);this._wheelLevel=0}else e&&(this._refresh(),this._refreshAllShapes())},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var e=this._current[0]-this._anchor[0],t=this._current[1]-this._anchor[1],n=this._options.axisLayout==="image",r=-e*this._pixelSize,i=(n?-1:1)*t*this._pixelSize;this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._inOp=!1,this._anchor=this._current,this._mouseDown=this._toolPan=this._panning=!1}},_panMove:function(){if(!this._options.pannable)return;var e=this._current[0]-this._lastDrag[0],t=this._current[1]-this._lastDrag[1],n=0,r,i;if(this._toolPan||e>3||e<-3||t>3||t<-3){this._toolPan||(this._toolPan=!0,this._$eventTarget.css("cursor",this._options.cursors.pan)),this._mouseDown&&(this._velocity=[e,t]);if(e!==0||t!==0)this._panning=!0,this._lastDrag=this._current,this._centerInteractive[0]-=e*this._pixelSizeInteractive,this._centerInteractive[1]+=(this._options.axisLayout==="image"?-1:1)*t*this._pixelSizeInteractive,this._setInteractiveCenterAndSize(this._centerInteractive,this._pixelSizeInteractive),this._interactiveTransform()}},_clearInteractiveTimeout:function(){return this._timeoutRefreshShapes&&(clearTimeout(this._timeoutRefreshShapes),this._timeoutRefreshShapes=null),this._timeoutInteractive?(clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,!0):(this._centerInteractive[0]=this._center[0],this._centerInteractive[1]=this._center[1],this._pixelSizeInteractive=this._pixelSize,!1)},_interactiveTransform:function(){var t=this._contentBounds.width,n=this._contentBounds.height,r=t/2,i=n/2,s=[this._centerInteractive[0]-r,this._centerInteractive[1]-i,this._centerInteractive[0]+r,this._centerInteractive[1]+i],o=this._pixelSize,u=o/this._pixelSizeInteractive;if(o>0){u=Math.round(u*1e3)/1e3;var a=this._toMap([0,0]),f=this._toPixel(a,this._centerInteractive,this._pixelSizeInteractive);this._$shapesContainers.geographics("interactiveTransform",f,u)}for(var l=0;l<this._currentServices.length;l++)service=this._currentServices[l],e.geo._serviceTypes[service.type].interactiveTransform(this,service,this._centerInteractive,this._pixelSizeInteractive);this._drawCoords.length>0&&(this._drawPixels=this._toPixel(this._drawCoords,this._centerInteractive,this._pixelSizeInteractive),this._refreshDrawing())},_interactiveTimeout:function(){this._isMultiTouch?this._timeoutInteractive=setTimeout(e.proxy(interactiveTimeout,this),128):this._created&&this._timeoutInteractive&&(this._setCenterAndSize(this._centerInteractive,this._pixelSizeInteractive,this._triggerInteractive,!0),this._timeoutInteractive=null,this._triggerInteractive=!1,this._timeoutRefreshShapes=setTimeout(e.proxy(this._refreshAllShapes,this),128))},_setInteractiveTimeout:function(t){this._timeoutInteractive=setTimeout(e.proxy(this._interactiveTimeout,this),128),this._triggerInteractive|=t},_refresh:function(t,n){var r,i=0;for(;i<this._currentServices.length;i++)r=this._currentServices[i],(!n||r.serviceContainer[0]==n[0])&&e.geo._serviceTypes[r.type].refresh(this,r,t)},_setInteractiveCenterAndSize:function(t,n){this._centerInteractive[0]=t[0],this._centerInteractive[1]=t[1],this._pixelSizeInteractive=n,this._userGeodetic?(this._options.bbox=e.geo.proj.toGeodetic(this._getBbox(t,n)),this._options.center=e.geo.proj.toGeodetic(t)):(this._options.bbox=this._getBbox(t,n),this._options.center[0]=t[0],this._options.center[1]=t[1]),this._options.pixelSize=n,this._options.zoom=this._getZoom(t,n)},_setCenterAndSize:function(t,n,r,i){if(!e.isArray(t)||t.length!=2||typeof t[0]!="number"||typeof t[1]!="number")return;var s=this._getZoom(t,n);this._options.tilingScheme?this._pixelSizeInteractive=n=this._getPixelSize(Math.min(Math.max(s,this._options.zoomMin),this._options.zoomMax)):s<this._options.zoomMin?this._pixelSizeInteractive=n=this._getPixelSize(this._options.zoomMin):s>this._options.zoomMax&&(this._pixelSizeInteractive=n=this._getPixelSize(this._options.zoomMax)),this._center[0]=t[0],this._center[1]=t[1],this._options.pixelSize=this._pixelSize=n,this._userGeodetic?(this._options.bbox=e.geo.proj.toGeodetic(this._getBbox()),this._options.center=e.geo.proj.toGeodetic(this._center)):(this._options.bbox=this._getBbox(),this._options.center=e.merge([],t)),this._options.zoom=s,r&&this._trigger("bboxchange",window.event,{bbox:e.merge([],this._options.bbox)}),i&&(this._refresh(),this._refreshAllShapes(),this._refreshDrawing())},_requestQueued:function(){this._loadCount===0&&this._trigger("loadstart",window.event),this._loadCount++},_requestComplete:function(){this._loadCount--,this._loadCount<=0&&(this._loadCount=0,this._trigger("loadend",window.event))},_toMap:function(t,n,r){n=n||this._center,r=r||this._pixelSize;var i=e.isArray(t[0]),s=i&&e.isArray(t[0][0]),o=s&&e.isArray(t[0][0][0]),u=this._contentBounds.width,a=this._contentBounds.height,f=u/2*r,l=a/2*r,c=[n[0]-f,n[1]-l,n[0]+f,n[1]+l],h=e.geo.width(c,!0)/u,p=e.geo.height(c,!0)/a,d,v=this._options.axisLayout==="image",m=[],g,y,b;o||(s||(i||(t=[t]),t=[t]),t=[t]);for(g=0;g<t.length;g++){m[g]=[];for(y=0;y<t[g].length;y++){m[g][y]=[];for(b=0;b<t[g][y].length;b++)d=t[g][y][b][1]*p,m[g][y][b]=[c[0]+t[g][y][b][0]*h,v?c[1]+d:c[3]-d]}}return o?m:s?m[0]:i?m[0][0]:m[0][0][0]},_toPixel:function(t,n,r){n=n||this._center,r=r||this._pixelSize;var i=e.isArray(t[0]),s=i&&e.isArray(t[0][0]),o=s&&e.isArray(t[0][0][0]),u=this._contentBounds.width,a=this._contentBounds.height,f=u/2*r,l=a/2*r,c=[n[0]-f,n[1]-l,n[0]+f,n[1]+l],h=e.geo.width(c,!0),p=e.geo.height(c,!0),d=this._options.axisLayout==="image",v=u/h,m=a/p,g=[],y,b,w;o||(s||(i||(t=[t]),t=[t]),t=[t]);for(y=0;y<t.length;y++){g[y]=[];for(b=0;b<t[y].length;b++){g[y][b]=[];for(w=0;w<t[y][b].length;w++)g[y][b][w]=[Math.round((t[y][b][w][0]-c[0])*v),Math.round((d?t[y][b][w][1]-c[1]:c[3]-t[y][b][w][1])*m)]}}return o?g:s?g[0]:i?g[0][0]:g[0][0][0]},_document_keydown:function(t){var n=this._drawCoords.length;n>0&&t.which==27&&(n<=2?(this._resetDrawing(),this._inOp=!1):(this._drawCoords[n-2]=e.merge([],this._drawCoords[n-1]),this._drawPixels[n-2]=e.merge([],this._drawPixels[n-1]),this._drawCoords.length--,this._drawPixels.length--,this._refreshDrawing()))},_eventTarget_dblclick_zoom:function(e){var t=this._clearInteractiveTimeout();this._trigger("dblclick",e,{type:"Point",coordinates:this._toMap(this._current,this._centerInteractive,this._pixelSizeInteractive)});if(!e.isDefaultPrevented()){var n=this._getZoomCenterAndSize(this._current,1,!0);this._setInteractiveCenterAndSize(n.center,n.pixelSize),this._interactiveTransform(),t=!0}t&&this._setInteractiveTimeout(!0)},_eventTarget_dblclick:function(t){if(this._options.mode==="static")return;this._drawTimeout&&(window.clearTimeout(this._drawTimeout),this._drawTimeout=null);var n=e(t.currentTarget).offset();switch(this._options.mode){case"drawLineString":case"measureLength":this._drawCoords.length>1&&(this._drawCoords[0][0]!=this._drawCoords[1][0]||this._drawCoords[0][1]!=this._drawCoords[1][1])?(this._drawCoords.length--,this._trigger("shape",t,{type:"LineString",coordinates:this._userGeodetic?e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})):this._eventTarget_dblclick_zoom(t),this._resetDrawing();break;case"drawPolygon":case"measureArea":if(this._drawCoords.length>1&&(this._drawCoords[0][0]!=this._drawCoords[1][0]||this._drawCoords[0][1]!=this._drawCoords[1][1])){var r=this._drawCoords.length-1;r>2&&(this._drawCoords[r]=e.merge([],this._drawCoords[0]),this._trigger("shape",t,{type:"Polygon",coordinates:[this._userGeodetic?e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]}))}else this._eventTarget_dblclick_zoom(t);this._resetDrawing();break;default:this._eventTarget_dblclick_zoom(t)}this._inOp=!1},_eventTarget_touchstart:function(t){var n=this._options.mode,r=this._options.shift,i=n==="dragBox"?"dragBox":"zoom";if(n==="static")return;if(!this._supportTouch&&t.which!=1)return;var s=this._clearInteractiveTimeout(),o=e(t.currentTarget).offset(),u=t.originalEvent.changedTouches;this._supportTouch?(this._multiTouchAnchor=e.merge([],u),this._isMultiTouch=this._multiTouchAnchor.length>1,this._isMultiTouch?(this._multiTouchCurrentBbox=[u[0].pageX-o.left,u[0].pageY-o.top,u[1].pageX-o.left,u[1].pageY-o.top],this._multiTouchAnchorBbox=e.merge([],this._multiTouchCurrentBbox),this._current=e.geo.center(this._multiTouchCurrentBbox,!0)):(this._multiTouchCurrentBbox=[u[0].pageX-o.left,u[0].pageY-o.top,NaN,NaN],this._current=[u[0].pageX-o.left,u[0].pageY-o.top])):this._current=[t.pageX-o.left,t.pageY-o.top];if(this._softDblClick){var a=e.now();if(a-this._downDate<750){if(this._isTap){var f=this._current[0]-this._anchor[0],l=this._current[1]-this._anchor[1],c=Math.sqrt(f*f+l*l);c>8?this._isTap=!1:this._current=e.merge([],this._anchor)}this._isDbltap?this._isDbltap=!1:this._isDbltap=this._isTap}else this._isDbltap=!1;this._isTap=!0,this._downDate=a}return this._mouseDown=!0,this._anchor=e.merge([],this._current),!this._inOp&&t.shiftKey&&r!=="off"?(this._shiftDown=!0,this._$eventTarget.css("cursor",this._options.cursors[r==="default"?i:r])):!this._isMultiTouch&&(this._options.pannable||n==="dragBox"||n==="dragCircle")&&(this._inOp=!0,n!=="zoom"&&n!=="dragBox"&&n!=="dragCircle"&&(this._lastDrag=this._current,t.currentTarget.setCapture&&t.currentTarget.setCapture())),t.preventDefault(),s&&this._setInteractiveTimeout(!0),!1},_dragTarget_touchmove:function(t){if(this._options.mode==="static")return;var n=!1;this._mouseDown&&(n=this._clearInteractiveTimeout());var i=this._$eventTarget.offset(),s=this._drawCoords.length,o=t.originalEvent.changedTouches,u,a,f=0;if(this._supportTouch){if(!this._isMultiTouch&&this._mouseDown&&this._multiTouchAnchor.length>0&&o[0].identifier!==this._multiTouchAnchor[0].identifier)return this._mouseDown=!1,this._isMultiTouch=!0,this._wheelLevel=0,this._multiTouchAnchor.push(o[0]),this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-i.left,this._multiTouchAnchor[1].pageY-i.top],this._multiTouchAnchorBbox=e.merge([],this._multiTouchCurrentBbox),this._mouseDown=!0,this._anchor=this._current=e.geo.center(this._multiTouchCurrentBbox,!0),n&&this._setInteractiveTimeout(!0),!1;if(this._isMultiTouch){for(;f<o.length;f++)o[f].identifier===this._multiTouchAnchor[0].identifier?(this._multiTouchCurrentBbox[0]=o[f].pageX-i.left,this._multiTouchCurrentBbox[1]=o[f].pageY-i.top):o[f].identifier===this._multiTouchAnchor[1].identifier&&(this._multiTouchCurrentBbox[2]=o[f].pageX-i.left,this._multiTouchCurrentBbox[3]=o[f].pageY-i.top);var l=e.geo._distancePointPoint([this._multiTouchAnchorBbox[0],this._multiTouchAnchorBbox[1]],[this._multiTouchAnchorBbox[2],this._multiTouchAnchorBbox[3]]),c=e.geo._distancePointPoint([this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1]],[this._multiTouchCurrentBbox[2],this._multiTouchCurrentBbox[3]]);u=e.geo.center(this._multiTouchCurrentBbox,!0);var h=(c-l)/l;h>0?h*=5:h*=10;var p=h-this._wheelLevel;this._wheelLevel=h;var d=this._getZoomCenterAndSize(this._anchor,p,!1);this._setInteractiveCenterAndSize(d.center,d.pixelSize),this._interactiveTransform(),n=!0,u=e.geo.center(this._multiTouchCurrentBbox,!0)}else u=[t.originalEvent.changedTouches[0].pageX-i.left,t.originalEvent.changedTouches[0].pageY-i.top]}else u=[t.pageX-i.left,t.pageY-i.top];if(u[0]===this._lastMove[0]&&u[1]===this._lastMove[1]&&this._inOp)return t.preventDefault(),n&&this._setInteractiveTimeout(!0),!1;r==7&&(this._isDbltap=this._isTap=!1),this._mouseDown&&(this._current=u,this._moveDate=e.now());if(this._isMultiTouch)return t.preventDefault(),this._isDbltap=this._isTap=!1,n&&this._setInteractiveTimeout(!0),!1;var v=this._options.mode,m=this._options.shift,g=v==="dragBox"?"dragBox":"zoom",y,b,w;this._shiftDown&&(v=m==="default"?g:m);switch(v){case"zoom":case"dragBox":this._mouseDown?(this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],u[0],u[1]])):this._trigger("move",t,{type:"Point",coordinates:this.toMap(u)});break;case"dragCircle":this._mouseDown?(y=u[0]-this._anchor[0],b=u[1]-this._anchor[1],w=Math.sqrt(y*y+b*b)*2,this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawArc",this._anchor,0,360,{width:w,height:w})):this._trigger("move",t,{type:"Point",coordinates:this.toMap(u)});break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":this._mouseDown||this._toolPan?(this._panMove(),n=!0):(s>0&&(this._drawCoords[s-1]=this._toMap(u,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[s-1]=u,this._refreshDrawing()),this._trigger("move",t,{type:"Point",coordinates:this.toMap(u)}));break;default:this._mouseDown||this._toolPan?(this._panMove(),n=!0):this._trigger("move",t,{type:"Point",coordinates:this.toMap(u)})}this._lastMove=u,n&&this._setInteractiveTimeout(!0);if(this._inOp)return t.preventDefault(),!1},_dragTarget_touchstop:function(t){if(this._options.mode==="static")return;if(!this._mouseDown){if(r!=7)return;this._eventTarget_touchstart(t)}var n=this._clearInteractiveTimeout(),i=this._mouseDown,s=this._toolPan,o=this._$eventTarget.offset(),u=this._options.mode,a=this._options.shift,f=u==="dragBox"?"dragBox":"zoom",l,c,h,p,d,v,m;this._shiftDown&&(u=a==="default"?f:a),this._supportTouch?(l=[t.originalEvent.changedTouches[0].pageX-o.left,t.originalEvent.changedTouches[0].pageY-o.top],this._multiTouchAnchor=[],this._inOp=!1):l=[t.pageX-o.left,t.pageY-o.top],this._softDblClick&&this._isTap&&(p=l[0]-this._anchor[0],d=l[1]-this._anchor[1],Math.sqrt(p*p+d*d)<=8&&(l=e.merge([],this._anchor))),p=l[0]-this._anchor[0],d=l[1]-this._anchor[1],this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._shiftDown=this._mouseDown=this._toolPan=!1;if(this._isMultiTouch){t.preventDefault(),this._isMultiTouch=!1,this._wheelLevel=0,n&&this._setInteractiveTimeout(!0);return}document.releaseCapture&&document.releaseCapture();if(i){h=e.now(),this._current=l;switch(u){case"zoom":case"dragBox":if(p!==0||d!==0){var g=this._pixelSize*6,y=this._toMap([[Math.min(this._anchor[0],l[0]),Math.max(this._anchor[1],l[1])],[Math.max(this._anchor[0],l[0]),Math.min(this._anchor[1],l[1])]]),b=[y[0][0],y[0][1],y[1][0],y[1][1]];u==="zoom"?(b[2]-b[0]<g&&b[3]-b[1]<g&&(b=e.geo.scaleBy(this._getBbox(e.geo.center(b,!0)),.5,!0)),this._setBbox(b,!0,!0),n=!0):(m=e.geo.polygonize(b,!0),m.bbox=b,this._userGeodetic&&(m.coordinates=e.geo.proj.toGeodetic(m.coordinates),m.bbox=e.geo.proj.toGeodetic(m.bbox)),this._trigger("shape",t,m))}else u==="dragBox"&&(v=this._toMap(l),m={type:"Point",coordinates:[v[0],v[1]],bbox:[v[0],v[1],v[0],v[1]]},this._userGeodetic&&(m.coordinates=e.geo.proj.toGeodetic(m.coordinates),m.bbox=e.geo.proj.toGeodetic(m.bbox)),this._trigger("shape",t,m));this._resetDrawing();break;case"dragCircle":if(p!==0||d!==0){var w=this._options.axisLayout==="image",E=Math.sqrt(p*p+d*d),S=180,x;this._drawPixels.length=S+1;for(c=0;c<S;c++)x=c*360/S*(Math.PI/180),this._drawPixels[c]=[this._anchor[0]+Math.cos(x)*E,this._anchor[1]+Math.sin(x)*E];this._drawPixels[S]=[this._drawPixels[0][0],this._drawPixels[0][1]],v=this._toMap([[this._anchor[0]-E,this._anchor[1]+(w?-E:E)],[this._anchor[0]+E,this._anchor[1]+(w?E:-E)]]),m={type:"Polygon",coordinates:[this._toMap(this._drawPixels)],bbox:[v[0][0],v[0][1],v[1][0],v[1][1]]},this._userGeodetic&&(m.coordinates=e.geo.proj.toGeodetic(m.coordinates),m.bbox=e.geo.proj.toGeodetic(m.bbox)),this._trigger("shape",t,m),this._resetDrawing()}else v=this._toMap(l),m={type:"Point",coordinates:[v[0],v[1]],bbox:[v[0],v[1],v[0],v[1]]},this._userGeodetic&&(m.coordinates=e.geo.proj.toGeodetic(m.coordinates),m.bbox=e.geo.proj.toGeodetic(m.bbox)),this._trigger("shape",t,m);break;case"drawPoint":this._drawTimeout&&(window.clearTimeout(this._drawTimeout),this._drawTimeout=null);if(s)this._panFinalize();else if(h-this._clickDate>100){var T=this;this._drawTimeout=setTimeout(function(){T._drawTimeout&&(T._trigger("shape",t,{type:"Point",coordinates:T.toMap(l)}),T._inOp=!1,T._drawTimeout=null)},250)}break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":if(s)this._panFinalize();else{c=this._drawCoords.length===0?0:this._drawCoords.length-1,this._drawCoords[c]=this._toMap(l),this._drawPixels[c]=l;if(c<2||this._drawCoords[c][0]!=this._drawCoords[c-1][0]||this._drawCoords[c][1]!=this._drawCoords[c-1][1])this._drawCoords[c+1]=this._toMap(l,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[c+1]=l;this._refreshDrawing()}break;default:s?this._panFinalize():h-this._clickDate>100&&(this._trigger("click",t,{type:"Point",coordinates:this.toMap(l)}),this._inOp=!1)}this._clickDate=h;if(this._softDblClick&&this._isDbltap)return this._isDbltap=this._isTap=!1,n&&this._setInteractiveTimeout(!0),this._$eventTarget.trigger("dblclick",t),!1}n&&this._setInteractiveTimeout(!0);if(this._inOp)return t.preventDefault(),!1},_eventTarget_mousewheel:function(t,n){if(this._options.mode==="static"||this._options.scroll==="off")return;t.preventDefault();if(this._mouseDown)return!1;if(n!==0){this._clearInteractiveTimeout(),n>0?n=Math.ceil(n):n=Math.floor(n);var r=e(t.currentTarget).offset();this._anchor=[t.pageX-r.left,t.pageY-r.top];var i=this._getZoomCenterAndSize(this._anchor,n,this._options.tilingScheme!==null),s,o=0;this._setInteractiveCenterAndSize(i.center,i.pixelSize),this._interactiveTransform(),this._setInteractiveTimeout(!0)}return!1}})}(jQuery),function(e,t){e.geo._serviceTypes.tiled=function(){return{create:function(t,n,r,i){var s=e.data(r,"geoServiceState");if(!s){s={loadCount:0,reloadTiles:!1};var o='<div data-geo-service="tiled" style="-webkit-transform:translateZ(0); position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0;"></div>';n.append(o),s.serviceContainer=n.children(":last"),e.data(r,"geoServiceState",s)}return s.serviceContainer},destroy:function(t,n,r){var i=e.data(r,"geoServiceState");i.serviceContainer.remove(),e.removeData(r,"geoServiceState")},interactiveTransform:function(t,n,r,i){var s=e.data(n,"geoServiceState"),o=t.options.tilingScheme;s&&(this._cancelUnloaded(t,n),s.serviceContainer.children().each(function(n){var s=e(this),u=s.data("pixelSize"),a=u/i;if(u>0){a=Math.round(a*1e3)/1e3;var f=s.data("scaleOrigin"),l=t._toPixel(f,r,i);s.css({left:Math.round(l[0])+"px",top:Math.round(l[1])+"px",width:o.tileWidth*a,height:o.tileHeight*a})}}))},refresh:function(t,n,r){var i=e.data(n,"geoServiceState");this._cancelUnloaded(t,n),i&&r&&(i.reloadTiles=!0);if(i&&n&&n.style.visibility==="visible"&&!i.serviceContainer.is(":hidden")){var s=t._getBbox(),o=t._pixelSize,u=this,a=i.serviceContainer,f=t._getContentBounds(),l=f.width,c=f.height,h=t.options.axisLayout==="image",p=h?1:-1,d=t.options.tilingScheme,v=d.tileWidth,m=d.tileHeight,g=Math.floor((s[0]-d.origin[0])/(o*v)),y=Math.max(Math.floor((h?s[1]-d.origin[1]:d.origin[1]-s[3])/(o*m)),0),b=Math.ceil((s[2]-d.origin[0])/(o*v)),w=Math.ceil((h?s[3]-d.origin[1]:d.origin[1]-s[1])/(o*m)),E=t._getBboxMax(),S=t._getPixelSize(0),x=S/o,T=Math.floor((E[0]-d.origin[0])/(S*v))*x,N=Math.floor((d.origin[1]+p*E[3])/(S*m))*x,C=d.origin[0]+T*v*o,k=d.origin[1]+p*N*m*o,L=Math.round((C-s[0])/o),A=Math.round((h?k-s[1]:s[3]-k)/o),O=a.children().show(),M=O.filter("[data-pixel-size='"+o+"']").appendTo(a),_=n.style.opacity,D,P,H=function(n){u._loadImage(e.data(this,"img"),n,o,t,i,_)},B=function(){e.data(this,"img").remove(),i.loadCount--,t._requestComplete()};i.reloadTiles&&O.find("img").attr("data-dirty","true"),M.size()?(M.css({left:L%v+"px",top:A%m+"px"}).data("scaleOrigin",t._toMap([L%v,A%m])),M.children().each(function(t){var n=e(this),r=n.attr("data-tile").split(",");n.css({left:Math.round((parseInt(r[0],10)-T)*100+(L-L%v)/v*100)+"%",top:Math.round((parseInt(r[1],10)-N)*100+(A-A%m)/m*100)+"%"}),_<1&&n.fadeTo(0,_)})):(a.append("<div style='-webkit-transform:translateZ(0);position:absolute; left:"+L%v+"px; top:"+A%m+"px; width:"+v+"px; height:"+m+"px; margin:0; padding:0;' data-pixel-size='"+o+"'></div>"),M=a.children(":last").data("scaleOrigin",t._toMap([L%v,A%m])));for(D=g;D<b;D++)for(P=y;P<w;P++){var j=""+D+","+P,F=M.children("[data-tile='"+j+"']").removeAttr("data-dirty");if(F.size()===0||i.reloadTiles){var I=[d.origin[0]+D*v*o,d.origin[1]+p*P*m*o],q=[d.origin[0]+((D+1)*v-1)*o,d.origin[1]+p*((P+1)*m-1)*o],R=[I[0],I[1],q[0],q[1]],U=n.hasOwnProperty("src")?"src":"getUrl",z={bbox:R,width:v,height:m,zoom:t._getZoom(),tile:{row:P,column:D},index:Math.abs(P+D)},W=e.isFunction(n[U]),X;W?X=n[U](z):(e.templates("geoSrc",n[U]),X=e.render.geoSrc(z)),i.loadCount++,t._requestQueued();if(i.reloadTiles&&F.size()>0)F.attr("src",X);else{var V="<img style='-webkit-transform:translateZ(0);position:absolute; left:"+((D-T)*100+(L-L%v)/v*100)+"%; "+"top:"+((P-N)*100+(A-A%m)/m*100)+"%; ";V+="width: 100%; height: 100%;",V+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+j+"' />",M.append(V),F=M.children(":last")}typeof X=="string"?u._loadImage(F,X,o,t,i,_):X?(e.data(X,"img",F),X.done(H).fail(B)):F.remove()}}O.find("[data-dirty]").remove(),i.reloadTiles=!1}},resize:function(e,t){},opacity:function(t,n){var r=e.data(n,"geoServiceState");r.serviceContainer.find("img").stop(!0).fadeTo("fast",n.style.opacity)},toggle:function(t,n){var r=e.data(n,"geoServiceState");r.serviceContainer.css("display",n.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(t,n){var r=e.data(n,"geoServiceState");if(r&&r.loadCount>0){r.serviceContainer.find("img:hidden").remove();while(r.loadCount>0)r.loadCount--,t._requestComplete()}},_loadImage:function(t,n,r,i,s,o){var u=s.serviceContainer;t.load(function(t){o<1?e(t.target).fadeTo(0,o):e(t.target).show(),s.loadCount--,i._requestComplete(),s.loadCount<=0&&(u.children(":not([data-pixel-size='"+r+"'])").remove(),s.loadCount=0)}).error(function(t){e(t.target).remove(),s.loadCount--,i._requestComplete(),s.loadCount<=0&&(u.children(":not([data-pixel-size='"+r+"'])").remove(),s.loadCount=0)}).attr("src",n)}}}()}(jQuery),function(e,t){e.geo._serviceTypes.shingled=function(){return{create:function(t,n,r,i){var s=e.data(r,"geoServiceState");if(!s){s={loadCount:0};var o='<div data-geo-service="shingled" style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0;"></div>';n.append(o),s.serviceContainer=n.children(":last"),e.data(r,"geoServiceState",s)}return s.serviceContainer},destroy:function(t,n,r){var i=e.data(r,"geoServiceState");i.serviceContainer.remove(),e.removeData(r,"geoServiceState")},interactiveTransform:function(t,n,r,i){var s=e.data(n,"geoServiceState"),o=t._getContentBounds(),u=o.width,a=o.height,f=u/2,l=a/2,c=[r[0]-f,r[1]-l,r[0]+f,r[1]+l];s&&(this._cancelUnloaded(t,n),s.serviceContainer.children().each(function(n){var s=e(this),o=s.data("pixelSize"),f=o/i;if(o>0){f=Math.round(f*1e3)/1e3;var l=s.data("origin"),c=t._toPixel(l,r,i);s.css({left:Math.round(c[0]),top:Math.round(c[1]),width:u*f,height:a*f})}}))},refresh:function(t,n){var r=e.data(n,"geoServiceState");this._cancelUnloaded(t,n);if(r&&n&&n.style.visibility==="visible"&&!r.serviceContainer.is(":hidden")){var i=t._getBbox(),s=t._pixelSize,o=this,u=r.serviceContainer,a=t._getContentBounds(),f=a.width,l=a.height,c=u.children('[data-pixel-size="'+s+'"]'),h=n.style.opacity,p;h<1&&u.find("img").attr("data-keep-alive","0"),c.size()||(u.append('<div style="-webkit-transform:translateZ(0);position:absolute; left:0px; top: 0px; width:'+f+"px; height:"+l+'px; margin:0; padding:0;" data-pixel-size="'+s+'" data-origin="['+t._toMap([0,0])+']"></div>'),c=u.children(":last"));var d=n.hasOwnProperty("src")?"src":"getUrl",v={bbox:i,width:f,height:l,zoom:t._getZoom(),tile:null,index:0},m=e.isFunction(n[d]),g,y=c.position();y.left=-y.left,y.top=-y.top,m?g=n[d](v):(e.templates("geoSrc",n[d]),g=e.render.geoSrc(v)),r.loadCount++,t._requestQueued(),c.append('<img style="-webkit-transform:translateZ(0);position:absolute; left:'+y.left/c.width()*100+"%; top:"+y.top/c.height()*100+'%; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />'),p=c.children(":last").data("center",t._center),typeof g=="string"?o._loadImage(p,g,s,t,r,h):g.done(function(e){o._loadImage(p,e,s,t,r,h)}).fail(function(){p.remove(),r.loadCount--,t._requestComplete()})}},resize:function(t,n){var r=e.data(n,"geoServiceState");if(r&&n&&n.style.visibility==="visible"){this._cancelUnloaded(t,n);var i=r.serviceContainer,s=t._getContentBounds(),o=s.width,u=s.height,a=i.children();a.attr("data-pixel-size","0"),a.each(function(n){var r=e(this),i=r.position(),s=r.data("origin"),a=t._toPixel(s);r.css({left:i.left+(o-r.width())/2,top:i.top+(u-r.height())/2})})}},opacity:function(t,n){var r=e.data(n,"geoServiceState");r.serviceContainer.find("img").stop(!0).fadeTo("fast",n.style.opacity)},toggle:function(t,n){var r=e.data(n,"geoServiceState");r.serviceContainer.css("display",n.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(t,n){var r=e.data(n,"geoServiceState");if(r&&r.loadCount>0){r.serviceContainer.find("img:hidden").remove();while(r.loadCount>0)r.loadCount--,t._requestComplete()}},_loadImage:function(t,n,r,i,s,o){var u=s.serviceContainer;t.load(function(t){if(!e.contains(document.body,t.target.jquery?t.target[0]:t.target))return;o<1?e(t.target).fadeTo(0,o):e(t.target).show(),s.loadCount--,i._requestComplete(),s.loadCount<=0&&(u.children(':not([data-pixel-size="'+r+'"])').remove(),u.find("img[data-keep-alive]").remove(),s.loadCount=0)}).error(function(t){if(!e.contains(document.body,t.target.jquery?t.target[0]:t.target))return;e(t.target).remove(),s.loadCount--,i._requestComplete(),s.loadCount<=0&&(u.children(":not([data-pixel-size='"+r+"'])").remove(),s.loadCount=0)}).attr("src",n)}}}()}(jQuery);;

// =====  Scripts/jquery-ui-1.8.17.custom.min.js  =====    
/*!
 * jQuery UI 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */(function(a,b){function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;if(!b.href||!g||f.nodeName.toLowerCase()!=="map")return!1;h=a("img[usemap=#"+g+"]")[0];return!!h&&d(h)}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}a.ui=a.ui||{};a.ui.version||(a.extend(a.ui,{version:"1.8.17",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.each(["Width","Height"],function(c,d){function h(b,c,d,f){a.each(e,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),f&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)});return c}var e=d==="Width"?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){if(c===b)return g["inner"+d].call(this);return this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){if(typeof b!="number")return g["outer"+d].call(this,b);return this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!!d&&!!a.element[0].parentNode)for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;if(b[d]>0)return!0;b[d]=1,e=b[d]>0,b[d]=0;return e},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}}))})(jQuery);/*!
 * jQuery UI Widget 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}});return d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e;if(f&&e.charAt(0)==="_")return h;f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b){h=f;return!1}}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))});return h}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}this._setOptions(e);return this},_setOptions:function(b){var c=this;a.each(b,function(a,b){c._setOption(a,b)});return this},_setOption:function(a,b){this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b);return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);this.element.trigger(c,d);return!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}})(jQuery);/*!
 * jQuery UI Mouse 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */(function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent")){a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation();return!1}}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(b){if(!c){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted){b.preventDefault();return!0}}!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0;return!0}},_mouseMove:function(b){if(a.browser.msie&&!(document.documentMode>=9)&&!b.button)return this._mouseUp(b);if(this._mouseStarted){this._mouseDrag(b);return b.preventDefault()}this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b));return!this._mouseStarted},_mouseUp:function(b){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b));return!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})})(jQuery);/*
 * jQuery UI Draggable 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */(function(a,b){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!!this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy();return this}},_mouseCapture:function(b){var c=this.options;if(this.helper||c.disabled||a(b.target).is(".ui-resizable-handle"))return!1;this.handle=this._getHandle(b);if(!this.handle)return!1;c.iframeFix&&a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")});return!0},_mouseStart:function(b){var c=this.options;this.helper=this._createHelper(b),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),c.containment&&this._setContainment();if(this._trigger("start",b)===!1){this._clear();return!1}this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b);return!0},_mouseDrag:function(b,c){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute");if(!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1){this._mouseUp({});return!1}this.position=d.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,b);return!1},_mouseStop:function(b){var c=!1;a.ui.ddmanager&&!this.options.dropBehaviour&&(c=a.ui.ddmanager.drop(this,b)),this.dropped&&(c=this.dropped,this.dropped=!1);if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")return!1;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var d=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){d._trigger("stop",b)!==!1&&d._clear()})}else this._trigger("stop",b)!==!1&&this._clear();return!1},_mouseUp:function(b){this.options.iframeFix===!0&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b);return a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(b){var c=!this.options.handle||!a(this.options.handle,this.element).length?!0:!1;a(this.options.handle,this.element).find("*").andSelf().each(function(){this==b.target&&(c=!0)});return c},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):c.helper=="clone"?this.element.clone().removeAttr("id"):this.element;d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo),d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute");return d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[b.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,b.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(b.containment=="document"?0:a(window).scrollLeft())+a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(b.containment=="document"?0:a(window).scrollTop())+(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)&&b.containment.constructor!=Array){var c=a(b.containment),d=c[0];if(!d)return;var e=c.offset(),f=a(d).css("overflow")!="hidden";this.containment=[(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0),(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0),(f?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(f?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}else b.containment.constructor==Array&&(this.containment=b.containment)},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName),f=b.pageX,g=b.pageY;if(this.originalPosition){var h;if(this.containment){if(this.relative_container){var i=this.relative_container.offset();h=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]}else h=this.containment;b.pageX-this.offset.click.left<h[0]&&(f=h[0]+this.offset.click.left),b.pageY-this.offset.click.top<h[1]&&(g=h[1]+this.offset.click.top),b.pageX-this.offset.click.left>h[2]&&(f=h[2]+this.offset.click.left),b.pageY-this.offset.click.top>h[3]&&(g=h[3]+this.offset.click.top)}if(c.grid){var j=c.grid[1]?this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY;g=h?j-this.offset.click.top<h[1]||j-this.offset.click.top>h[3]?j-this.offset.click.top<h[1]?j+c.grid[1]:j-c.grid[1]:j:j;var k=c.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0]:this.originalPageX;f=h?k-this.offset.click.left<h[0]||k-this.offset.click.left>h[2]?k-this.offset.click.left<h[0]?k+c.grid[0]:k-c.grid[0]:k:k}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),b=="drag"&&(this.positionAbs=this._convertPositionTo("absolute"));return a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(a){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.extend(a.ui.draggable,{version:"1.8.17"}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,d.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("draggable"),e=this,f=function(b){var c=this.offset.click.top,d=this.offset.click.left,e=this.positionAbs.top,f=this.positionAbs.left,g=b.height,h=b.width,i=b.top,j=b.left;return a.ui.isOver(e+c,f+d,i,j,g,h)};a.each(d.sortables,function(f){this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c){var d=a("body"),e=a(this).data("draggable").options;d.css("cursor")&&(e._cursor=d.css("cursor")),d.css("cursor",e.cursor)},stop:function(b,c){var d=a(this).data("draggable").options;d._cursor&&a("body").css("cursor",d._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(b,c){var d=a(this).data("draggable");d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"&&(d.overflowOffset=d.scrollParent.offset())},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=!1;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"){if(!e.axis||e.axis!="x")d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<e.scrollSensitivity?d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop-e.scrollSpeed);if(!e.axis||e.axis!="y")d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<e.scrollSensitivity?d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft-e.scrollSpeed)}else{if(!e.axis||e.axis!="x")b.pageY-a(document).scrollTop()<e.scrollSensitivity?f=a(document).scrollTop(a(document).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<e.scrollSensitivity&&(f=a(document).scrollTop(a(document).scrollTop()+e.scrollSpeed));if(!e.axis||e.axis!="y")b.pageX-a(document).scrollLeft()<e.scrollSensitivity?f=a(document).scrollLeft(a(document).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<e.scrollSensitivity&&(f=a(document).scrollLeft(a(document).scrollLeft()+e.scrollSpeed))}f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c){var d=a(this).data("draggable"),e=d.options;d.snapElements=[],a(e.snap.constructor!=String?e.snap.items||":data(draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!=d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=e.snapTolerance,g=c.offset.left,h=g+d.helperProportions.width,i=c.offset.top,j=i+d.helperProportions.height;for(var k=d.snapElements.length-1;k>=0;k--){var l=d.snapElements[k].left,m=l+d.snapElements[k].width,n=d.snapElements[k].top,o=n+d.snapElements[k].height;if(!(l-f<g&&g<m+f&&n-f<i&&i<o+f||l-f<g&&g<m+f&&n-f<j&&j<o+f||l-f<h&&h<m+f&&n-f<i&&i<o+f||l-f<h&&h<m+f&&n-f<j&&j<o+f)){d.snapElements[k].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=!1;continue}if(e.snapMode!="inner"){var p=Math.abs(n-j)<=f,q=Math.abs(o-i)<=f,r=Math.abs(l-h)<=f,s=Math.abs(m-g)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n-d.helperProportions.height,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l-d.helperProportions.width}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m}).left-d.margins.left)}var t=p||q||r||s;if(e.snapMode!="outer"){var p=Math.abs(n-i)<=f,q=Math.abs(o-j)<=f,r=Math.abs(l-g)<=f,s=Math.abs(m-h)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o-d.helperProportions.height,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m-d.helperProportions.width}).left-d.margins.left)}!d.snapElements[k].snapping&&(p||q||r||s||t)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=p||q||r||s||t}}}),a.ui.plugin.add("draggable","stack",{start:function(b,c){var d=a(this).data("draggable").options,e=a.makeArray(a(d.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});if(!!e.length){var f=parseInt(e[0].style.zIndex)||0;a(e).each(function(a){this.style.zIndex=f+a}),this[0].style.zIndex=f+e.length}}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})})(jQuery);/*
 * jQuery UI Resizable 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Resizables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */(function(a,b){a.widget("ui.resizable",a.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var b=this,c=this.options;this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!c.aspectRatio,aspectRatio:c.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:c.helper||c.ghost||c.animate?c.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&a.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(a('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=c.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var d=this.handles.split(",");this.handles={};for(var e=0;e<d.length;e++){var f=a.trim(d[e]),g="ui-resizable-"+f,h=a('<div class="ui-resizable-handle '+g+'"></div>');/sw|se|ne|nw/.test(f)&&h.css({zIndex:++c.zIndex}),"se"==f&&h.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[f]=".ui-resizable-"+f,this.element.append(h)}}this._renderAxis=function(b){b=b||this.element;for(var c in this.handles){this.handles[c].constructor==String&&(this.handles[c]=a(this.handles[c],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var d=a(this.handles[c],this.element),e=0;e=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth();var f=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join("");b.css(f,e),this._proportionallyResize()}if(!a(this.handles[c]).length)continue}},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!b.resizing){if(this.className)var a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);b.axis=a&&a[1]?a[1]:"se"}}),c.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").hover(function(){c.disabled||(a(this).removeClass("ui-resizable-autohide"),b._handles.show())},function(){c.disabled||b.resizing||(a(this).addClass("ui-resizable-autohide"),b._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var b=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){b(this.element);var c=this.element;c.after(this.originalElement.css({position:c.css("position"),width:c.outerWidth(),height:c.outerHeight(),top:c.css("top"),left:c.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle),b(this.originalElement);return this},_mouseCapture:function(b){var c=!1;for(var d in this.handles)a(this.handles[d])[0]==b.target&&(c=!0);return!this.options.disabled&&c},_mouseStart:function(b){var d=this.options,e=this.element.position(),f=this.element;this.resizing=!0,this.documentScroll={top:a(document).scrollTop(),left:a(document).scrollLeft()},(f.is(".ui-draggable")||/absolute/.test(f.css("position")))&&f.css({position:"absolute",top:e.top,left:e.left}),a.browser.opera&&/relative/.test(f.css("position"))&&f.css({position:"relative",top:"auto",left:"auto"}),this._renderProxy();var g=c(this.helper.css("left")),h=c(this.helper.css("top"));d.containment&&(g+=a(d.containment).scrollLeft()||0,h+=a(d.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:g,top:h},this.size=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()},this.originalSize=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()},this.originalPosition={left:g,top:h},this.sizeDiff={width:f.outerWidth()-f.width(),height:f.outerHeight()-f.height()},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio=typeof d.aspectRatio=="number"?d.aspectRatio:this.originalSize.width/this.originalSize.height||1;var i=a(".ui-resizable-"+this.axis).css("cursor");a("body").css("cursor",i=="auto"?this.axis+"-resize":i),f.addClass("ui-resizable-resizing"),this._propagate("start",b);return!0},_mouseDrag:function(b){var c=this.helper,d=this.options,e={},f=this,g=this.originalMousePosition,h=this.axis,i=b.pageX-g.left||0,j=b.pageY-g.top||0,k=this._change[h];if(!k)return!1;var l=k.apply(this,[b,i,j]),m=a.browser.msie&&a.browser.version<7,n=this.sizeDiff;this._updateVirtualBoundaries(b.shiftKey);if(this._aspectRatio||b.shiftKey)l=this._updateRatio(l,b);l=this._respectSize(l,b),this._propagate("resize",b),c.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",b,this.ui());return!1},_mouseStop:function(b){this.resizing=!1;var c=this.options,d=this;if(this._helper){var e=this._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&a.ui.hasScroll(e[0],"left")?0:d.sizeDiff.height,h=f?0:d.sizeDiff.width,i={width:d.helper.width()-h,height:d.helper.height()-g},j=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,k=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null;c.animate||this.element.css(a.extend(i,{top:k,left:j})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()}a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove();return!1},_updateVirtualBoundaries:function(a){var b=this.options,c,e,f,g,h;h={minWidth:d(b.minWidth)?b.minWidth:0,maxWidth:d(b.maxWidth)?b.maxWidth:Infinity,minHeight:d(b.minHeight)?b.minHeight:0,maxHeight:d(b.maxHeight)?b.maxHeight:Infinity};if(this._aspectRatio||a)c=h.minHeight*this.aspectRatio,f=h.minWidth/this.aspectRatio,e=h.maxHeight*this.aspectRatio,g=h.maxWidth/this.aspectRatio,c>h.minWidth&&(h.minWidth=c),f>h.minHeight&&(h.minHeight=f),e<h.maxWidth&&(h.maxWidth=e),g<h.maxHeight&&(h.maxHeight=g);this._vBoundaries=h},_updateCache:function(a){var b=this.options;this.offset=this.helper.offset(),d(a.left)&&(this.position.left=a.left),d(a.top)&&(this.position.top=a.top),d(a.height)&&(this.size.height=a.height),d(a.width)&&(this.size.width=a.width)},_updateRatio:function(a,b){var c=this.options,e=this.position,f=this.size,g=this.axis;d(a.height)?a.width=a.height*this.aspectRatio:d(a.width)&&(a.height=a.width/this.aspectRatio),g=="sw"&&(a.left=e.left+(f.width-a.width),a.top=null),g=="nw"&&(a.top=e.top+(f.height-a.height),a.left=e.left+(f.width-a.width));return a},_respectSize:function(a,b){var c=this.helper,e=this._vBoundaries,f=this._aspectRatio||b.shiftKey,g=this.axis,h=d(a.width)&&e.maxWidth&&e.maxWidth<a.width,i=d(a.height)&&e.maxHeight&&e.maxHeight<a.height,j=d(a.width)&&e.minWidth&&e.minWidth>a.width,k=d(a.height)&&e.minHeight&&e.minHeight>a.height;j&&(a.width=e.minWidth),k&&(a.height=e.minHeight),h&&(a.width=e.maxWidth),i&&(a.height=e.maxHeight);var l=this.originalPosition.left+this.originalSize.width,m=this.position.top+this.size.height,n=/sw|nw|w/.test(g),o=/nw|ne|n/.test(g);j&&n&&(a.left=l-e.minWidth),h&&n&&(a.left=l-e.maxWidth),k&&o&&(a.top=m-e.minHeight),i&&o&&(a.top=m-e.maxHeight);var p=!a.width&&!a.height;p&&!a.left&&a.top?a.top=null:p&&!a.top&&a.left&&(a.left=null);return a},_proportionallyResize:function(){var b=this.options;if(!!this._proportionallyResizeElements.length){var c=this.helper||this.element;for(var d=0;d<this._proportionallyResizeElements.length;d++){var e=this._proportionallyResizeElements[d];if(!this.borderDif){var f=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],g=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];this.borderDif=a.map(f,function(a,b){var c=parseInt(a,10)||0,d=parseInt(g[b],10)||0;return c+d})}if(a.browser.msie&&(!!a(c).is(":hidden")||!!a(c).parents(":hidden").length))continue;e.css({height:c.height()-this.borderDif[0]-this.borderDif[2]||0,width:c.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset();if(this._helper){this.helper=this.helper||a('<div style="overflow:hidden;"></div>');var d=a.browser.msie&&a.browser.version<7,e=d?1:0,f=d?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+f,height:this.element.outerHeight()+f,position:"absolute",left:this.elementOffset.left-e+"px",top:this.elementOffset.top-e+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(a,b,c){return{width:this.originalSize.width+b}},w:function(a,b,c){var d=this.options,e=this.originalSize,f=this.originalPosition;return{left:f.left+b,width:e.width-b}},n:function(a,b,c){var d=this.options,e=this.originalSize,f=this.originalPosition;return{top:f.top+c,height:e.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),b!="resize"&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.extend(a.ui.resizable,{version:"1.8.17"}),a.ui.plugin.add("resizable","alsoResize",{start:function(b,c){var d=a(this).data("resizable"),e=d.options,f=function(b){a(b).each(function(){var b=a(this);b.data("resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10),position:b.css("position")})})};typeof e.alsoResize=="object"&&!e.alsoResize.parentNode?e.alsoResize.length?(e.alsoResize=e.alsoResize[0],f(e.alsoResize)):a.each(e.alsoResize,function(a){f(a)}):f(e.alsoResize)},resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,e){a(b).each(function(){var b=a(this),f=a(this).data("resizable-alsoresize"),g={},i=e&&e.length?e:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(i,function(a,b){var c=(f[b]||0)+(h[b]||0);c&&c>=0&&(g[b]=c||null)}),a.browser.opera&&/relative/.test(b.css("position"))&&(d._revertToRelativePosition=!0,b.css({position:"absolute",top:"auto",left:"auto"})),b.css(g)})};typeof e.alsoResize=="object"&&!e.alsoResize.nodeType?a.each(e.alsoResize,function(a,b){i(a,b)}):i(e.alsoResize)},stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=function(b){a(b).each(function(){var b=a(this);b.css({position:b.data("resizable-alsoresize").position})})};d._revertToRelativePosition&&(d._revertToRelativePosition=!1,typeof e.alsoResize=="object"&&!e.alsoResize.nodeType?a.each(e.alsoResize,function(a){f(a)}):f(e.alsoResize)),a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","animate",{stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d._proportionallyResizeElements,g=f.length&&/textarea/i.test(f[0].nodeName),h=g&&a.ui.hasScroll(f[0],"left")?0:d.sizeDiff.height,i=g?0:d.sizeDiff.width,j={width:d.size.width-i,height:d.size.height-h},k=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null;d.element.animate(a.extend(j,l&&k?{top:l,left:k}:{}),{duration:e.animateDuration,easing:e.animateEasing,step:function(){var c={width:parseInt(d.element.css("width"),10),height:parseInt(d.element.css("height"),10),top:parseInt(d.element.css("top"),10),left:parseInt(d.element.css("left"),10)};f&&f.length&&a(f[0]).css({width:c.width,height:c.height}),d._updateCache(c),d._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(b,d){var e=a(this).data("resizable"),f=e.options,g=e.element,h=f.containment,i=h instanceof a?h.get(0):/parent/.test(h)?g.parent().get(0):h;if(!!i){e.containerElement=a(i);if(/document/.test(h)||h==document)e.containerOffset={left:0,top:0},e.containerPosition={left:0,top:0},e.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight};else{var j=a(i),k=[];a(["Top","Right","Left","Bottom"]).each(function(a,b){k[a]=c(j.css("padding"+b))}),e.containerOffset=j.offset(),e.containerPosition=j.position(),e.containerSize={height:j.innerHeight()-k[3],width:j.innerWidth()-k[1]};var l=e.containerOffset,m=e.containerSize.height,n=e.containerSize.width,o=a.ui.hasScroll(i,"left")?i.scrollWidth:n,p=a.ui.hasScroll(i)?i.scrollHeight:m;e.parentData={element:i,left:l.left,top:l.top,width:o,height:p}}}},resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.containerSize,g=d.containerOffset,h=d.size,i=d.position,j=d._aspectRatio||b.shiftKey,k={top:0,left:0},l=d.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(k=g),i.left<(d._helper?g.left:0)&&(d.size.width=d.size.width+(d._helper?d.position.left-g.left:d.position.left-k.left),j&&(d.size.height=d.size.width/e.aspectRatio),d.position.left=e.helper?g.left:0),i.top<(d._helper?g.top:0)&&(d.size.height=d.size.height+(d._helper?d.position.top-g.top:d.position.top),j&&(d.size.width=d.size.height*e.aspectRatio),d.position.top=d._helper?g.top:0),d.offset.left=d.parentData.left+d.position.left,d.offset.top=d.parentData.top+d.position.top;var m=Math.abs((d._helper?d.offset.left-k.left:d.offset.left-k.left)+d.sizeDiff.width),n=Math.abs((d._helper?d.offset.top-k.top:d.offset.top-g.top)+d.sizeDiff.height),o=d.containerElement.get(0)==d.element.parent().get(0),p=/relative|absolute/.test(d.containerElement.css("position"));o&&p&&(m-=d.parentData.left),m+d.size.width>=d.parentData.width&&(d.size.width=d.parentData.width-m,j&&(d.size.height=d.size.width/d.aspectRatio)),n+d.size.height>=d.parentData.height&&(d.size.height=d.parentData.height-n,j&&(d.size.width=d.size.height*d.aspectRatio))},stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.position,g=d.containerOffset,h=d.containerPosition,i=d.containerElement,j=a(d.helper),k=j.offset(),l=j.outerWidth()-d.sizeDiff.width,m=j.outerHeight()-d.sizeDiff.height;d._helper&&!e.animate&&/relative/.test(i.css("position"))&&a(this).css({left:k.left-h.left-g.left,width:l,height:m}),d._helper&&!e.animate&&/static/.test(i.css("position"))&&a(this).css({left:k.left-h.left-g.left,width:l,height:m})}}),a.ui.plugin.add("resizable","ghost",{start:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.size;d.ghost=d.originalElement.clone(),d.ghost.css({opacity:.25,display:"block",position:"relative",height:f.height,width:f.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof e.ghost=="string"?e.ghost:""),d.ghost.appendTo(d.helper)},resize:function(b,c){var d=a(this).data("resizable"),e=d.options;d.ghost&&d.ghost.css({position:"relative",height:d.size.height,width:d.size.width})},stop:function(b,c){var d=a(this).data("resizable"),e=d.options;d.ghost&&d.helper&&d.helper.get(0).removeChild(d.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.size,g=d.originalSize,h=d.originalPosition,i=d.axis,j=e._aspectRatio||b.shiftKey;e.grid=typeof e.grid=="number"?[e.grid,e.grid]:e.grid;var k=Math.round((f.width-g.width)/(e.grid[0]||1))*(e.grid[0]||1),l=Math.round((f.height-g.height)/(e.grid[1]||1))*(e.grid[1]||1);/^(se|s|e)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l):/^(ne)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l,d.position.top=h.top-l):/^(sw)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l,d.position.left=h.left-k):(d.size.width=g.width+k,d.size.height=g.height+l,d.position.top=h.top-l,d.position.left=h.left-k)}});var c=function(a){return parseInt(a,10)||0},d=function(a){return!isNaN(parseInt(a,10))}})(jQuery);/*
 * jQuery UI Slider 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Slider
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */(function(a,b){var c=5;a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var b=this,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=d.values&&d.values.length||1,h=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(d.disabled?" ui-slider-disabled ui-disabled":"")),this.range=a([]),d.range&&(d.range===!0&&(d.values||(d.values=[this._valueMin(),this._valueMin()]),d.values.length&&d.values.length!==2&&(d.values=[d.values[0],d.values[0]])),this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(d.range==="min"||d.range==="max"?" ui-slider-range-"+d.range:"")));for(var i=e.length;i<g;i+=1)h.push(f);this.handles=e.add(a(h.join("")).appendTo(b.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){d.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){d.disabled?a(this).blur():(a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),a(this).addClass("ui-state-focus"))}).blur(function(){a(this).removeClass("ui-state-focus")}),this.handles.each(function(b){a(this).data("index.ui-slider-handle",b)}),this.handles.keydown(function(d){var e=!0,f=a(this).data("index.ui-slider-handle"),g,h,i,j;if(!b.options.disabled){switch(d.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:e=!1;if(!b._keySliding){b._keySliding=!0,a(this).addClass("ui-state-active"),g=b._start(d,f);if(g===!1)return}}j=b.options.step,b.options.values&&b.options.values.length?h=i=b.values(f):h=i=b.value();switch(d.keyCode){case a.ui.keyCode.HOME:i=b._valueMin();break;case a.ui.keyCode.END:i=b._valueMax();break;case a.ui.keyCode.PAGE_UP:i=b._trimAlignValue(h+(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.PAGE_DOWN:i=b._trimAlignValue(h-(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(h===b._valueMax())return;i=b._trimAlignValue(h+j);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(h===b._valueMin())return;i=b._trimAlignValue(h-j)}b._slide(d,f,i);return e}}).keyup(function(c){var d=a(this).data("index.ui-slider-handle");b._keySliding&&(b._keySliding=!1,b._stop(c,d),b._change(c,d),a(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy();return this},_mouseCapture:function(b){var c=this.options,d,e,f,g,h,i,j,k,l;if(c.disabled)return!1;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),d={x:b.pageX,y:b.pageY},e=this._normValueFromMouse(d),f=this._valueMax()-this._valueMin()+1,h=this,this.handles.each(function(b){var c=Math.abs(e-h.values(b));f>c&&(f=c,g=a(this),i=b)}),c.range===!0&&this.values(1)===c.min&&(i+=1,g=a(this.handles[i])),j=this._start(b,i);if(j===!1)return!1;this._mouseSliding=!0,h._handleIndex=i,g.addClass("ui-state-active").focus(),k=g.offset(),l=!a(b.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:b.pageX-k.left-g.width()/2,top:b.pageY-k.top-g.height()/2-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,i,e),this._animateOff=!0;return!0},_mouseStart:function(a){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);this._slide(a,this._handleIndex,c);return!1},_mouseStop:function(a){this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1;return!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;this.orientation==="horizontal"?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),d<0&&(d=0),this.orientation==="vertical"&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e;return this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values());return this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),this.options.values.length===2&&this.options.range===!0&&(b===0&&c>d||b===1&&c<d)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c,!0))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("change",a,c)}},value:function(a){if(arguments.length)this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,0);else return this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),this._change(null,b);else{if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();d=this.options.values,e=arguments[0];for(f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()}},_setOption:function(b,c){var d,e=0;a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments);switch(b){case"disabled":c?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1}},_value:function(){var a=this.options.value;a=this._trimAlignValue(a);return a},_values:function(a){var b,c,d;if(arguments.length){b=this.options.values[a],b=this._trimAlignValue(b);return b}c=this.options.values.slice();for(d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;Math.abs(c)*2>=b&&(d+=c>0?b:-b);return parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b=this.options.range,c=this.options,d=this,e=this._animateOff?!1:c.animate,f,g={},h,i,j,k;this.options.values&&this.options.values.length?this.handles.each(function(b,i){f=(d.values(b)-d._valueMin())/(d._valueMax()-d._valueMin())*100,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",a(this).stop(1,1)[e?"animate":"css"](g,c.animate),d.options.range===!0&&(d.orientation==="horizontal"?(b===0&&d.range.stop(1,1)[e?"animate":"css"]({left:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({width:f-h+"%"},{queue:!1,duration:c.animate})):(b===0&&d.range.stop(1,1)[e?"animate":"css"]({bottom:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({height:f-h+"%"},{queue:!1,duration:c.animate}))),h=f}):(i=this.value(),j=this._valueMin(),k=this._valueMax(),f=k!==j?(i-j)/(k-j)*100:0,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",this.handle.stop(1,1)[e?"animate":"css"](g,c.animate),b==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[e?"animate":"css"]({width:f+"%"},c.animate),b==="max"&&this.orientation==="horizontal"&&this.range[e?"animate":"css"]({width:100-f+"%"},{queue:!1,duration:c.animate}),b==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[e?"animate":"css"]({height:f+"%"},c.animate),b==="max"&&this.orientation==="vertical"&&this.range[e?"animate":"css"]({height:100-f+"%"},{queue:!1,duration:c.animate}))}}),a.extend(a.ui.slider,{version:"1.8.17"})})(jQuery);

// =====  Scripts/jquery.ui.touch-punch.js  =====    
/*!
* jQuery UI Touch Punch 0.2.2
*
* Copyright 2011, Dave Furfero
* Dual licensed under the MIT or GPL Version 2 licenses.
*
* Depends:
*  jquery.ui.widget.js
*  jquery.ui.mouse.js
*/
(function ($) {

  // Detect touch support
  $.support.touch = 'ontouchend' in document;

  // Ignore browsers without touch support
  if (!$.support.touch) {
    return;
  }

  var mouseProto = $.ui.mouse.prototype,
      _mouseInit = mouseProto._mouseInit,
      touchHandled;

  /**
  * Simulate a mouse event based on a corresponding touch event
  * @param {Object} event A touch event
  * @param {String} simulatedType The corresponding mouse event
  */
  function simulateMouseEvent(event, simulatedType) {

    // Ignore multi-touch events
    if (event.originalEvent.touches.length > 1) {
      return;
    }

    event.preventDefault();

    var touch = event.originalEvent.changedTouches[0],
        simulatedEvent = document.createEvent('MouseEvents');

    // Initialize the simulated mouse event using the touch event's coordinates
    simulatedEvent.initMouseEvent(
      simulatedType,    // type
      true,             // bubbles                    
      true,             // cancelable                 
      window,           // view                       
      1,                // detail                     
      touch.screenX,    // screenX                    
      touch.screenY,    // screenY                    
      touch.clientX,    // clientX                    
      touch.clientY,    // clientY                    
      false,            // ctrlKey                    
      false,            // altKey                     
      false,            // shiftKey                   
      false,            // metaKey                    
      0,                // button                     
      null              // relatedTarget              
    );

    // Dispatch the simulated event to the target element
    event.target.dispatchEvent(simulatedEvent);
  }

  /**
  * Handle the jQuery UI widget's touchstart events
  * @param {Object} event The widget element's touchstart event
  */
  mouseProto._touchStart = function (event) {

    var self = this;

    // Ignore the event if another widget is already being handled
    if (touchHandled || !self._mouseCapture(event.originalEvent.changedTouches[0])) {
      return;
    }

    // Set the flag to prevent other widgets from inheriting the touch event
    touchHandled = true;

    // Track movement to determine if interaction was a click
    self._touchMoved = false;

    // Simulate the mouseover event
    simulateMouseEvent(event, 'mouseover');

    // Simulate the mousemove event
    simulateMouseEvent(event, 'mousemove');

    // Simulate the mousedown event
    simulateMouseEvent(event, 'mousedown');
  };

  /**
  * Handle the jQuery UI widget's touchmove events
  * @param {Object} event The document's touchmove event
  */
  mouseProto._touchMove = function (event) {

    // Ignore event if not handled
    if (!touchHandled) {
      return;
    }

    // Interaction was not a click
    this._touchMoved = true;

    // Simulate the mousemove event
    simulateMouseEvent(event, 'mousemove');
  };

  /**
  * Handle the jQuery UI widget's touchend events
  * @param {Object} event The document's touchend event
  */
  mouseProto._touchEnd = function (event) {

    // Ignore event if not handled
    if (!touchHandled) {
      return;
    }

    // Simulate the mouseup event
    simulateMouseEvent(event, 'mouseup');

    // Simulate the mouseout event
    simulateMouseEvent(event, 'mouseout');

    // If the touch interaction did not move, it should trigger a click
    if (!this._touchMoved) {

      // Simulate the click event
      simulateMouseEvent(event, 'click');
    }

    // Unset the flag to allow other widgets to inherit the touch event
    touchHandled = false;
  };

  /**
  * A duck punch of the $.ui.mouse _mouseInit method to support touch events.
  * This method extends the widget with bound touch event handlers that
  * translate touch events to mouse events and pass them to the widget's
  * original mouse event handling methods.
  */
  mouseProto._mouseInit = function () {

    var self = this;

    // Delegate the touch handlers to the widget's element
    self.element
      .bind('touchstart', $.proxy(self, '_touchStart'))
      .bind('touchmove', $.proxy(self, '_touchMove'))
      .bind('touchend', $.proxy(self, '_touchEnd'));

    // Call the original $.ui.mouse init method
    _mouseInit.call(self);
  };

})(jQuery);

// =====  Scripts/jquery.cookie.min.js  =====    
/**
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */

jQuery.cookie=function(d,c,a){if(typeof c!="undefined"){a=a||{};if(c===null){c="";a.expires=-1}var h="";if(a.expires&&(typeof a.expires=="number"||a.expires.toUTCString)){var b;if(typeof a.expires=="number"){b=new Date;b.setTime(b.getTime()+a.expires*24*60*60*1e3)}else b=a.expires;h="; expires="+b.toUTCString()}var l=a.path?"; path="+a.path:"",j=a.domain?"; domain="+a.domain:"",k=a.secure?"; secure":"";document.cookie=[d,"=",encodeURIComponent(c),h,l,j,k].join("")}else{var f=null;if(document.cookie&&document.cookie!="")for(var g=document.cookie.split(";"),e=0;e<g.length;e++){var i=jQuery.trim(g[e]);if(i.substring(0,d.length+1)==d+"="){f=decodeURIComponent(i.substring(d.length+1));break}}return f}};



// =====  Scripts/jquery.watermark.min.js  =====    
/*
	Watermark v3.1.3 (March 22, 2011) plugin for jQuery
	http://jquery-watermark.googlecode.com/
	Copyright (c) 2009-2011 Todd Northrop
	http://www.speednet.biz/
	Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(a,h,y){var w="function",v="password",j="maxLength",n="type",b="",c=true,u="placeholder",i=false,t="watermark",g=t,f="watermarkClass",q="watermarkFocus",l="watermarkSubmit",o="watermarkMaxLength",e="watermarkPassword",d="watermarkText",k=/\r/g,s="input:data("+g+"),textarea:data("+g+")",m="input:text,input:password,input[type=search],input:not([type]),textarea",p=["Page_ClientValidate"],r=i,x=u in document.createElement("input");a.watermark=a.watermark||{version:"3.1.3",runOnce:c,options:{className:t,useNative:c,hideBeforeUnload:c},hide:function(b){a(b).filter(s).each(function(){a.watermark._hide(a(this))})},_hide:function(a,r){var p=a[0],q=(p.value||b).replace(k,b),l=a.data(d)||b,m=a.data(o)||0,i=a.data(f);if(l.length&&q==l){p.value=b;if(a.data(e))if((a.attr(n)||b)==="text"){var g=a.data(e)||[],c=a.parent()||[];if(g.length&&c.length){c[0].removeChild(a[0]);c[0].appendChild(g[0]);a=g}}if(m){a.attr(j,m);a.removeData(o)}if(r){a.attr("autocomplete","off");h.setTimeout(function(){a.select()},1)}}i&&a.removeClass(i)},show:function(b){a(b).filter(s).each(function(){a.watermark._show(a(this))})},_show:function(g){var p=g[0],u=(p.value||b).replace(k,b),h=g.data(d)||b,s=g.attr(n)||b,t=g.data(f);if((u.length==0||u==h)&&!g.data(q)){r=c;if(g.data(e))if(s===v){var m=g.data(e)||[],l=g.parent()||[];if(m.length&&l.length){l[0].removeChild(g[0]);l[0].appendChild(m[0]);g=m;g.attr(j,h.length);p=g[0]}}if(s==="text"||s==="search"){var i=g.attr(j)||0;if(i>0&&h.length>i){g.data(o,i);g.attr(j,h.length)}}t&&g.addClass(t);p.value=h}else a.watermark._hide(g)},hideAll:function(){if(r){a.watermark.hide(m);r=i}},showAll:function(){a.watermark.show(m)}};a.fn.watermark=a.fn.watermark||function(p,o){var t="string";if(!this.length)return this;var s=i,r=typeof p===t;if(r)p=p.replace(k,b);if(typeof o==="object"){s=typeof o.className===t;o=a.extend({},a.watermark.options,o)}else if(typeof o===t){s=c;o=a.extend({},a.watermark.options,{className:o})}else o=a.watermark.options;if(typeof o.useNative!==w)o.useNative=o.useNative?function(){return c}:function(){return i};return this.each(function(){var B="dragleave",A="dragenter",z=this,i=a(z);if(!i.is(m))return;if(i.data(g)){if(r||s){a.watermark._hide(i);r&&i.data(d,p);s&&i.data(f,o.className)}}else{if(x&&o.useNative.call(z,i)&&(i.attr("tagName")||b)!=="TEXTAREA"){r&&i.attr(u,p);return}i.data(d,r?p:b);i.data(f,o.className);i.data(g,1);if((i.attr(n)||b)===v){var C=i.wrap("<span>").parent(),t=a(C.html().replace(/type=["']?password["']?/i,'type="text"'));t.data(d,i.data(d));t.data(f,i.data(f));t.data(g,1);t.attr(j,p.length);t.focus(function(){a.watermark._hide(t,c)}).bind(A,function(){a.watermark._hide(t)}).bind("dragend",function(){h.setTimeout(function(){t.blur()},1)});i.blur(function(){a.watermark._show(i)}).bind(B,function(){a.watermark._show(i)});t.data(e,i);i.data(e,t)}else i.focus(function(){i.data(q,1);a.watermark._hide(i,c)}).blur(function(){i.data(q,0);a.watermark._show(i)}).bind(A,function(){a.watermark._hide(i)}).bind(B,function(){a.watermark._show(i)}).bind("dragend",function(){h.setTimeout(function(){a.watermark._show(i)},1)}).bind("drop",function(e){var c=i[0],a=e.originalEvent.dataTransfer.getData("Text");if((c.value||b).replace(k,b).replace(a,b)===i.data(d))c.value=a;i.focus()});if(z.form){var w=z.form,y=a(w);if(!y.data(l)){y.submit(a.watermark.hideAll);if(w.submit){y.data(l,w.submit);w.submit=function(c,b){return function(){var d=b.data(l);a.watermark.hideAll();if(d.apply)d.apply(c,Array.prototype.slice.call(arguments));else d()}}(w,y)}else{y.data(l,1);w.submit=function(b){return function(){a.watermark.hideAll();delete b.submit;b.submit()}}(w)}}}}a.watermark._show(i)})};if(a.watermark.runOnce){a.watermark.runOnce=i;a.extend(a.expr[":"],{data:function(c,d,b){return!!a.data(c,b[3])}});(function(c){a.fn.val=function(){var e=this;if(!e.length)return arguments.length?e:y;if(!arguments.length)if(e.data(g)){var f=(e[0].value||b).replace(k,b);return f===(e.data(d)||b)?b:f}else return c.apply(e,arguments);else{c.apply(e,arguments);a.watermark.show(e);return e}}})(a.fn.val);p.length&&a(function(){for(var b,c,d=p.length-1;d>=0;d--){b=p[d];c=h[b];if(typeof c===w)h[b]=function(b){return function(){a.watermark.hideAll();return b.apply(null,Array.prototype.slice.call(arguments))}}(c)}});a(h).bind("beforeunload",function(){a.watermark.options.hideBeforeUnload&&a.watermark.hideAll()})}})(jQuery,window);

// =====  Scripts/JsonStringify.js  =====    
(function(i){var b="null",d="function",c="undefined",a='"',h={}.hasOwnProperty?true:false,j={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function f(b){if(/["\\\x00-\x1f]/.test(b))return a+b.replace(/([\x00-\x1f\\"])/g,function(c,b){var a=j[b];if(a)return a;a=b.charCodeAt();return "\\u00"+Math.floor(a/16).toString(16)+(a%16).toString(16)})+a;return a+b+a}function g(i){for(var a=["["],h,f=0;f<i.length;f+=1){var g=i[f];switch(typeof g){case c:case d:case "unknown":break;default:h&&a.push(",");a.push(g===null?b:e(g));h=true}}a.push("]");return a.join("")}function e(i){if(typeof i==c||i===null)return b;else if(i instanceof Array)return g(i);else if(i instanceof Date)return a+i.toUTCString()+a;else if(typeof i=="string")return f(i);else if(typeof i=="number")return isFinite(i)?String(i):b;else if(typeof i=="boolean")return String(i);else{var j=["{"],m;for(var k in i)if(!h||i.hasOwnProperty(k)){var l=i[k];switch(typeof l){case c:case d:case "unknown":break;default:m&&j.push(",");j.push(e(k),":",l===null?b:e(l));m=true}}j.push("}");return j.join("")}}i.stringifyJSON=e})(jQuery);

// =====  Scripts/ColorSelector.js  =====    
(function(a){a.fn.colorSelector=function(f){var b=100,c="colorSelector",d="backgroundColor";function i(b,a){if(a.enabled)b.css(d,a.color).removeClass(a.disabledClass).addClass(a.enabledClass);else b.css(d,a.disabledColor).removeClass(a.enabledClass).addClass(a.disabledClass)}function j(a){a="ontouchend" in document?a.originalEvent.changedTouches[0]:a;return [a.pageX,a.pageY]}function k(a){var c=/rgb\((\d+),\s*(\d+),\s*(\d+)\)/.exec(a);if(c&&c.length)a={r:parseInt(c[1],10),g:parseInt(c[2],10),b:parseInt(c[3],10)};else{c=/#([\d|A-F]{2})([\d|A-F]{2})([\d|A-F]{2})/i.exec(a);a={r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}}var d=a.r>a.g?a.r>a.b?a.r:a.b:a.g>a.b?a.g:a.b,g=a.r<a.g?a.r<a.b?a.r:a.b:a.g<a.b?a.g:a.b,e=d-g,h=d>0?e*b/d:0,j=d*b/255,f=0;if(d>0&&e>0){var i=d==a.r?a.g-a.b:d==a.g?2*e+a.b-a.r:4*e+a.r-a.g;f=(360+i*60/e)%360}return {h:f,s:h,v:j}}function e(a){var d=(a.r<16?"0":"")+a.r.toString(16),c=(a.g<16?"0":"")+a.g.toString(16),b=(a.b<16?"0":"")+a.b.toString(16);return "#"+d+c+b}function g(f){var d=f.s*.01,c=f.v*.01,a=parseInt(c*255);if(this.s==0)return e({r:a,g:a,b:a});else{var j=f.h/60,i=parseInt(Math.floor(j)),k=j-i,b=parseInt(c*(1-d)*255),g=parseInt(c*(1-d*k)*255),h=parseInt(c*(1-d*(1-k))*255);switch(i){case 0:case 6:return e({r:a,g:h,b:b});case 1:return e({r:g,g:a,b:b});case 2:return e({r:b,g:a,b:h});case 3:return e({r:b,g:g,b:a});case 4:return e({r:h,g:b,b:a});case 5:return e({r:a,g:b,b:g})}}}var h={init:function(e){return this.each(function(){var l="px",h="left",f=null,p=a(this),n={color:p.css(d),disabledColor:"#A0A0A0",enabled:true,enabledClass:f,disabledClass:f,selectorClass:f};e&&a.extend(n,e);n.colorChanged="colorChanged" in e?[e.colorChanged]:[];p.data(c,n);i(p,n);var m,t,w,s,v,B,u,r="cs"+(new Date).valueOf(),o=k(n.color),q=f;n.showSelector=function(){var c="touchstart mousedown";if(n.enabled&&!m){m=a('<div style="position: absolute; width: 120px; height: 120px" />').addClass(n.selectorClass).addClass(r);var e=p.offset(),l=a(window).width(),k=a(window).height();m.offset({left:e.left<l-110?e.left+10:l-120,top:e.top<k-110?e.top+10:k-120});y("Hue","10px",function(a){return g({h:a*3.6,s:b,v:b})});w=x("9px",parseInt(o.h/3.6));t=y("Saturation","30px",function(){return "#000000"});s=x("29px",o.s);z();y("Value","50px",function(a){return g({h:0,s:0,v:a})});v=x("49px",o.v);B=C("Current Color","10px").css(d,n.color);u=C("New Color","60px").css(d,n.color);var i=a('<div style="position: absolute; left: 10px; top: 100px" />').appendTo(m);a('<span style="margin-right: 5px; cursor: default">OK</span>').appendTo(i).on(c,function(){n.color=g(o);p.css(d,n.color);a.each(n.colorChanged,function(b,a){a(n.color)});A()});a('<span style="cursor: default">Cancel</span>').appendTo(i).on(c,function(){A()});a("body").append(m);var h=a("."+r);h.on(c,function(d){var a=j(d),c=a[0]-m.offset().left;if(10<=c&&c<=110){var b=a[1]-m.offset().top;if(b%20>10){q=b<=20?"h":b<=40?"s":"v";D(a[0]-m.offset().left)}}});h.on("touchmove mousemove",function(b){if(q){var a=j(b);if(a[1]-m.offset().top<70)D(a[0]-m.offset().left);else q=f}return false});h.on("touchend touchcancel mouseup",function(){q=f;return false});m.on("touchleave mouseleave",function(){q=f})}};p.on("touchstart."+c+" mousedown.",+c,n.showSelector);function A(){m.remove();m=f;t=f;w=f;s=f;v=f;$surface=f;B=f;u=f}function y(g,h,f){for(var e=a('<table cellspacing="0" cellpadding="0" style="position: absolute; left: 10px"><tbody><tr style="height: 10px" /></tbody></table>').addClass(r).css("top",h).attr("title",g).appendTo(m).find("tr"),c=0;c<=b;++c)a('<td style="width: 1px" />').css(d,f(c)).appendTo(e);return e}function C(b,c){return a('<div style="position: absolute; top: 70px; width: 50px; height: 25px" />').attr("title",b).css(h,c).appendTo(m)}function x(c,b){return a('<div style="position: absolute; width: 1px; height: 10px; border: solid 1px #404040" />').addClass(r).css(h,b+9+l).css("top",c).appendTo(m)}function D(a){a=a<10?0:a>110?b:a-10;switch(q){case "h":o.h=a*3.6;w.css(h,a+9+l);z();break;case "s":o.s=a;s.css(h,a+9+l);break;case "v":o.v=a;v.css(h,a+9+l)}u.css(d,g(o))}function z(){t.find("td").each(function(c){a(this).css(d,g({h:o.h,s:c,v:b}))})}})},color:function(b){if(b)return this.each(function(){var f=a(this),e=f.data(c);e.color=b;e.enabled&&f.css(d,e)});else return a(this).data(c).color},colorChanged:function(b){return this.each(function(){a(this).data(c).colorChanged.push(b)})},enabled:function(b){if(typeof b=="boolean")return this.each(function(){var e=a(this),d=e.data(c);d.enabled=b;i(e,d)});else return a(this).data(c).enabled},showSelector:function(){return a(this).data(c).showSelector()},dispose:function(){return this.each(function(){var b=a(this);b.removeData(c);b.unbind("."+c)})}};if(h[f])return h[f].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof f==="object"||!f)return h.init.apply(this,arguments);else a.error("Method "+f+" does not exist in colorSelector")}})(jQuery);

// =====  Scripts/Dockable.js  =====    
(function(a){a.fn.dockable=function(n){var h="disabled",g="option",l="orthogonal",c="",b="px",e="bottom",j="top",d="right",i="left",m="resizable",f=false,k="dockable",o={init:function(b){return this.each(function(){var d=a(this),c={container:null,isDocked:f,docked:{left:0,top:0,width:100,height:20},opened:{left:0,top:20,width:100,height:100},motion:"direct",duration:1200,dock:[],open:[]};if(b){a.extend(c,b);a.each(["dock","open"],function(){if(typeof c[this]=="function")c[this]=[c[this]]})}d.data(k,c);a.each([["draggable","dragstop"],[m,"resizestop"]],function(){var b=this;if(b[0] in c){var e=a.extend(c[b[0]],{disabled:c.isDocked});d[b[0]](e);d.on(b[1],function(b){a(b.target).dockable("updateOpenedSettings")});"stop" in c[b[0]]&&d.on(b[1],c[b[0]].stop)}})})},isDocked:function(){return this.eq(0).data(k).isDocked},opened:function(){var b=this.eq(0).data(k),c={};a.each([i,d,j,e],function(d,a){if(a in b.opened)c[a]=b.opened[a]});m in b&&a.extend(c,{width:b.opened.width,height:b.opened.height});return c},updateOpenedSettings:function(){return this.each(function(){var g=a(this),f=g.data(k),n=g.height()<f.container[0].offsetHeight?g.height():f.container[0].offsetHeight,o=g.width()<f.container[0].offsetWidth?g.width():f.container[0].offsetWidth;f.opened={width:o,height:n};g.css("width",f.opened.width+b);g.css("height",f.opened.height+b);var h=g.position(),m=f.container.width()-(h.left+g.outerWidth()),l=f.container.height()-(h.top+g.outerHeight());g.css({left:c,right:c,top:c,bottom:c});if(h.left<=m){f.opened.left=h.left>=0?h.left:0;g.css(i,f.opened.left+b)}else{f.opened.right=m>=0?m:0;g.css(d,f.opened.right+b)}if(h.top<=l||l>50){f.opened.top=h.top>=0?h.top:0;g.css(j,f.opened.top+b)}else{f.opened.bottom=l>=0?l:0;g.css(e,f.opened.bottom+b)}})},dock:function(f){if(f)return this.each(function(){a(this).data(k).dock.push(f)});else return this.each(function(){var m=a(this).addClass("Docked"),f=m.data(k);if(!f.isDocked){m.css({left:m.position().left+b,top:m.position().top+b,right:c,bottom:c});var r=m.outerWidth()-m.innerWidth(),q=m.outerHeight()-m.innerHeight(),s=i in f.docked?f.docked.left:f.container.width()-f.docked.right-f.docked.width-r,t=j in f.docked?f.docked.top:f.container.height()-f.docked.bottom-f.docked.height-q;function o(){a.each(f.dock,function(){this({target:m.get(0)})});d in f.docked&&m.css({left:c,right:f.docked.right+b});e in f.opened&&m.css({top:c,bottom:f.docked.bottom+b})}switch(f.motion){case l:var n=Math.round(f.duration*.25),p=Math.round(f.duration*.125);m.animate({height:f.docked.height},n).delay(p).animate({left:s,width:f.docked.width},n).delay(p).animate({top:t},n,o);break;default:m.animate({left:f.docked.left,top:f.docked.top,width:f.docked.width,height:f.docked.height},f.duration,o)}f.isDocked=true;m.draggable(g,h,true);f.resizable&&m.resizable(g,h,true)}})},open:function(m){if(m)return this.each(function(){a(this).data(k).open.push(m)});else return this.each(function(){var n=a(this).removeClass("Docked"),m=n.data(k);if(m.isDocked){n.css({left:n.position().left+b,top:n.position().top+b,right:c,bottom:c});var u=n.outerWidth()-n.innerWidth(),t=n.outerHeight()-n.innerHeight(),q=i in m.opened?m.opened.left:m.container.width()-m.opened.right-m.opened.width-u,r=j in m.opened?m.opened.top:m.container.height()-m.opened.bottom-m.opened.height-t;function p(){a.each(m.open,function(){this({target:n.get(0)})});d in m.opened&&n.css({left:c,right:m.opened.right+b});e in m.opened&&n.css({top:c,bottom:m.opened.bottom+b})}switch(m.motion){case l:var o=Math.round(m.duration*.25),s=Math.round(m.duration*.125);n.animate({top:r},o).delay(s).animate({left:q,width:m.opened.width},o).delay(s).animate({height:m.opened.height},o,p);break;default:n.animate({left:q,top:r,width:m.opened.width,height:m.opened.height},m.duration,p)}m.isDocked=f;n.draggable(g,h,f);m.resizable&&n.resizable(g,h,f)}})}};if(o[n])return o[n].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof n==="object"||!n)return o.init.apply(this,arguments);else a.error("Method "+n+" does not exist in "+k)}})(jQuery);

// =====  Scripts/Expander.js  =====    
(function(a){a.fn.expander=function(d){var b="function",c="expander";function g(e,f){var d=a(e),b=d.data(c);if(d.hasClass(b.closedClass)){d.removeClass(b.closedClass).addClass(b.openedClass);b.groupClass&&a("."+b.groupClass).each(function(c,b){b!=e&&a(b).expander("close")});f&&a(b.target).animate({height:b.openedHeight});a.each(b.change,function(){this(e,true)})}}function f(e,f){var d=a(e),b=d.data(c);if(d.hasClass(b.openedClass)){d.removeClass(b.openedClass).addClass(b.closedClass);f&&a(b.target).animate({height:b.closedHeight});a.each(b.change,function(){this(e,false)})}}var e={init:function(d){return this.each(function(){var h=a(this),e={target:null,openedHeight:0,closedHeight:0,openedClass:"Opened",closedClass:"Closed",disabledClass:"Disabled",groupClass:null,change:[]};if(d){a.extend(e,d);if(typeof e.change==b)e.change=[e.change]}h.data(c,e);h.on("click",function(){if(!h.hasClass(e.disabledClass))if(h.hasClass(e.closedClass))g(this,true);else f(this,true)})})},isOpen:function(){var a=this.eq(0).data(c);return this.hasClass(a.openedClass)},change:function(d){return this.each(function(){typeof d==b&&a(this).data(c).change.push(d)})},close:function(a){return this.each(function(){f(this,a)})},open:function(a){return this.each(function(){g(this,a)})}};if(e[d])return e[d].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof d==="object"||!d)return e.init.apply(this,arguments);else a.error("Method "+d+" does not exist in "+c)}})(jQuery);

// =====  Scripts/MapGeo.js  =====    
var MG=function(b){var a=null,g=15*60*1e3,c=null,e="ontouchend" in document;function f(){if("session" in a){a.session.end=d();$.post("LogUse.ashx","log="+escape($.stringifyJSON(a)))}}function d(){return (new Date).valueOf()}b.getTouch=function(a){a=e?a.originalEvent.changedTouches[0]:a;return [a.pageX,a.pageY]};b.getUrlParams=function(){var e=window.location.search.substring(1),d=/([^&=]+)=?([^&]*)/g,a,b=function(a){return decodeURIComponent(a.replace(/\+/g," "))},c={};while(a=d.exec(e))c[b(a[1])]=b(a[2]);return c};b.logStart=function(b){a={appid:b}};b.logUse=function(h,j,e){if(!("session" in a))a.session={start:d()};var k=h in a?a[h]:(a[h]={}),b=j in k?k[j]:(k[j]={c:0});b.c+=1;if(e)if(e.elapsed){var l=e;if(!("t" in b))b.t=0;b.t+=l.elapsed()}else{var i=e,m=i in b?b[i]:(b[i]={c:0});m.c+=1}c&&clearTimeout(c);c=setTimeout(function(){f();a={appid:a.appid};c=null},g)};b.logEnd=f;b.supportsTouch=e;b.timer=function(){var a=d();return {elapsed:function(){return d()-a}}};return b}(MG||{});

// =====  Scripts/WebMercator.js  =====    
var MG=function(a){a.webMercator=function(){var f=1.5707963267949e0,e=.78539816339744828,c=.017453292519943295,b=57.295779513082323,a=6378137,d={getScaleFactor:function(c){var b=Math.PI*.5-2*Math.atan(Math.pow(Math.E,-c[1]/a));return 1/Math.cos(b)},toGeodetic:function(c){var e=c[0]/a*b,d=(f-2*Math.atan(1/Math.exp(c[1]/a)))*b;return [e,d]},toProjected:function(b){var d=a*b[0]*c,f=a*Math.log(Math.tan(e+b[1]*c/2));return [d,f]}};return d}();return a}(MG||{});

// =====  Scripts/ZoomBar.js  =====    
var MG=function(a){a.zoomBar=function(){var l=$("#zoomBar"),c=$("#zoomBarActive"),d=false;c.on("dragstart selectstart",function(a){a.preventDefault()});var b=0,e=parseInt(l.attr("data-maxlevel"),10),j=[];function h(a){a+=b;if(0<=a&&a<=e){b=a;f(b);i()}}function g(g){var d=a.getTouch(g)[1]-c.offset().top,b=k(e-Math.round((d-7)/8));f(b);return b}function k(a){return a<0?0:a<e?a:e}function i(){$.each(j,function(c,a){a(b)})}function f(b){var a=c.offset();$("#zoomBarSlider").offset({left:a.left,top:a.top+2+(e-b)*8})}c.on("touchstart mousedown",function(a){d=true;g(a)});c.on("touchmove mousemove",function(a){d&&g(a)});c.on("touchend touchcancel mouseup",function(c){if(d){var a=g(c);if(a!=b){b=a;i()}d=false}});c.on("touchleave mouseleave",function(){if(d){f(b);d=false}});$("#zoomBarMinus").on("click",function(){h(-1)});$("#zoomBarPlus").on("click",function(){h(1)});var m={getLevel:function(){return b},levelChanged:function(a){j.push(a)},setLevel:function(a){b=k(a);f(b)}};return m};return a}(MG||{});

// =====  Scripts/Selection.js  =====    
var MG=function(a){a.selection=function(){var h="Selection.ashx?m=GetParcelByPropertyID&id=",d="siteAddressSort",b="selection",a=null,f=a,c=[],e=[],n=a,s=[],p=[],o=[];function i(a){$.each(o,function(){this(a)})}function q(){e=[];n=a;i()}function l(a){$.each(a,function(b,a){$.each(a.properties,function(){this.parcel=a})});return a}function g(c,d){var b=$.grep(c,function(b){return k(b,d)!=a});return b.length>0?b[0]:a}function k(d,c){var b=$.grep(d.properties,function(a){return a.id==c});return b.length>0?b[0]:a}function m(c,a){var b=$.map(c,function(a){return a.properties});b.sort(function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0});return b}function j(a){$.each(p,function(){this(a)})}function r(e,a,h){var i=MG.timer();$.getJSON("Selection.ashx?"+e,function(n){MG.logUse(b,"select parcels",i);c=l(n.parcels);if(a){var e=g(c,a);f=k(e,a)}else f=m(c,d)[0];j(h)})}var t={add:function(a,d){var e=MG.timer();$.getJSON(h+escape(a),function(h){MG.logUse(b,"add parcel",e);var g=l(h.parcels)[0];c.push(g);f=k(g,a);j(d)})},addAbutter:function(d,a){var c=MG.timer();$.getJSON(h+escape(d),function(f){MG.logUse(b,"add abutter",c);var d=l(f.parcels)[0];e.push(d);i(a)})},abuttersChanged:function(a){o.push(a)},clear:function(b){q();f=a;c=[];j(b)},clearAbutters:q,changeProperty:function(d,e){var b=g(c,d);f=b?k(b,d):a;j(e)},findAbutters:function(g,d){e=[];n=a;if(c.length){var j=$.map(c,function(a){return escape(a.id)}).join(","),h=MG.timer();$.ajax({type:"POST",url:"Selection.ashx",data:"m=FindAbutters&ids="+j+"&pid="+f.id+"&d="+g,dataType:"json",success:function(a){MG.logUse(b,"find abutters",h);e=l(a.abutters);n=a.buffer;s=a.externalLinks;i(d)}})}else i(d)},getAbutters:function(){return e},getAbutterLinks:function(){return s},getAbutterProperties:function(a){return m(e,a?a:d)},getBuffer:function(){return n},getParcels:function(){return c},getParcelProperties:function(){return m(c,d)},getProperty:function(){return f},hasAbutterForProperty:function(b){return g(e,b)!=a},hasParcelForProperty:function(b){return g(c,b)!=a},parcelsChanged:function(a){p.push(a)},remove:function(e,b){var a=g(c,e);c.splice($.inArray(a,c),1);if(!f||$.inArray(f,a.properties)>=0)f=m(c,d)[0];j(b)},removeAbutter:function(b,d){var a=g(e,b),c=k(a,b);a.properties.splice($.inArray(c,a.properties),1);!a.properties.length&&e.splice($.inArray(a,e),1);i(d)},selectOne:function(a,b){r("m=GetParcelByPropertyID&id="+escape(a),a,b)},selectMultiple:function(b,c){r("m=GetParcelsFromSearch&c="+escape(b),a,c)}};return t};return a}(MG||{});

// =====  Scripts/Search.js  =====    
var MG=function(a){a.search=function(p){var c="click",a="search",g="#search",b=$(g),n=p.selection,q=0,f=null,l=b.find("#ddlSearchSort"),k=b.find("#pnlSearchCount"),i=b.find("#pnlSearchResults"),m=b.find("#pnlSearchPage"),e=b.find("#cmdShowAllResults"),j=b.find("#spnSearchMessage"),d=b.find("#tboSearch"),o=d.val();d.empty().watermark(o,{className:"Watermark",useNative:false});b.dockable("open",function(){MG.logUse(a,"open panel")});e.on(c,function(){MG.logUse(a,"select multiple properties");n.selectMultiple(d.val(),a)});l.on("change",function(){MG.logUse(a,"sort");h()});d.on("keyup",function(){f&&clearTimeout(f);f=setTimeout(function(){MG.logUse(a,"enter criteria");h()},500)});$(g+" a.SearchPage").live(c,function(b){MG.logUse(a,"change page");h($(b.target).text())});$(g+" a.SearchResultLink").live(c,function(b){MG.logUse(a,"select property");n.selectOne($(b.target).closest("a").attr("data-propertyid"),a)});function h(b){if(!b)b=1;k.empty();e.hide();i.empty();m.empty();var c=escape(d.val());if(!c)j.show();else{var g=l.val(),f=MG.timer();$.getJSON("Search.ashx?c="+c+"&s="+g+"&p="+b,function(b){MG.logUse(a,"perform search",f);k.text(b.recordCount==1?"1 property found":b.recordCount+" properties found");e.toggle(0<b.recordCount&&b.recordCount<=100);var d=b.recordCount>0;j.toggle(!d);if(d){i.html(b.content);for(var g=Math.max(1,Math.min(b.pageNumber-2,b.pageCount-4)),h=Math.min(g+4,b.pageCount),c=g;c<=h;++c){var l=c==b.pageNumber?"<span class='SearchPage'>"+c+"</span>":"<a href='#' class='SearchPage'>"+c+"</a>";m.append($(l))}}})}}};return a}(MG||{});

// =====  Scripts/PropertyInfo.js  =====    
var MG=function(a){a.propertyInfo=function(m){var c="href",h="click",b="propertyInfo",a="property info",e=$("#propertyInfo"),j=m.map,d=m.selection,g=null;e.dockable("open",function(){MG.logUse(a,"open panel")});j.on("geomapclick",function(e,c){if(j.geomap("option","mode")!="pan")return;if(g)l();else g=setTimeout(function(){var e=MG.timer();$.getJSON("PropertyInfo.ashx?m=GetPropertyID&x="+c.coordinates[0]+"&y="+c.coordinates[1],function(c){if(c&&c.propertyid){MG.logUse(a,"select parcel on map",e);d.selectOne(c.propertyid,b)}else d.clear(b)});g=null},500)});j.on("geomapdblclick",function(){l()});var f=e.find("#ddlPropertyAddress"),i=e.find("#spnPropertyAddress"),k=e.find("#pnlPropertyInfoLinks a").on(h,function(a){!$(this).attr(c)&&a.preventDefault()}),p=e.find("#cmdPropertyRecordCard").on(h,function(){MG.logUse(a,"show property record card")});f.on("change",function(c){MG.logUse(a,"change property");d.changeProperty($(c.target).val(),b)});$(".ShowMoreInfo").on(h,function(){var a=$(this),b=a.text()=="more";$(".MoreInfo."+a.attr("id").substr(4)).toggle(b);a.text(b?"less":"more")});d.parcelsChanged(function(){n();o();d.getProperty()&&e.dockable("open")});function l(){if(g){clearTimeout(g);g=null}}function n(){var a="[no address]";f.empty();var b=d.getParcelProperties();if(b.length==0){i.hide();f.hide()}else if(b.length==1){i.text(b[0].siteAddress||a).show();f.hide()}else{var c=d.getProperty();$.each(b,function(){var b=this.id==c.id?" selected='selected'":"";f.append("<option value='"+this.id+"'"+b+">"+(this.siteAddress||a)+"</option>")});f.show();i.hide()}}function o(){var b="Disabled",g=e.find("#tblPropertyData").find("span").empty();k.addClass(b).attr(c,"");var f=d.getProperty();if(f){var h=MG.timer();$.getJSON("PropertyInfo.ashx?p="+escape(f.id),function(d){if(d&&d.property){MG.logUse(a,"get property data",h);g.each(function(){var a=$(this),b=a.attr("data-item");if(b in d.property){var c=a.attr("data-prefix");a.text((c?c:"")+d.property[b])}});d.externalLinks.length&&k.each(function(a){d.externalLinks[a]&&$(this).removeClass(b).attr(c,d.externalLinks[a])})}})}}};return a}(MG||{});

// =====  Scripts/Abutters.js  =====    
var MG=function(a){a.abutters=function(s){var g="#spnAbutterLimit",b="abutters",e="href",c="click",a=null,d=$("#abutter");if(!d.length)return;var f=s.selection,k=a,i=d.find("#ddlAbutterSort"),h=d.find("#tboAbutterDistance"),n=d.find("#pnlAbutterCommands span.Link"),o=d.find("#pnlAbutterCommands a").on(c,function(a){!$(this).attr(e)&&a.preventDefault()});d.dockable("open",function(){MG.logUse(b,"open panel");l()});d.find(".PanelClose").on(c,function(){f.clearAbutters()});d.find("#cmdAbutterExport").on(c,function(){j("spreadsheet")});d.find("#cmdAbutterLabels").on(c,function(){j("mailing labels")});d.find("#cmdAbutterReport").on(c,function(){j("report")});i.on("change",function(){MG.logUse(b,"sort");p()});h.on("keypress",function(b){var a=b.keyCode?b.keyCode:b.charCode;if(!(a==8||48<=a&&a<=57||a==13||96<=a&&a<=105))return false});h.on("keyup",function(c){d.find(g).hide();var a=c.keyCode?c.keyCode:c.charCode;if(a==8||48<=a&&a<=57||a==13||96<=a&&a<=105){k&&clearTimeout(k);k=setTimeout(function(){MG.logUse(b,"change distance");l()},500)}});f.parcelsChanged(function(){l()});f.abuttersChanged(function(){p()});function l(){if(!d.dockable("isDocked")){var a=m();if(a>config.abutters.maxSearchDistance){a=config.abutters.maxSearchDistance;d.find(g).show()}f.findAbutters(a,b)}}function j(c){var a=f.getAbutterProperties();if(a.length){MG.logUse(b,"export "+c);$("#hdnExportType").val(c);$("#hdnExportSubject").val(f.getProperty().id);$("#hdnExportIds").val($.map(a,function(a){return a.id}).join("|"));$("#hdnExportSort").val(i.val());$("#hdnExportDistance").val(!parseInt(h.val(),10)?1:parseInt(h.val(),10));$("#frmExport").submit()}}function m(){var a=parseInt(h.val(),10);return !a?1:a}function q(){MG.logUse(b,"remove from list");var a=$(this).parents(".AbutterResult");a.remove();f.removeAbutter(a.attr("data-propertyid"),"abutter")}function p(){var b="Disabled",h=d.find("#abutterResults").empty();n.addClass(b);o.addClass(b).attr(e,"");var j=i.val();$.each(f.getAbutterProperties(j),function(){var b=this,d=$('<div class="AbutterResult" data-propertyid="'+b.id+'"></div>'),f='<div class="AbutterText"></div>',g=b.siteAddress?$(f).text(b.siteAddress).get(0):a,e=config.applicationInfo.allow.propertyIDSearch&&b.id?$(f).text(b.id).get(0):a,i=config.applicationInfo.allow.ownerSearch&&b.ownerName?$(f).text(b.ownerName).get(0):a;switch(j){case "id":d.append($($.grep([e,g,i],function(b){return b!=a})));break;case "ownerName":d.append($([i,g,e]));break;default:d.append($([g,e,i]))}var k=d.children().eq(0).removeClass("AbutterText").addClass("AbutterTextMain");$('<div class="AbutterRemove"><span class="Link">Remove</span></div>').insertAfter(k).find("span").on(c,q);h.append(d)});if(h.children().length){n.removeClass(b);var g=f.getAbutterLinks();g.length&&o.each(function(a){g[a]&&$(this).removeClass(b).attr(e,g[a])})}}var r={getAbutterDistance:m};return r};return a}(MG||{});

// =====  Scripts/ClientInfo.js  =====    
var MG=function(a){a.clientInfo=function(){var h="#txtContactEmail",m="#txtOther",d="#txtComments",c="Other",a="#ddlCommentType",l="#errMsgCommentType",k="#errMsgOther",g="#errMsgComments",f="#pnlCommentsErrorMsg",n=".ClientExpander",b="client info",e="z-index",j="ClientExpander",v=null,o=$("#clientInfo"),i=config.panels.opened.clientInfo.height;$("#cmdSiteContact").expander({target:o.get(0),openedHeight:Math.max(140,i),closedHeight:i,groupClass:j,change:function(c,a){$("#pnlSiteContact").fadeTo(500,a?1:0).css(e,a?"2":"1");a&&MG.logUse(b,"show site contact")}});$("#cmdDisclaimer").expander({target:o.get(0),openedHeight:Math.max(config.clientInfo.disclaimer.panelHeight,i),closedHeight:i,groupClass:j,change:function(c,a){$("#pnlDisclaimer").fadeTo(500,a?1:0).css(e,a?"2":"1");a&&MG.logUse(b,"show disclaimer")}});$("#cmdComments").expander({target:o.get(0),openedHeight:Math.max(290,i),closedHeight:i,groupClass:j,change:function(c,a){$("#pnlComments").fadeTo(500,a?1:0).css(e,a?"2":"1");a&&MG.logUse(b,"show comments form")}});$(n).expander("change",function(b,a){$(b).find("span").html(a?"&#9650":"&#9660")});o.dockable("open",function(){MG.logUse(b,"open panel")});o.dockable("dock",function(){$(n).expander("close")});$("#btnSendComments").on("click",function(){t()&&u()});$("#btnResetComments").on("click",function(){MG.logUse(b,"reset comments");r()});function p(){$(f).hide();$(g).hide();$(k).hide();$(l).hide()}function s(){$(f).show();$(g).show();$(l).show()}function q(){$(f).show();$(g).show()}function t(){var b=true;p();if($(a).val()==""){b=false;s()}else if($(a).val()!=c&&$(a).val()!=""&&$(d).val()==""){q();b=false}else if($(a).val()==c&&$(d).val()==""){q();$(k).show();b=false}return b}function u(){var e={};if(config.applicationInfo.id!=null)e["AppId"]=config.applicationInfo.id;e["CommentType"]=$(a).val();e["Comments"]=$(d).val();if($(a).val()==c)e[c]=$(m).val();if($(h).val()!="")e["UserEmail"]=$(h).val();var f=MG.timer();$.ajax({url:"SaveComments.ashx",type:"POST",dataType:"json",data:$.stringifyJSON(e),contentType:"application/json",success:function(){MG.logUse(b,"submit comments",f);alert("Your comments have been submitted successfully.");r()},error:function(a){alert(a.Message)}})}function r(){$(a).val("");$(d).val("");$(m).val("");$(h).val("")}p()};return a}(MG||{});

// =====  Scripts/MapTip.js  =====    
var MG=function(a){a.mapTip=function(o){var d="propertyid",a="map tip",j="mouseleave",b=null,h=$("#mapTip"),e=o.map,c=o.selection,n=true,f=b,g=b,k=0,l=false,m=h.find("span.MapTip.Link");e.on("geomapbboxchange",i);e.on("geomapclick",function(){i();p();l=true});e.on(j,function(){p()});e.on("mousemove",function(j){i();if(!l&&n&&e.geomap("option","zoom")>=config.mapTip.zoomLevel){g&&clearTimeout(g);g=setTimeout(function(){var i=k+=1,g=e.geomap("toMap",[j.pageX-e.offset().left,j.pageY-e.offset().top]),l=MG.timer();$.getJSON("MapTip.ashx?x="+g[0]+"&y="+g[1],function(e){if(i==k&&e&&e.values){MG.logUse(a,"show tip",l);$("#mapTipContent").html(e.values.join("<br/>"));m.data(d,e.propertyid);$("#mapTipAdd,#mapTipRemove,#mapTipAbutter,#mapTipAddAbutter,#mapTipRemoveAbutter").hide();var n=c.hasParcelForProperty(e.propertyid);$("#mapTipAdd").toggle(!n&&c.getParcels().length>0);$("#mapTipRemove").toggle(n);if(c.getBuffer()){var g=c.hasAbutterForProperty(e.propertyid);$("#mapTipAbutter").show();$("#mapTipAddAbutter").toggle(!g);$("#mapTipRemoveAbutter").toggle(g)}var o=j.pageY-13*(e.values.length+1)-7;h.css({left:j.pageX,top:o}).fadeTo(250,.9);f=b}})},1e3)}l=false});h.on("mouseenter",function(){if(f){clearTimeout(f);f=b}});h.on(j,function(){i()});m.on("click",function(g){var f=$(g.target),b=f.data(d),e="mapTip";switch(f.attr("id")){case "mapTipSelect":MG.logUse(a,"select parcel");c.selectOne(b,e);break;case "mapTipAdd":MG.logUse(a,"add parcel");c.add(b,e);break;case "mapTipRemove":MG.logUse(a,"remove parcel");c.remove(b,e);break;case "mapTipAddAbutter":MG.logUse(a,"add abutter");c.addAbutter(b,e);break;case "mapTipRemoveAbutter":MG.logUse(a,"remove abutter");c.removeAbutter(b,e)}i()});function i(){if(!f)f=setTimeout(function(){h.fadeOut(250);f=b},250)}function p(){if(g){clearTimeout(g);g=b;k+=1}}var q={enable:function(a){n=a}};return q};return a}(MG||{});

// =====  Scripts/Inset.js  =====    
var MG=function(a){a.inset=function(m){var b="inset",a=null,i=$("#pnlInsetContainer"),j=m.mainMap,e=a,d=a,f=i.find("#insetMap").geomap({tilingScheme:a,bboxMax:config.inset.extent,zoom:0,mode:"static",services:[{id:b,type:"shingled",src:config.inset.imageSource}],shapeStyle:{color:"#FF0000"}}),c=a;i.find("#cmdInsetSize").on("click",function(e){var d=$(e.target),c=k();i.animate({width:c?config.inset.size.width+6:35,height:c?config.inset.size.height+6:35},500,a,function(){d.css("background-image",c?"url(Images/InsetShrink.png)":"url(Images/InsetGrow.png)")});c&&MG.logUse(b,"open panel")});f.on("touchstart mousedown",function(b){c=a;if(!k())if(b.shiftKey)e=h(b);else{c=$.geo.recenter(d,h(b));g(c)}});f.on("touchmove mousemove",function(a){if(e){var b=h(a);g(l(e,b))}if(c){c=$.geo.recenter(c,h(a));g(c)}});f.on("touchleave mouseleave",function(){if(c){e=a;c=a;g(d)}});f.on("touchend touchcancel mouseup",function(i){var g=h(i),f=a;if(e){MG.logUse(b,"draw extent box");f=l(e,g);e=a}if(c){MG.logUse(b,"pan");f=$.geo.recenter(d,g);c=a}if(f){j.geomap("option","bbox",f);d=f}});j.on("geomapbboxchange",function(b,a){d=a.bbox;g(d)});function g(a){f.geomap("empty").geomap("append",{type:"Polygon",coordinates:[[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]]})}function h(c){var b=MG.getTouch(c),a=f.offset();return f.geomap("toMap",[b[0]-a.left,b[1]-a.top])}function k(){return i.find("#insetFrame").width()<config.inset.size.width}function l(a,b){return [Math.min(a[0],b[0]),Math.min(a[1],b[1]),Math.max(a[0],b[0]),Math.max(a[1],b[1])]}function n(){d=j.geomap("option","bbox");g(d)}var o={update:n};return o};return a}(MG||{});

// =====  Scripts/Default.js  =====    
$(function(){var E="isDocked",M="find",D="px",o="zoom",L="mode",hb=".PanelContent",gb=".PanelControls",zb="#tboPrintableMapScale",yb="#tboMapLink",fb="drawText",eb="add markup",t="0px",k="append",C="toMap",y="Point",Rb="mouseleave",xb="#lnkGoogleStreetView",wb="#lnkBingBirdsEye",A="value",r=false,J="toggle",mb="option:selected",l="bbox",w="empty",bb="#tboDrawText",Q="drawStyle",z=-1e3,q="left",n="#pnlContextMenu",Db="#cmdDrawColor",j="click",P="close",ab="change",Cb="MapExpander",v=500,lb="#helpDoc",Z="open",u="id",I=".Dockable",d="map",Y="shapeStyle",a="option",O="graphics",X="thematicMap",H="#ddlThematicMap",kb="OpenStreetMap",jb="MapQuest",c="",N=".png",e="/",ib="MapBox Light",G="baseMap",h="selectedIndex",F="#ddlBaseMap",f=10,i=",",Bb=20037508.342787,p=null,g=true,Ab=g;MG.logStart(config.applicationInfo.id);var qb=MG.getUrlParams(),ob=p,Fb="showtiles" in qb;$("#touchPanel").toggle(MG.supportsTouch);var cb=$("#pnlWelcome");Pb();$.geo.proj=p;var V=39.37/12;$.geo.length=function(f){for(var a=f.coordinates,c=0,d,e,b=1;b<a.length;++b){d=a[b][0]-a[b-1][0];e=a[b][1]-a[b-1][1];c+=Math.sqrt(d*d+e*e)}c/=MG.webMercator.getScaleFactor(a[0]);return W(c*V)+" ft<br/>"+W(c)+" m"};$.geo.area=function(e){var a=e.coordinates[0],b=0;if(a.length>2)for(var f=a[0][1]*2,c=1;c<a.length;++c)b+=(a[c][0]-a[c-1][0])*(a[c][1]+a[c-1][1]-f);var d=MG.webMercator.getScaleFactor(a[0]);if(b!=0)b=Math.abs(b*.5)/(d*d);var d=b*V*V;return W(d/43560,3)+" acres<br/>"+W(d)+" sq ft<br/>"+W(b)+" sq m"};var nb={baseMap:[],thematicMap:[]},pb={ tilingScheme:{tileWidth:256,tileHeight:256,levels:6,basePixelSize:2445.98490512499,pixelSizes:p,origin:[-20037508.342787,Bb]},bbox:config.map.fullExtent,bboxchange:U,services:[],measureLabels:{length:"{{:length!}}",area:"{{:area!}}"},drawStyle:{stroke:"#808080",strokeWidth:"2px",fill:"#808080",fillOpacity:.3},shape:jc,click:mc,cursors:{pan:"default",drawText:"text",drawErase:"default"}};if("extent" in qb)pb.bbox=$.map(qb.extent.split(i),function(a){return parseInt(a,f)});else pb.zoom=config.map.zoomBar.initialLevel;for(var db=$(F).prop(h),s=0;s<config.map.baseMaps.length;++s)Sb(config.map.baseMaps,G,s,s==db,1);for(s=0;s<config.map.externalMaps.length;++s){var S=config.map.baseMaps.length;switch(config.map.externalMaps[s]){case ib:B(S,G,function(a){var b=(["a","b","c","d"])[(a.tile.column*Math.pow(2,a.zoom)+a.tile.row)%4];return ["http://",b,".tiles.mapbox.com/v3/mapbox.mapbox-light/",a.zoom,e,a.tile.column,e,a.tile.row,N].join(c)},S==db,1);config.map.baseMaps.push({id:ib,copyright:"&copy; OpenStreetMap and contributors, CC-BY-SA - Tiles Courtesy of <a href='http://mapbox.com/' target='_blank'>MapBox - Development Seed</a>"});break;case jb:B(S,G,function(a){return ["http://otile1.mqcdn.com/tiles/1.0.0/osm/",a.zoom,e,a.tile.column,e,a.tile.row,N].join(c)},S==db,1);config.map.baseMaps.push({id:jb,copyright:"&copy; OpenStreetMap and contributors, CC-BY-SA - Tiles Courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png'>"});break;case kb:B(S,G,function(a){return ["http://a.tile.openstreetmap.org/",a.zoom,e,a.tile.column,e,a.tile.row,N].join(c)},S==db,1);config.map.baseMaps.push({id:kb,copyright:"&copy; OpenStreetMap and contributors, CC-BY-SA"})}}var Hb=$(H).prop(h)-1;for(s=0;s<config.map.thematicMaps.length;++s)Sb(config.map.thematicMaps,X,s,s==Hb,.5);B("abutter",O,R,g,1);B("buffer",O,R,g,1);B("target",O,R,g,1);B("selected",O,R,g,1);B("drawing",O,R,g,1);Fb&&B("tile",O,R,g,1);var b=$("#map").geomap(pb),Kb=b.find(".graphics.abutter").geomap(a,Y,{fillOpacity:0,stroke:"#0080FF",strokeWidth:"5px",strokeOpacity:.65}),Lb=b.find(".graphics.buffer").geomap(a,Y,{fill:"#8080FF",fillOpacity:.25,stroke:"#0000FF",strokeWidth:"1px",strokeOpacity:.65}),Mb=b.find(".graphics.target").geomap(a,Y,{fillOpacity:0,stroke:"#FF8000",strokeWidth:"7px",strokeOpacity:.85}),Jb=b.find(".graphics.selected").geomap(a,Y,{fillOpacity:0,stroke:"#FFFF00",strokeWidth:"7px",strokeOpacity:.85}),x=b.find(".graphics.drawing");if(Fb)var Ob=b.find(".graphics.tile").geomap(a,Y,{fillOpacity:0,stroke:"#404040",strokeWidth:"1px"});var Nb=$("#baseMapSlider").slider({max:1,step:.01,value:1,slide:function(a){rb(G,Eb,0,a)},stop:function(a){MG.logUse(d,"change base map transparency");rb(G,Eb,0,a)}}),Ib=$("#thematicMapSlider").slider({max:1,step:.01,value:.5,slide:function(a){rb(X,ub,1,a)},stop:function(a){MG.logUse(d,"change thematic map transparency");rb(X,ub,1,a)}});$(I).each(function(){var d=$(this),c=d.attr(u),a=config.panels,e={container:b,isDocked:a.isDocked[c],docked:a.docked[c],opened:a.opened[c],motion:a.animation.motion,duration:Math.round(a.animation.duration*1e3),dock:hc,open:ic,draggable:{handle:"div.PanelHeader",stop:cc,containment:"window"}};d.find("div.PanelBody").on("touchstart mousedown",function(){gc(d)});if(c in a.resizable)e.resizable=$.extend({handles:"all",stop:Zb},a.resizable[c]);d.dockable(e);c in a.resizable&&vb(d)});$("#help").dockable(Z,function(){var a=$(lb);!a.attr("src")&&a.attr("src","Help/MapGeoHelp-General.pdf")});var fc=$("#cmdLegend"),T=$("#cmdPrintableMap"),ec=$("#cmdMapLink"),sb=$("#layer");fc.expander({target:sb.get(0),openedHeight:v,closedHeight:config.panels.opened.layer.height,groupClass:Cb,change:function(b,a){$("#pnlLegend").toggle(a);a&&MG.logUse(d,"show legend")}});T.expander({target:sb.get(0),openedHeight:MG.supportsTouch?370:345,closedHeight:config.panels.opened.layer.height,groupClass:Cb,change:function(b,a){$("#pnlPrintableMap").fadeTo(v,a?1:0);a&&MG.logUse(d,"show printable map form")}});ec.expander({target:sb.get(0),openedHeight:175,closedHeight:config.panels.opened.layer.height,groupClass:Cb,change:function(b,a){$("#pnlMapLink").fadeTo(v,a?1:0);a&&MG.logUse(d,"show map link")}});$(".MapExpander").expander(ab,function(b,a){$(b).find("span").html(a?"&#9650":"&#9660")});sb.dockable("dock",function(){T.expander(P)});var Wb=MG.zoomBar(),m=MG.selection(),sc=MG.search({selection:m}),pc=MG.propertyInfo({map:b,selection:m}),lc=MG.abutters({selection:m}),rc=MG.clientInfo(),nc=MG.mapTip({map:b,selection:m}),oc=MG.inset({mainMap:b});$("#cmdAcceptDisclaimer").on(j,function(){$.cookie("accept","1",{expires:180});$(".Welcome").hide()});$("#cmdCreatePrintableMap").on(j,function(){$("#layer").animate({height:120});T.expander(P);Yb();MG.logUse(d,"create printable map")});$("#cmdDownloadHelp").on(j,function(){MG.logUse("help","download help PDF")});$(Db).on(j,function(){$(n).css(q,z)}).colorSelector({selectorClass:"ColorSelector",colorChanged:function(c){var d=b.geomap(a,Q);d.stroke=c;d.fill=c;$(bb).css({color:c,borderColor:c})}});$("#cmdDrawEraseAll").on(j,function(){$(n).css(q,z);x.geomap(w);MG.logUse(d,"erase all markup")});$("#cmdTouch").on(j,function(){var b=$(this),a=b.offset();$(n).css(q,a.left+b.width()+20).css("top",a.top-69)});$("#cmdWhatsNew").on(j,function(){Gb("WhatsNew")});$("#cmdZoomFull").on(j,function(){b.geomap(a,l,config.map.fullExtent);U();MG.logUse(d,"full extent")});var Eb=$(F).on(ab,function(){var a="Disabled",f=$(this),c=f.find(mb).text(),e=f.prop(h);b.find(".baseMap").geomap(J,r);b.find(".baseMap."+e).geomap(J,g);Nb.slider(A,nb.baseMap[e]);$("#pnlBaseMapLegend > div").hide();$("#pnlBaseMaps_"+config.map.baseMaps[e].id).show();if(c==jb||c==kb||c==ib)T.addClass(a).expander(P,g);else T.removeClass(a);Qb();K();!Ab&&MG.logUse(d,"change base map",c)}),ub=$(H).on(ab,function(){var c=$(this),a=c.prop(h)-1;b.find(".thematicMap").geomap(J,r);b.find(".thematicMap."+a).geomap(J,g);Ib.slider(A,nb.thematicMap[a]);$("#pnlThematicMapLegend > div").hide();a>=0&&$("#pnlThematicMaps_"+config.map.thematicMaps[a].id).show();Qb();K();!Ab&&MG.logUse(d,"change thematic map",c.find(mb).text())});$(wb).on(j,function(){MG.logUse(d,"open Bing Birds Eye")});$(xb).on(j,function(){MG.logUse(d,"open Google Street View")});$("#lnkMapGallery").on(j,function(){MG.logUse(d,"open map gallery")});b.on("contextmenu",function(a){$(n).css(q,a.pageX-f).css("top",a.pageY-f);return r});$(n).on(Rb,function(){$(n).css(q,z)});$("#pnlDrawColor span").on(j,function(){$(Db).colorSelector("showSelector");$(n).css(q,z)});$("#pnlPrintableMap .PanelClose").on(j,function(){closePrintableMapDialog()});$(bb).on("keydown",function(l){if(l.keyCode==13){var e=$(this),f=e.val(),h=e.offset();e.val(c).hide();if(f){var g=b.geomap(a,Q).stroke,j={type:y,coordinates:b.geomap(C,[h.left+1,h.top+23]),text:f,color:g,measure:r},i=["<div class='DrawText' style='color: ",g,"'>",f,"</div>"].join(c);x.geomap(k,j,{width:t,height:t,strokeWidth:t},i);MG.logUse(d,eb,fb)}}});$(yb).on(j,function(){$(this).focus().select()});$(zb).on("keypress",function(a){var b=a.keyCode?a.keyCode:a.charCode;if(!(48<=b&&b<=57))return r});$("#zoomPanel").on("mouseenter",function(){$(this).fadeTo(v,1)}).on(Rb,function(){$(this).fadeTo(v,.5)});$(window).on("resize",function(){Pb()});$(window).on("unload",function(){config.applicationInfo.logUse&&MG.logEnd()});$(I).on(j,function(a){$(a.target).parents(I).dockable(Z)});$(".Dockable .PanelClose").on(j,function(a){$(a.target).parents(gb).hide().parents(I).dockable("dock").find(hb).hide();a.stopPropagation()});$(".HelpExpander").on(j,function(){var a=$(this).attr(u).substr(7);Gb(a)});$(".LocalHelp").on(j,function(){var a=$(this).attr(u).substr(12);$("#help").dockable(Z);Gb(a)});$(".ToolOption").on(j,function(g){var c="Selected";$(".ToolOption.Selected").removeClass(c);var e=$(g.target).addClass(c);$(n).css(q,z);var f=e.attr("data-mode");nc.enable(f=="pan");MG.logUse(d,"pick "+e.text().toLowerCase()+" tool");b.geomap(a,L,f)});function hc(b){var a=$(b.target);vb(a);Ub(a);K()}function cc(a){Vb($(a.target))}function ic(b){var a=$(b.target);a.find(gb).show();a.find(hb).show();vb(a);Ub(a);K()}function Zb(){var a=$(this);a.offset().top<0&&a.offset({top:0});Vb(a)}m.parcelsChanged(function(e){Mb.geomap(w);Jb.geomap(w);var d=$.map(m.getParcels(),function(a){return a.geometry});if(d.length){$.each(d,function(){Mb.geomap(k,this)});Jb.geomap(k,m.getProperty().parcel.geometry);if(e=="search"){var c=p;$.each(d,function(){c=ac(c,$.geo.bbox(this))});c=$.geo.scaleBy(c,3);b.geomap(a,l,c);U()}}K()});m.abuttersChanged(function(){Kb.geomap(w);Lb.geomap(w);var a=$.map(m.getAbutters(),function(a){return a.geometry});a.length&&$.each(a,function(){Kb.geomap(k,this)});var b=m.getBuffer();b&&Lb.geomap(k,b);K()});Wb.levelChanged(function(c){b.geomap(a,o,c+config.map.zoomBar.offset);U()});function Sb(b,f,a,g,d){if("opacity" in b[a])d=b[a].opacity;nb[f][a]=d;$.each(b[a].tileSets,function(){var b=this,h=function(a){var d=b.tileUrlScheme||"LCR";switch(d){case "LCR":return [b.tileCacheUrl,e,a.zoom,e,a.tile.row,e,a.tile.column].join(c);case "WMS":return [b.tileCacheUrl,"&width=256&height=256&bbox=",a.bbox[0],i,a.bbox[3],i,a.bbox[2],i,a.bbox[1]].join(c)}};B(a,f,h,g,d)})}function B(d,c,b,f,e){var a={"class":c+" "+d,type:"tiled",src:b,style:{visibility:f?"visible":"hidden",opacity:e}};pb.services.push(a)}function bc(){var d=b.geomap(a,o)-config.map.zoomBar.offset,c=config.map.zoomBar.levels-1;if(d<0)b.geomap(a,o,config.map.zoomBar.offset);else d>c&&b.geomap(a,o,c+config.map.zoomBar.offset)}function gc(c){var b="css3-container",a="z-index",d=c.css(a);$(I).not("#"+c.attr(u)).each(function(g,f){var e=$(f),c=e.css(a);c>d&&e.css(a,c-2).prev(b).css(a,c-3)});c.css(a,20).prev(b).css(a,19)}function Pb(){if(cb.length&&cb.css("display")=="block"){var a=Math.round(($("body").width()-cb.width())*.5)+D,b=Math.round(($("body").height()-cb.height())*.5)+D;cb.css({left:a,top:b})}}function Yb(){var e=b.geomap(a,l),d=m.getProperty(),c=parseInt(ob),j,i;switch($(".PrintOption:checked").val()){case "1":c=parseInt(tb());break;case "2":c=parseInt($(zb).val());if(!c||c>2e4)c=v}e=$.geo.scaleBy(e,c/ob);var f=$.map(x.geomap(M,"*"),function(a){var b={type:a.type,coordinates:a.coordinates,color:a.color};if("text" in a)b.text=a.text;if("measure" in a)b.measure=a.measure;return b}),g={baseMap:$(F).prop(h),baseMapOpacity:Nb.slider(a,A),thematicMap:$(H).prop(h),thematicMapOpacity:Ib.slider(a,A),extent:e,selected:d?d.parcel.geometry:p,targets:$.map(m.getParcels(),function(a){return a.geometry}),abutters:$.map(m.getAbutters(),function(a){return a.geometry}),buffer:m.getBuffer(),abuttersDistance:$("#tboAbutterDistance").val(),graphics:f,propertyID:d?d.id:p,title:$("#tboPrintableMapTitle").val(),size:$(".PrintSize:checked").val(),orientation:$(".PrintOrientation:checked").val(),legend:$(".printLegend").attr("checked")?1:0,scale:c};$("#hdnPrintConfig").val($.stringifyJSON(g));$("#frmPrintableMap").submit()}function kc(){if(Fb){Ob.geomap(w);var h=b.geomap(a,o),e=Bb,d=e*Math.pow(2,1-h),q=b.geomap(a,l),y=Math.floor((e-q[3])/d)+1,z=Math.floor((e-q[1])/d)+1,u=Math.floor((q[0]+e)/d),v=Math.floor((q[2]+e)/d),x=Math.pow(2,h),D=Math.floor(h*.5),s=2<<D,p=s>f?Math.floor(Math.log(s)/Math.LN10)+1:1;function n(a,f){var d=1;if(a>9)d=a>11?parseInt(Math.ceil(Math.log(a)/Math.LN10-.001)):2;var e=f-d,b=c;while(e>0){b+="0";e-=1}b+=a;return b}for(var i=y;i<=z;++i)for(var g=u;g<=v;++g){var j=g*d-e,m=-(i*d-e),E={type:"Polygon",coordinates:[[[j,m],[j,m+d],[j+d,m+d],[j+d,m],[j,m]]]},t=x-i,A=n(Math.floor(g/s),p),B=n(Math.floor(t/s),p),F=n(g,p*2),t=n(t,p*2),C="Level "+h+", Row "+(i-1)+", Column "+g+"<br/>GWC "+h+" \\ "+A+"_"+B+" \\ "+F+"_"+t;Ob.geomap(k,E,"<div class='TileText'>"+C+"</div>",r)}}}function ac(a,b){if(!a)return b.length==4?b:[b[0],b[1],b[0],b[1]];a=[a[0],a[1],a[2],a[3]];for(var c=0;c<b.length;c+=2){if(b[c]<a[0])a[0]=b[c];if(b[c+1]<a[1])a[1]=b[c+1]}return a}function U(){bc();var e=b.geomap(a,l),d=MG.webMercator.toGeodetic($.geo.center(e));$(xb).attr("href",["http://maps.google.com/?ll=",d[1],i,d[0],"&z=6&layer=c&cbll=",d[1],i,d[0],"&cbp=11,0,,0,0"].join(c));$(wb).attr("href",["http://www.bing.com/maps/?v=2&cp=",d[1],"~",d[0],"&lvl=6&dir=0&style=b"].join(c));Wb.setLevel(b.geomap(a,o)-config.map.zoomBar.offset);oc.update();dc();Xb();kc();K()}function rb(d,f,e,g){var a=$(g.target).slider(A),c=f.prop(h)-e;nb[d][c]=a;b.find("."+d+"."+c).geomap("opacity",a)}function W(a,b){for(var e=a.toFixed(b).split(c),a=e.length-(b?b+1:0),d=(a-1)%3+1;d<a;d+=4){e.splice(d,0,i);a+=1}return e.join(c)}function tb(){var c=MG.webMercator.getScaleFactor($.geo.center(b.geomap(a,l)));return b.geomap(a,"tilingScheme").basePixelSize*Math.pow(2,-b.geomap(a,o))*96/(c/V)}function mc(k,i){var c="remove";switch(b.geomap(a,L)){case fb:var j=b.geomap("toPixel",i.coordinates);$(bb).css({left:j[0]-2+D,top:j[1]-f+D}).show().focus();return;case "drawErase":var h=r;$.each(x.geomap(M,i,8),function(){var a=this;if(!(a.type==y)){a.related&&x.geomap(c,a.related);x.geomap(c,a);h=g}});var e=i.coordinates;$.each(x.geomap(M,"*"),function(){var a=this;if(a.type==y&&!a.measure){var d=b.geomap("toPixel",a.coordinates),i=b.geomap(C,[d[0]+4,d[1]-5]),f=b.geomap(C,[d[0]+4+Math.round(a.text.length*13*.55),d[1]-18]);if(i[0]<=e[0]&&e[0]<=f[0]&&i[1]<=e[1]&&e[1]<=f[1]){x.geomap(c,a);h=g}}});h&&MG.logUse(d,"erase markup");return}}function R(){return c}function Tb(b,d,c){var a=$.cookie("config");a=a?$.parseJSON(a):{panels:{}};if(!(b in a.panels))a.panels[b]={};a.panels[b][d]=c;$.cookie("config",$.stringifyJSON(a),{expires:60})}function Ub(a){Tb(E,a.attr(u),a.dockable(E))}function Vb(a){Tb("opened",a.attr(u),a.dockable("opened"))}function jc(p,e){var f="measureLength",i={};$.extend(g,i,b.geomap(a,Q));e.color=i.stroke;x.geomap(k,e,i);var h=b.geomap(a,L);if(h==f||h=="measureArea"){var j=h==f?$.geo.length(e):$.geo.area(e),o=h==f?e.coordinates[e.coordinates.length-1]:e.coordinates[0][e.coordinates[0].length-2],l={type:y,coordinates:o,text:j.replace(/<br\/>/g,"|"),color:e.color,measure:g};e.related=l;var m=["color: ",e.color,"; text-shadow: none; filter: none"].join(c),n=["<div style='padding-left: 6px; padding-top: 4px'><div class='geo_measure_label' style='",m,"'>",j.replace(/\s/g,"&nbsp;"),"</div></div>"].join(c);x.geomap(k,l,{width:t,height:t,strokeWidth:t},n)}MG.logUse(d,eb,h)}function Qb(){var d=$("#copyright").empty(),b=config.map.baseMaps[$(F).prop(h)].copyright,e=$(H).prop(h)-1,a=e>=0?config.map.thematicMaps[e].copyright:p;if(b||a){var f=(b?"Base Map "+b:c)+(b&&a?" - ":c)+(a?"Thematic Map "+a:c);d.empty().append(f.replace(/{year}/g,(new Date).getFullYear())).show()}else d.hide()}function Gb(a){$(lb).attr("src","Help/MapGeoHelp-"+a+".pdf");MG.logUse("help","show help document",a)}function dc(){$("#scaleText").text(parseInt(tb(),f)+" ft")}function Xb(){var d=7.5,g=7.5,c=b.geomap(a,l);c=$.geo.reaspect(c,d/g);var h=MG.webMercator.getScaleFactor($.geo.center(c)),e=$.geo.width(c)/(h/V);ob=e/d;$("#spnPrintableExtentScale").text(parseInt(ob,f));$("#spnPrintableCurrentScale").text(parseInt(tb(),f))}function vb(a){a.find(".ui-resizable-handle").toggle(!a.dockable(E))}function K(){var g=document.location.href,d=g.split("#");d=d[0].split("?");d=d[0].split(e);var n=d.length-1;if(d[n]=="Default.aspx")d[n]=c;g=d.join(e);var i=b.geomap(a,l);g+="?extent="+[parseInt(i[0],f),parseInt(i[1],f),parseInt(i[2],f),parseInt(i[3],f)].join();var j=$(F).prop(h);g+="&basemap="+config.map.baseMaps[j].id;j=$(H).prop(h)-1;if(j>=0)g+="&thematicmap="+config.map.thematicMaps[j].id;var o=m.getProperty();if(o)g+="&propertyid="+escape(o.id);var k=$("#abutter");if(k.length&&!k.dockable(E))g+="&abutterdistance="+lc.getAbutterDistance();$(yb).val(g)}U();Eb.trigger(ab);Hb>=0&&ub.trigger(ab);delete Ab;setTimeout(function(){config.startup&&config.startup.propertyID&&m.selectOne(config.startup.propertyID,"extent" in qb?"start":"search");b.focus()},v)});

